<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Técnicas de analasis de riesgo hídrico en el Partido de La Plata">

<title>3&nbsp; RENABAP – CIUT Riesgo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./twi.html" rel="next">
<link href="./suavizacion.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./renabap.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RENABAP</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">CIUT Riesgo</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/nlebovits/ciut-riesgo" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exposicion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Exposición</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./suavizacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Suavización</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./renabap.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RENABAP</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./twi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Índice de Humedad Topográfica (TWI)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#resumen-ejecutivo" id="toc-resumen-ejecutivo" class="nav-link active" data-scroll-target="#resumen-ejecutivo"><span class="header-section-number">3.1</span> Resumen ejecutivo</a></li>
  <li><a href="#objetivos" id="toc-objetivos" class="nav-link" data-scroll-target="#objetivos"><span class="header-section-number">3.2</span> Objetivos</a></li>
  <li><a href="#contexto" id="toc-contexto" class="nav-link" data-scroll-target="#contexto"><span class="header-section-number">3.3</span> Contexto</a></li>
  <li><a href="#fuentes-de-datos" id="toc-fuentes-de-datos" class="nav-link" data-scroll-target="#fuentes-de-datos"><span class="header-section-number">3.4</span> Fuentes de datos</a>
  <ul class="collapse">
  <li><a href="#renabap" id="toc-renabap" class="nav-link" data-scroll-target="#renabap"><span class="header-section-number">3.4.1</span> RENABAP</a></li>
  <li><a href="#ghsl" id="toc-ghsl" class="nav-link" data-scroll-target="#ghsl"><span class="header-section-number">3.4.2</span> GHSL</a></li>
  <li><a href="#peligro-de-inundación" id="toc-peligro-de-inundación" class="nav-link" data-scroll-target="#peligro-de-inundación"><span class="header-section-number">3.4.3</span> Peligro de inundación</a></li>
  <li><a href="#google-microsoft-osm-open-buildings" id="toc-google-microsoft-osm-open-buildings" class="nav-link" data-scroll-target="#google-microsoft-osm-open-buildings"><span class="header-section-number">3.4.4</span> Google-Microsoft-OSM Open Buildings</a></li>
  </ul></li>
  <li><a href="#metodología-y-procesamiento" id="toc-metodología-y-procesamiento" class="nav-link" data-scroll-target="#metodología-y-procesamiento"><span class="header-section-number">3.5</span> Metodología y procesamiento</a>
  <ul class="collapse">
  <li><a href="#interpolación-por-area" id="toc-interpolación-por-area" class="nav-link" data-scroll-target="#interpolación-por-area"><span class="header-section-number">3.5.1</span> Interpolación por area</a></li>
  <li><a href="#mapeo-dasymetrico" id="toc-mapeo-dasymetrico" class="nav-link" data-scroll-target="#mapeo-dasymetrico"><span class="header-section-number">3.5.2</span> Mapeo dasymetrico</a></li>
  </ul></li>
  <li><a href="#resultados" id="toc-resultados" class="nav-link" data-scroll-target="#resultados"><span class="header-section-number">3.6</span> Resultados</a>
  <ul class="collapse">
  <li><a href="#comparación-de-métodos" id="toc-comparación-de-métodos" class="nav-link" data-scroll-target="#comparación-de-métodos"><span class="header-section-number">3.6.1</span> Comparación de métodos</a></li>
  <li><a href="#exposición-por-barrio" id="toc-exposición-por-barrio" class="nav-link" data-scroll-target="#exposición-por-barrio"><span class="header-section-number">3.6.2</span> Exposición por barrio</a></li>
  <li><a href="#exposición-por-cuenca" id="toc-exposición-por-cuenca" class="nav-link" data-scroll-target="#exposición-por-cuenca"><span class="header-section-number">3.6.3</span> Exposición por cuenca</a></li>
  <li><a href="#exposición-por-eje" id="toc-exposición-por-eje" class="nav-link" data-scroll-target="#exposición-por-eje"><span class="header-section-number">3.6.4</span> Exposición por eje</a></li>
  </ul></li>
  <li><a href="#conclusiones" id="toc-conclusiones" class="nav-link" data-scroll-target="#conclusiones"><span class="header-section-number">3.7</span> Conclusiones</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RENABAP</span></h1>
<p class="subtitle lead">Análisis de la exposición poblacional a peligros de inundación en el Partido de La Plata</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="resumen-ejecutivo" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="resumen-ejecutivo"><span class="header-section-number">3.1</span> Resumen ejecutivo</h2>
<p><em>Los datos procesados, incluyendo las estimaciones de exposición por barrio popular para los tres métodos de estimación, desglosados por nivel de peligro, están disponibles para descarga en formato CSV. <a href="https://raw.githubusercontent.com/nlebovits/ciut-riesgo/main/notebooks/data/barrio_wide.csv" download="barrio_exposicion_data.csv">Haga clic aquí para descargar los datos por barrio</a>. Los datos agregados por cuenca también están disponibles, incluyendo una columna “eje” que permite resumir los datos al nivel de eje de cuenca. <a href="https://raw.githubusercontent.com/nlebovits/ciut-riesgo/main/notebooks/data/cuenca_wide.csv" download="cuenca_exposicion_data.csv">Haga clic aquí para descargar los datos por cuenca</a>.</em></p>
</section>
<section id="objetivos" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="objetivos"><span class="header-section-number">3.2</span> Objetivos</h2>
<p>El objetivo principal de este análisis es calcular con mayor precisión la exposición poblacional en la región del Partido de La Plata, comparando el enfoque actual de interpolación por área de datos del RENABAP con enfoques de mapeo dasimétrico de mayor resolución utilizando datos de la Capa Global de Asentamientos Humanos (GHSL) y el conjunto de datos de edificios abiertos de Google-Microsoft OpenStreetMap.</p>
<p>Para lograr este objetivo, necesitamos:</p>
<ol type="1">
<li><strong>Explicar y comparar metodologías</strong>: Desarrollar una comprensión clara de las diferencias entre interpolación por área y mapeo dasimétrico</li>
<li><strong>Evaluar fuentes de datos</strong>: Analizar las ventajas y limitaciones de cada conjunto de datos utilizado</li>
<li><strong>Crear estimaciones robustas</strong>: Generar un rango de posibles exposiciones poblacionales para informar la toma de decisiones</li>
<li><strong>Priorizar recursos</strong>: Identificar áreas donde se requiera recopilación de datos más precisa</li>
</ol>
</section>
<section id="contexto" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="contexto"><span class="header-section-number">3.3</span> Contexto</h2>
<div id="46c41f12" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> BytesIO, StringIO</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> owslib.wfs <span class="im">import</span> WebFeatureService</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s2sphere</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> botocore.config <span class="im">import</span> Config</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterstats</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.ma <span class="im">as</span> ma</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itables</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itables <span class="im">import</span> show</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> HTML, display</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ITABLES SPANISH CONFIGURATION</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure Argentine Spanish for itables</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    spanish_url <span class="op">=</span> <span class="st">"https://cdn.datatables.net/plug-ins/2.3.3/i18n/es-AR.json"</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(spanish_url)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    response.raise_for_status()</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    spanish_config <span class="op">=</span> response.json()</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    itables.options.language <span class="op">=</span> spanish_config</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span>  <span class="co"># Fall back to English if configuration fails</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure smaller font size for all itables</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>css <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="st">.dt-container {</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="st">  font-size: small;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>display(HTML(<span class="ss">f"&lt;style&gt;</span><span class="sc">{</span>css<span class="sc">}</span><span class="ss">&lt;/style&gt;"</span>))</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to round numeric columns for display</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> round_numeric_columns(df, decimals<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Round all numeric columns in a DataFrame to specified decimal places."""</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    df_display <span class="op">=</span> df.copy()</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    numeric_columns <span class="op">=</span> df_display.select_dtypes(include<span class="op">=</span>[np.number]).columns</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    df_display[numeric_columns] <span class="op">=</span> df_display[numeric_columns].<span class="bu">round</span>(decimals)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_display</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co"># CONSTANTS AND CONFIGURATION</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co"># =============================================================================</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinate Reference Systems</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>USE_CRS <span class="op">=</span> <span class="st">"EPSG:5349"</span>  <span class="co"># POSGAR 2007 / Argentina 4</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>WEB_MERCATOR_CRS <span class="op">=</span> <span class="st">"EPSG:3857"</span>  <span class="co"># Web Mercator for visualization</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>WGS84_CRS <span class="op">=</span> <span class="st">"EPSG:4326"</span>  <span class="co"># WGS84 for API calls</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="co"># File paths</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>BASE_PATH <span class="op">=</span> <span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo"</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>DATA_PATH <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>BASE_PATH<span class="sc">}</span><span class="ss">/notebooks/data"</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>PELIGRO_PATH <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>DATA_PATH<span class="sc">}</span><span class="ss">/la_plata_pelig_2023_datos_originales.geojson"</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>PARTIDOS_PATH <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>DATA_PATH<span class="sc">}</span><span class="ss">/pba_partidos.geojson"</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>CUENCAS_PATH <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>BASE_PATH<span class="sc">}</span><span class="ss">/notebooks/cuencas_buenos_aires.geojson"</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>BUILDINGS_PATH <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>BASE_PATH<span class="sc">}</span><span class="ss">/notebooks/buildings_filtered.parquet"</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>GHSL_PATH <span class="op">=</span> <span class="st">"/home/nissim/Downloads/spatial/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R14_C13/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R14_C13.tif"</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Data URLs</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>RENABAP_URL <span class="op">=</span> (</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.argentina.gob.ar/sites/default/files/renabap-2023-12-06.geojson"</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>PARTIDOS_WFS_URL <span class="op">=</span> <span class="st">"https://geo.arba.gov.ar/geoserver/idera/wfs"</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>CUENCAS_API_URL <span class="op">=</span> <span class="st">"https://services1.arcgis.com/atxllciEI8CHWvwW/ArcGIS/rest/services/Cuencas_BuenosAires_2023/FeatureServer/0/query"</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Data processing constants</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>HAZARD_LEVELS <span class="op">=</span> [<span class="st">"baja"</span>, <span class="st">"media"</span>, <span class="st">"alta"</span>]</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>METHOD_NAMES <span class="op">=</span> [<span class="st">"edificios"</span>, <span class="st">"ghsl"</span>, <span class="st">"areal"</span>]</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>EXPOSURE_COLUMNS <span class="op">=</span> [</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fam_exp_edificios"</span>,</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fam_exp_ghsl"</span>,</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fam_exp_areal"</span>,</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>NON_HAZARD_VALUE <span class="op">=</span> <span class="st">"none"</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>NODATA_VALUE <span class="op">=</span> <span class="op">-</span><span class="dv">200</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Column mappings and renaming</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>COLUMN_MAPPINGS <span class="op">=</span> {</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    <span class="st">"buildings_to_edificios"</span>: {<span class="st">"fam_expuestas_buildings"</span>: <span class="st">"fam_expuestas_edificios"</span>},</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">"method_cleanup_prefix"</span>: <span class="st">"fam_expuestas_"</span>,</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic visualization settings (only for repeated values)</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>DEFAULT_FIGSIZE <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">10</span>)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>MAP_PADDING <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>PLASMA_CMAP <span class="op">=</span> plt.cm.plasma</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="co"># Color schemes for visualization</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>PELIGROSIDAD_COLORS <span class="op">=</span> {</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="st">"alta"</span>: PLASMA_CMAP(<span class="fl">0.8</span>),</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    <span class="st">"media"</span>: PLASMA_CMAP(<span class="fl">0.5</span>),</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="st">"baja"</span>: PLASMA_CMAP(<span class="fl">0.2</span>),</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>METHOD_COLORS <span class="op">=</span> {</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fam_exp_areal"</span>: PLASMA_CMAP(<span class="fl">0.8</span>),</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fam_exp_ghsl"</span>: PLASMA_CMAP(<span class="fl">0.5</span>),</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fam_exp_edificios"</span>: PLASMA_CMAP(<span class="fl">0.2</span>),</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Eje mapping for watershed analysis</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>EJE_MAPPING <span class="op">=</span> {</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="st">"noreste"</span>: [<span class="st">"Area de Bañados"</span>, <span class="st">"Cuenca Arroyo Rodriguez-Don Carlos"</span>],</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    <span class="st">"noroeste"</span>: [<span class="st">"Cuenca Arroyo Martín-Carnaval"</span>, <span class="st">"Cuenca Arroyo Pereyra"</span>],</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    <span class="st">"central"</span>: [<span class="st">"Cuenca Arroyo del Gato"</span>],</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sudoeste"</span>: [<span class="st">"Cuenca A° Maldonado"</span>, <span class="st">"Cuenca Río Samborombón"</span>],</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sudeste"</span>: [<span class="st">"Cuenca Arroyo El Pescado"</span>],</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_base_map(figsize<span class="op">=</span><span class="va">None</span>, bounds<span class="op">=</span><span class="va">None</span>, padding_x<span class="op">=</span><span class="va">None</span>, padding_y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create figure and set up basic map boundaries with padding."""</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> figsize <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>        figsize <span class="op">=</span> DEFAULT_FIGSIZE</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> padding_x <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>        padding_x <span class="op">=</span> MAP_PADDING</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> padding_y <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>        padding_y <span class="op">=</span> MAP_PADDING</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bounds <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>        bounds <span class="op">=</span> renabap_pba_intersect.total_bounds</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert bounds to Web Mercator for basemap compatibility</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bounds <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a temporary GeoDataFrame with the bounds to reproject</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>        temp_bounds <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>            geometry<span class="op">=</span>[box(bounds[<span class="dv">0</span>], bounds[<span class="dv">1</span>], bounds[<span class="dv">2</span>], bounds[<span class="dv">3</span>])], crs<span class="op">=</span>USE_CRS</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        bounds_3857 <span class="op">=</span> temp_bounds.to_crs(WEB_MERCATOR_CRS).total_bounds</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>        bounds_3857 <span class="op">=</span> bounds</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>figsize)</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(bounds_3857[<span class="dv">0</span>] <span class="op">-</span> padding_x, bounds_3857[<span class="dv">2</span>] <span class="op">+</span> padding_x)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(bounds_3857[<span class="dv">1</span>] <span class="op">-</span> padding_y, bounds_3857[<span class="dv">3</span>] <span class="op">+</span> padding_y)</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig, ax</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_basemap(ax, zoom<span class="op">=</span><span class="dv">13</span>):</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add CartoDB basemap to the axes."""</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    ctx.add_basemap(</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>        ax,</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>        source<span class="op">=</span>ctx.providers.CartoDB.PositronNoLabels,</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>        zorder<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>        zoom<span class="op">=</span>zoom,</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_north_arrow(ax, x<span class="op">=</span><span class="fl">0.95</span>, y<span class="op">=</span><span class="fl">0.05</span>, arrow_length<span class="op">=</span><span class="fl">0.04</span>):</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add a north arrow to the map."""</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add north arrow, https://stackoverflow.com/a/58110049/604456</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>    ax.annotate(</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>        <span class="st">"N"</span>,</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>(x, y),</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>        xytext<span class="op">=</span>(x, y <span class="op">-</span> arrow_length),</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>        arrowprops<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">"black"</span>, width<span class="op">=</span><span class="dv">3</span>, headwidth<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>        ha<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>        va<span class="op">=</span><span class="st">"center"</span>,</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>        fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>        xycoords<span class="op">=</span>ax.transAxes,</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_la_plata_outline(ax):</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add the outline of Partido de La Plata to a map."""</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>    la_plata_3857 <span class="op">=</span> la_plata.to_crs(WEB_MERCATOR_CRS)</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>    la_plata_3857.plot(</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>        facecolor<span class="op">=</span><span class="st">"none"</span>,</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>        linestyle<span class="op">=</span><span class="st">"--"</span>,</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>        zorder<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_consistent_map(title, bounds<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create a map with consistent styling and basemap."""</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> setup_base_map(bounds<span class="op">=</span>bounds)</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>    add_basemap(ax)</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>    add_north_arrow(ax)</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>    add_la_plata_outline(ax)</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig, ax</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> wfs_to_gdf(</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>    wfs_url: <span class="bu">str</span>, layer_name: <span class="bu">str</span>, srs: <span class="bu">str</span> <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> gpd.GeoDataFrame:</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a><span class="co">    Descarga una capa WFS y la devuelve como GeoDataFrame.</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a><span class="co">        wfs_url (str): URL del servicio WFS.</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a><span class="co">        layer_name (str): Nombre de la capa (typename).</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a><span class="co">        srs (str): Código EPSG del sistema de referencia de coordenadas.</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a><span class="co">        gpd.GeoDataFrame: Capa descargada como GeoDataFrame.</span></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>    wfs <span class="op">=</span> WebFeatureService(url<span class="op">=</span>wfs_url, version<span class="op">=</span><span class="st">"2.0.0"</span>)</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> wfs.getfeature(typename<span class="op">=</span>layer_name, srsname<span class="op">=</span>srs)</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> gpd.read_file(BytesIO(response.read()))</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gdf</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_exposure_tidy_data(</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>    id_column,</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column,</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>    method_suffix,</span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>    exposure_values,</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a><span class="co">    Create tidy exposure dataset in a standardized format.</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a><span class="co">        data: DataFrame containing the base data</span></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a><span class="co">        id_column: Column name for the identifier (e.g., 'id_renabap', 'Cuenca', 'eje')</span></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a><span class="co">        peligrosidad_column: Column name for hazard level</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a><span class="co">        method_suffix: Suffix for the exposure column (e.g., 'areal', 'ghsl', 'edificios')</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a><span class="co">        exposure_values: Series or array of exposure values matching data rows</span></span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a><span class="co">        exclude_zero: Whether to exclude zero exposure values</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a><span class="co">        pd.DataFrame: Tidy format dataframe with id, peligrosidad, and exposure columns</span></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>    tidy_data <span class="op">=</span> []</span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> idx, (_, row) <span class="kw">in</span> <span class="bu">enumerate</span>(data.iterrows()):</span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>        exposure_value <span class="op">=</span> (</span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>            exposure_values.iloc[idx]</span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">hasattr</span>(exposure_values, <span class="st">"iloc"</span>)</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> exposure_values[idx]</span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> exclude_zero <span class="kw">and</span> exposure_value <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>        tidy_data.append(</span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>                id_column: row[id_column],</span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>                <span class="st">"peligrosidad"</span>: row[peligrosidad_column],</span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"fam_expuestas_</span><span class="sc">{</span>method_suffix<span class="sc">}</span><span class="ss">"</span>: exposure_value,</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(tidy_data)</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_wide_exposure_dataframe(</span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>    areal_data, ghsl_data, buildings_data, id_columns, exclude_hazard_value<span class="op">=</span><span class="st">"none"</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a><span class="co">    Create wide format exposure dataframe by merging tidy datasets.</span></span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a><span class="co">        areal_data: Tidy dataframe with areal interpolation results</span></span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a><span class="co">        ghsl_data: Tidy dataframe with GHSL dasymetric results</span></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a><span class="co">        buildings_data: Tidy dataframe with buildings dasymetric results</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a><span class="co">        id_columns: List of columns to merge on (e.g., ['id_renabap', 'peligrosidad'])</span></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a><span class="co">        exclude_hazard_value: Hazard value to exclude from results</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a><span class="co">        pd.DataFrame: Wide format dataframe with all exposure methods</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter out non-hazard values</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>    areal_filtered <span class="op">=</span> areal_data[areal_data[<span class="st">"peligrosidad"</span>] <span class="op">!=</span> exclude_hazard_value]</span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>    ghsl_filtered <span class="op">=</span> ghsl_data[ghsl_data[<span class="st">"peligrosidad"</span>] <span class="op">!=</span> exclude_hazard_value]</span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>    buildings_filtered <span class="op">=</span> buildings_data[</span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>        buildings_data[<span class="st">"peligrosidad"</span>] <span class="op">!=</span> exclude_hazard_value</span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply column mapping for buildings if needed</span></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"fam_expuestas_buildings"</span> <span class="kw">in</span> buildings_filtered.columns:</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>        buildings_filtered <span class="op">=</span> buildings_filtered.rename(</span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>            columns<span class="op">=</span>{<span class="st">"fam_expuestas_buildings"</span>: <span class="st">"fam_expuestas_edificios"</span>}</span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge all datasets</span></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    wide_data <span class="op">=</span> areal_filtered.merge(ghsl_filtered, on<span class="op">=</span>id_columns, how<span class="op">=</span><span class="st">"outer"</span>).merge(</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>        buildings_filtered, on<span class="op">=</span>id_columns, how<span class="op">=</span><span class="st">"outer"</span></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fill NaN values with 0</span></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    wide_data <span class="op">=</span> wide_data.fillna(<span class="dv">0</span>)</span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename columns to shorter format</span></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>    column_mapping <span class="op">=</span> {</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fam_expuestas_areal"</span>: <span class="st">"fam_exp_areal"</span>,</span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fam_expuestas_ghsl"</span>: <span class="st">"fam_exp_ghsl"</span>, </span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>        <span class="st">"fam_expuestas_edificios"</span>: <span class="st">"fam_exp_edificios"</span></span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>    wide_data <span class="op">=</span> wide_data.rename(columns<span class="op">=</span>column_mapping)</span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wide_data</span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(RENABAP_URL)</span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>renabap <span class="op">=</span> gpd.read_file(StringIO(response.text))</span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>renabap_pba <span class="op">=</span> renabap[renabap[<span class="st">"provincia"</span>] <span class="op">==</span> <span class="st">"Buenos Aires"</span>]</span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>renabap_pba <span class="op">=</span> renabap_pba.to_crs(USE_CRS)</span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>peligro <span class="op">=</span> gpd.read_file(PELIGRO_PATH)</span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>peligro <span class="op">=</span> peligro.to_crs(USE_CRS)</span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>peligro_bounds <span class="op">=</span> peligro.total_bounds</span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>peligro_bbox <span class="op">=</span> box(<span class="op">*</span>peligro_bounds)</span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(PARTIDOS_PATH):</span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>    partidos <span class="op">=</span> gpd.read_file(PARTIDOS_PATH)</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>    partidos <span class="op">=</span> wfs_to_gdf(</span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>        wfs_url<span class="op">=</span>PARTIDOS_WFS_URL,</span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>        layer_name<span class="op">=</span><span class="st">"idera:Departamento"</span>,</span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>        srs<span class="op">=</span><span class="st">"EPSG:5347"</span>,</span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>    partidos.to_file(PARTIDOS_PATH, driver<span class="op">=</span><span class="st">"GeoJSON"</span>)</span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>partidos <span class="op">=</span> partidos.to_crs(USE_CRS)</span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>la_plata <span class="op">=</span> partidos[partidos[<span class="st">"fna"</span>] <span class="op">==</span> <span class="st">"Partido de La Plata"</span>]</span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener la geometría principal</span></span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>main_geom <span class="op">=</span> la_plata.geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a><span class="co"># Si es un MultiPolygon, mantener solo el polígono más grande (el partido principal)</span></span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a><span class="co"># Esto elimina la pequeña isla que aparece en los datos</span></span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> main_geom.geom_type <span class="op">==</span> <span class="st">"MultiPolygon"</span>:</span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener todos los polígonos y mantener el que tenga mayor área</span></span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>    largest_polygon <span class="op">=</span> <span class="bu">max</span>(main_geom.geoms, key<span class="op">=</span><span class="kw">lambda</span> p: p.area)</span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>    la_plata <span class="op">=</span> la_plata.copy()  <span class="co"># Create a copy to avoid SettingWithCopyWarning</span></span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>    la_plata.loc[la_plata.index[<span class="dv">0</span>], <span class="st">"geometry"</span>] <span class="op">=</span> largest_polygon</span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a>la_plata_bbox <span class="op">=</span> la_plata.geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a>renabap_pba_intersect <span class="op">=</span> renabap_pba[</span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>    renabap_pba.geometry.intersects(la_plata_bbox)</span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(CUENCAS_PATH):</span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>    cuencas <span class="op">=</span> gpd.read_file(CUENCAS_PATH)</span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {<span class="st">"where"</span>: <span class="st">"1=1"</span>, <span class="st">"outFields"</span>: <span class="st">"*"</span>, <span class="st">"f"</span>: <span class="st">"geojson"</span>}</span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a>    cuencas_response <span class="op">=</span> requests.get(CUENCAS_API_URL, params<span class="op">=</span>params)</span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(CUENCAS_PATH, <span class="st">"w"</span>, encoding<span class="op">=</span><span class="st">"utf-8"</span>) <span class="im">as</span> f:</span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>        f.write(cuencas_response.text)</span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>    cuencas <span class="op">=</span> gpd.read_file(StringIO(cuencas_response.text))</span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>cuencas <span class="op">=</span> cuencas.to_crs(USE_CRS)</span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>cuencas <span class="op">=</span> cuencas.clip(la_plata)</span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Map watershed names to axes based on the EJE_MAPPING</span></span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a>cuencas[<span class="st">"eje"</span>] <span class="op">=</span> (</span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>    cuencas[<span class="st">"Cuenca"</span>]</span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">map</span>(</span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a>            cuenca: eje</span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> eje, cuencas_list <span class="kw">in</span> EJE_MAPPING.items()</span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> cuenca <span class="kw">in</span> cuencas_list</span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a>    .fillna(<span class="st">"otro"</span>)</span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total area of RENABAP settlements in hectares (POSGAR projection is in meters)</span></span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a>renabap_total_area_ha <span class="op">=</span> (</span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a>    renabap_pba_intersect.geometry.area.<span class="bu">sum</span>() <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a>)  <span class="co"># Convert m² to hectares</span></span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a>la_plata_area_ha <span class="op">=</span> la_plata.geometry.iloc[<span class="dv">0</span>].area <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a>percentage_coverage <span class="op">=</span> (renabap_total_area_ha <span class="op">/</span> la_plata_area_ha) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a><span class="co"># Get common bounds for all maps</span></span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a>common_bounds <span class="op">=</span> la_plata.total_bounds</span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersect settlements with hazard zones</span></span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>settlement_hazard <span class="op">=</span> gpd.overlay(renabap_pba_intersect, peligro, how<span class="op">=</span><span class="st">"intersection"</span>)</span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a>settle_hazard_cuencas <span class="op">=</span> gpd.overlay(</span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a>    settlement_hazard, cuencas, how<span class="op">=</span><span class="st">"intersection"</span>, keep_geom_type<span class="op">=</span><span class="va">True</span></span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<style>
.dt-container {
  font-size: small;
}
</style>
</div>
</div>
<p>Hay un total de 166 barrios populares en el Partido de La Plata, que representan 33888 familias. Estos barrios ocupan 1760 hectáreas del Partido de La Plata, o 2.0 por ciento del partido.</p>
</section>
<section id="fuentes-de-datos" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="fuentes-de-datos"><span class="header-section-number">3.4</span> Fuentes de datos</h2>
<section id="renabap" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="renabap"><span class="header-section-number">3.4.1</span> RENABAP</h3>
<p>El Registro Nacional de Barrios Populares (RENABAP) es producido por la Subsecretaría de Integración Socio Urbana y proporciona información sobre asentamientos informales en Argentina, incluyendo estimaciones de población y delimitaciones geográficas de estos barrios. Más información sobre el RENABAP está disponible en el <a href="https://www.argentina.gob.ar/obras-publicas/sisu/renabap/observatorio-de-barrios-populares">Observatorio de Barrios Populares</a>. Los datos fueron obtenidos a través del <a href="https://www.argentina.gob.ar/obras-publicas/sisu/renabap/mapa">Mapa de Barrios Populares</a> y están disponibles para <a href="https://www.argentina.gob.ar/sites/default/files/renabap-2023-12-06.geojson">descarga como GeoJSON</a>.</p>
</section>
<section id="ghsl" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="ghsl"><span class="header-section-number">3.4.2</span> GHSL</h3>
<p>La <a href="https://human-settlement.emergency.copernicus.eu/ghs_pop2023.php">Capa Global de Asentamientos Humanos (Global Human Settlement Layer)</a> <span class="citation" data-cites="ghsl_pop2023a">(<a href="references.html#ref-ghsl_pop2023a" role="doc-biblioref">Schiavina et al. 2023</a>)</span> es un conjunto de datos de resolución de 100 metros que proporciona estimaciones de población multitemporales (1975-2030) derivadas de datos censales y administrativos, informadas por la distribución y clasificación de áreas construidas. El GHSL ya tiene un uso científico establecido para mapear la exposición poblacional a peligros de inundación <span class="citation" data-cites="tellman2021">(<a href="references.html#ref-tellman2021" role="doc-biblioref">Tellman et al. 2021</a>)</span>. Sin embargo, esta fuente presenta limitaciones importantes: estudios sobre modelado de riesgo de inundación con conjuntos de datos globales han demostrado que evaluar la exposición a esta escala de resolución puede llevar a sobreestimaciones de la exposición poblacional en zonas de peligro de inundación en comparación con datos de mayor resolución <span class="citation" data-cites="smith2019">(<a href="references.html#ref-smith2019" role="doc-biblioref">Smith et al. 2019</a>)</span>.</p>
<div id="1e0dcd86" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load GHSL data with dask chunking for memory efficiency</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ghsl <span class="op">=</span> rioxarray.open_rasterio(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    GHSL_PATH,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{<span class="st">"x"</span>: <span class="dv">1024</span>, <span class="st">"y"</span>: <span class="dv">1024</span>},  <span class="co"># Adjust chunk size based on your memory constraints</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>ghsl <span class="op">=</span> ghsl.rio.reproject(dst_crs<span class="op">=</span>USE_CRS)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>ghsl_clipped <span class="op">=</span> ghsl.rio.clip(</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    [la_plata.geometry.iloc[<span class="dv">0</span>]],</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    from_disk<span class="op">=</span><span class="va">True</span>,  <span class="co"># Process from disk to avoid loading entire dataset into memory</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="peligro-de-inundación" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="peligro-de-inundación"><span class="header-section-number">3.4.3</span> Peligro de inundación</h3>
<p>Los datos de peligro de inundación utilizados en este análisis fueron desarrollados por la Facultad de Ingeniería de la Universidad Nacional de La Plata como parte del Plan de Reducción del Riesgo por Inundaciones en la Región de La Plata <span class="citation" data-cites="romanazzi2019">(<a href="references.html#ref-romanazzi2019" role="doc-biblioref">Romanazzi et al. 2019</a>)</span>. Estos datos fueron generados mediante la aplicación del modelo hidrológico-hidráulico bidimensional FLO-2D, que permitió simular la dinámica de inundación de todas las cuencas del partido de La Plata para distintos escenarios de eventos pluviométricos extremos. El modelo calcula las principales variables hidráulicas (altura del agua, velocidad y caudal) a lo largo del tiempo, y a partir de estos resultados se generaron los mapas de peligrosidad que combinan el efecto de la profundidad con la velocidad de la corriente, ofreciendo un indicador más completo que los mapas tradicionales de máximas profundidades.</p>
</section>
<section id="google-microsoft-osm-open-buildings" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="google-microsoft-osm-open-buildings"><span class="header-section-number">3.4.4</span> Google-Microsoft-OSM Open Buildings</h3>
<p>Los datos de <a href="https://source.coop/repositories/vida/google-microsoft-osm-open-buildings/access">Google-Microsoft-OSM Open Buildings - combined by VIDA</a> <span class="citation" data-cites="google_microsoft_osm_buildings">(<a href="references.html#ref-google_microsoft_osm_buildings" role="doc-biblioref">VIDA 2023</a>)</span> representan una forma más precisa de evaluar dónde se ubican los asentamientos humanos. Este conjunto de datos combina Google’s V3 Open Buildings, Microsoft’s GlobalMLFootprints, y OpenStreetMap building footprints, conteniendo más de 2.7 mil millones de huellas de edificios. Estos datos han sido <a href="https://www.ice.com/insights/sustainable-finance/ice-climates-exposure-datasets-understanding-how-climate-risks-impact-infrastructure-and-communities">exitosamente aplicados a evaluaciones de riesgo de inundación por empresas globales de riesgo financiero como ICE</a>, demostrando su utilidad para mapear la exposición climática a nivel de huella de edificio individual. Sin embargo, en ausencia de información sobre si los edificios son residenciales o tienen otros usos, y sin datos sobre el número total de unidades en el edificio y habitantes por edificio, solo podemos obtener estimaciones proporcionales aproximadas de dónde se ubican las personas, sin tener una comprensión precisa de quién vive realmente allí y cuántas personas.</p>
<div id="934fca6a" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_buildings(geodataframe, temp_file<span class="op">=</span><span class="st">"buildings_filtered.parquet"</span>):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Fetch building data for a given GeoDataFrame region"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get S2 cell and bounds</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    center <span class="op">=</span> geodataframe.to_crs(WEB_MERCATOR_CRS).union_all().centroid</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    center_wgs84 <span class="op">=</span> (</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        gpd.GeoDataFrame(geometry<span class="op">=</span>[center], crs<span class="op">=</span>WEB_MERCATOR_CRS)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        .to_crs(WGS84_CRS)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        .geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    cell <span class="op">=</span> s2sphere.CellId.from_lat_lng(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        s2sphere.LatLng.from_degrees(center_wgs84.y, center_wgs84.x)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    ).parent(<span class="dv">10</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> geodataframe.to_crs(WGS84_CRS).total_bounds</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find matching S2 partition</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    s3 <span class="op">=</span> boto3.client(</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"s3"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        endpoint_url<span class="op">=</span><span class="st">"https://data.source.coop"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        aws_access_key_id<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        aws_secret_access_key<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>Config(s3<span class="op">=</span>{<span class="st">"addressing_style"</span>: <span class="st">"path"</span>}),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    partitions <span class="op">=</span> {</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        obj[<span class="st">"Key"</span>].split(<span class="st">"/"</span>)[<span class="op">-</span><span class="dv">1</span>].replace(<span class="st">".parquet"</span>, <span class="st">""</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> obj <span class="kw">in</span> s3.list_objects_v2(</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            Bucket<span class="op">=</span><span class="st">"vida"</span>,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            Prefix<span class="op">=</span><span class="st">"google-microsoft-osm-open-buildings/geoparquet/by_country_s2/country_iso=ARG/"</span>,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        ).get(<span class="st">"Contents"</span>, [])</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    parent_id <span class="op">=</span> <span class="bu">next</span>(</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(cell.parent(level).<span class="bu">id</span>())</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> level <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">str</span>(cell.parent(level).<span class="bu">id</span>()) <span class="kw">in</span> partitions</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Setup DuckDB and query</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    con <span class="op">=</span> duckdb.<span class="ex">connect</span>()</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cmd <span class="kw">in</span> [</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"INSTALL spatial"</span>,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LOAD spatial"</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"INSTALL httpfs"</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LOAD httpfs"</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SET s3_region='us-east-1'"</span>,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SET s3_endpoint='data.source.coop'"</span>,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SET s3_use_ssl=true"</span>,</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SET s3_url_style='path'"</span>,</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    ]:</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        con.execute(cmd)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Export and read back</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="ss">    COPY (SELECT * FROM 's3://vida/google-microsoft-osm-open-buildings/geoparquet/by_country_s2/country_iso=ARG/</span><span class="sc">{</span>parent_id<span class="sc">}</span><span class="ss">.parquet'</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="ss">          WHERE bbox.xmax &gt;= </span><span class="sc">{</span>bounds[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> AND bbox.xmin &lt;= </span><span class="sc">{</span>bounds[<span class="dv">2</span>]<span class="sc">}</span><span class="ss"> AND</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="ss">                bbox.ymax &gt;= </span><span class="sc">{</span>bounds[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> AND bbox.ymin &lt;= </span><span class="sc">{</span>bounds[<span class="dv">3</span>]<span class="sc">}</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="ss">    ) TO '</span><span class="sc">{</span>temp_file<span class="sc">}</span><span class="ss">' (FORMAT PARQUET);</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    con.execute(query)</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_parquet(temp_file)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"geometry"</span>] <span class="op">=</span> gpd.GeoSeries.from_wkb(df[<span class="st">"geometry"</span>])</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gpd.GeoDataFrame(df, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span>WGS84_CRS)</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> os.path.exists(BUILDINGS_PATH):</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    buildings <span class="op">=</span> gpd.read_parquet(BUILDINGS_PATH)</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    buildings <span class="op">=</span> fetch_buildings(renabap_pba_intersect)</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>buildings_proj <span class="op">=</span> buildings.to_crs(USE_CRS)</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>buildings_proj <span class="op">=</span> buildings_proj.clip(la_plata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> create_consistent_map(<span class="st">"Asentamientos RENABAP en La Plata"</span>, common_bounds)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>renabap_pba_intersect_3857 <span class="op">=</span> renabap_pba_intersect.to_crs(WEB_MERCATOR_CRS)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>renabap_pba_intersect_3857.plot(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax1, facecolor<span class="op">=</span><span class="st">"none"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="va">False</span>, zorder<span class="op">=</span><span class="dv">10</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>peligro_clipped <span class="op">=</span> gpd.clip(peligro, la_plata)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>peligro_clipped_3857 <span class="op">=</span> peligro_clipped.to_crs(WEB_MERCATOR_CRS)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the categories so they map correctly to plasma colormap</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>peligro_clipped_3857[<span class="st">"PELIGROSID_ordered"</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    peligro_clipped_3857[<span class="st">"PELIGROSID"</span>],</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">"baja"</span>, <span class="st">"media"</span>, <span class="st">"alta"</span>],</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    ordered<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> create_consistent_map(<span class="st">"Zonas de Peligro en La Plata"</span>, common_bounds)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>peligro_clipped_3857.plot(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax2,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">"PELIGROSID_ordered"</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">"plasma"</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.75</span>,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    zorder<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>fig3, ax3 <span class="op">=</span> create_consistent_map(<span class="st">"Datos de población GHSL"</span>, common_bounds)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>ghsl_masked <span class="op">=</span> ma.masked_where(ghsl_clipped.values[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>, ghsl_clipped.values[<span class="dv">0</span>])</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>ghsl_valid <span class="op">=</span> (ghsl_clipped.values[<span class="dv">0</span>] <span class="op">!=</span> NODATA_VALUE) <span class="op">&amp;</span> (ghsl_clipped.values[<span class="dv">0</span>] <span class="op">!=</span> <span class="dv">0</span>)</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>ghsl_valid_data <span class="op">=</span> ghsl_clipped.values[<span class="dv">0</span>][ghsl_valid]</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>plasma_cmap <span class="op">=</span> PLASMA_CMAP</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>ghsl_clipped_3857 <span class="op">=</span> ghsl_clipped.rio.reproject(WEB_MERCATOR_CRS)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask out zeros AND nodata values</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>ghsl_masked_3857 <span class="op">=</span> ma.masked_where(</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    (ghsl_clipped_3857.values[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">|</span> (ghsl_clipped_3857.values[<span class="dv">0</span>] <span class="op">==</span> NODATA_VALUE),</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    ghsl_clipped_3857.values[<span class="dv">0</span>],</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> ax3.imshow(</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    ghsl_masked_3857,</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    extent<span class="op">=</span>[</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>        ghsl_clipped_3857.x.<span class="bu">min</span>(),</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>        ghsl_clipped_3857.x.<span class="bu">max</span>(),</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>        ghsl_clipped_3857.y.<span class="bu">min</span>(),</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>        ghsl_clipped_3857.y.<span class="bu">max</span>(),</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>plasma_cmap,</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.75</span>,</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>fig4, ax4 <span class="op">=</span> create_consistent_map(<span class="st">"Huellas de edificios"</span>, common_bounds)</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>buildings_3857 <span class="op">=</span> buildings_proj.to_crs(WEB_MERCATOR_CRS)</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>buildings_3857.plot(ax<span class="op">=</span>ax4, facecolor<span class="op">=</span><span class="st">"grey"</span>, edgecolor<span class="op">=</span><span class="st">"none"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-fuentes-datos" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fuentes-datos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-fuentes-datos" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-fuentes-datos-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-fuentes-datos-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-fuentes-datos-output-1.png" class="lightbox" data-gallery="fig-fuentes-datos" title="Figure&nbsp;3.1&nbsp;(a): Asentamientos RENABAP en La Plata"><img src="renabap_files/figure-html/fig-fuentes-datos-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-fuentes-datos"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-fuentes-datos-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Asentamientos RENABAP en La Plata
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-fuentes-datos" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-fuentes-datos-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-fuentes-datos-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-fuentes-datos-output-2.png" class="lightbox" data-gallery="fig-fuentes-datos" title="Figure&nbsp;3.1&nbsp;(b): Zonas de Peligro en La Plata"><img src="renabap_files/figure-html/fig-fuentes-datos-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-fuentes-datos"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-fuentes-datos-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Zonas de Peligro en La Plata
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-fuentes-datos" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-fuentes-datos-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-fuentes-datos-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-fuentes-datos-output-3.png" class="lightbox" data-gallery="fig-fuentes-datos" title="Figure&nbsp;3.1&nbsp;(c): Datos de población GHSL"><img src="renabap_files/figure-html/fig-fuentes-datos-output-3.png" class="img-fluid figure-img" data-ref-parent="fig-fuentes-datos"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-fuentes-datos-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Datos de población GHSL
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-fuentes-datos" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-fuentes-datos-4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-fuentes-datos-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-fuentes-datos-output-4.png" class="lightbox" data-gallery="fig-fuentes-datos" title="Figure&nbsp;3.1&nbsp;(d): Huellas de edificios"><img src="renabap_files/figure-html/fig-fuentes-datos-output-4.png" class="img-fluid figure-img" data-ref-parent="fig-fuentes-datos"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-fuentes-datos-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Huellas de edificios
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fuentes-datos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Fuentes de datos para análisis de exposición
</figcaption>
</figure>
</div>
</section>
</section>
<section id="metodología-y-procesamiento" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="metodología-y-procesamiento"><span class="header-section-number">3.5</span> Metodología y procesamiento</h2>
<section id="interpolación-por-area" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="interpolación-por-area"><span class="header-section-number">3.5.1</span> Interpolación por area</h3>
<p>La <a href="https://pysal.org/tobler/notebooks/01_interpolation_methods_overview.html">interpolación areal</a> es un método simple en el que las variables de los datos fuente se ponderan según la superposición entre polígonos fuente y objetivo, luego se reagregan para ajustarse a las geometrías de los polígonos objetivo. En nuestro análisis, esto significa distribuir proporcionalmente la población de cada barrio popular según el área de intersección con diferentes niveles de peligro de inundación. El analasis original de la exposición poblacional a peligros de inundación en la región del Partido de La Plata se realizó utilizando este método.</p>
<div id="49ccc1ab" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> renabap_pba_intersect.crs <span class="op">!=</span> peligro.crs:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    peligro <span class="op">=</span> peligro.to_crs(renabap_pba_intersect.crs)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>hazard_levels <span class="op">=</span> peligro[<span class="st">"PELIGROSID"</span>].unique()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>renabap_with_porciones <span class="op">=</span> renabap_pba_intersect.copy()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level <span class="kw">in</span> hazard_levels:</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    renabap_with_porciones[<span class="ss">f"porcion_</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>renabap_with_porciones[<span class="st">"total_area"</span>] <span class="op">=</span> renabap_with_porciones.geometry.area</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, barrio <span class="kw">in</span> renabap_with_porciones.iterrows():</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    barrio_geom <span class="op">=</span> barrio.geometry</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    barrio_total_area <span class="op">=</span> barrio_geom.area</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> barrio_total_area <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> level <span class="kw">in</span> hazard_levels:</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        hazard_subset <span class="op">=</span> peligro[peligro[<span class="st">"PELIGROSID"</span>] <span class="op">==</span> level]</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> hazard_subset.empty:</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        intersection_area <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, hazard_row <span class="kw">in</span> hazard_subset.iterrows():</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                intersection <span class="op">=</span> barrio_geom.intersection(hazard_row.geometry)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> intersection.is_empty:</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                    intersection_area <span class="op">+=</span> intersection.area</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f"Error calculating intersection for </span><span class="sc">{</span>barrio<span class="sc">.</span>get(<span class="st">'nombre_barrio'</span>, idx)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        proportion <span class="op">=</span> (</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>            intersection_area <span class="op">/</span> barrio_total_area <span class="cf">if</span> barrio_total_area <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        renabap_with_porciones.at[idx, <span class="ss">f"porcion_</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> proportion</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Create barrio tidy format using consolidated function</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>barrio_areal_rows <span class="op">=</span> []</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> renabap_with_porciones.iterrows():</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> level <span class="kw">in</span> hazard_levels:</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        familias_expuestas <span class="op">=</span> row[<span class="ss">f"porcion_</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">"</span>] <span class="op">*</span> row[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> familias_expuestas <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>            barrio_areal_rows.append(</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"id_renabap"</span>: row[<span class="st">"id_renabap"</span>],</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"PELIGROSID"</span>: level,</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"fam_expuestas"</span>: familias_expuestas,</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>barrio_areal_temp <span class="op">=</span> pd.DataFrame(barrio_areal_rows)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>barrio_areal_tidy <span class="op">=</span> create_exposure_tidy_data(</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>barrio_areal_temp,</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    id_column<span class="op">=</span><span class="st">"id_renabap"</span>,</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column<span class="op">=</span><span class="st">"PELIGROSID"</span>,</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    method_suffix<span class="op">=</span><span class="st">"areal"</span>,</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    exposure_values<span class="op">=</span>barrio_areal_temp[<span class="st">"fam_expuestas"</span>],</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. CUENCA AREAL EXPOSURE - aggregate from barrio level, avoiding double counting</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the cuenca for each settlement - but handle settlements that cross cuenca boundaries</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>settlement_cuenca_mapping <span class="op">=</span> settle_hazard_cuencas[</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"id_renabap"</span>, <span class="st">"Cuenca"</span>]</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>].drop_duplicates()</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if any settlements appear in multiple cuencas</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>settlement_counts <span class="op">=</span> settlement_cuenca_mapping[<span class="st">"id_renabap"</span>].value_counts()</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>multi_cuenca_settlements <span class="op">=</span> settlement_counts[settlement_counts <span class="op">&gt;</span> <span class="dv">1</span>].index</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(multi_cuenca_settlements) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For settlements in multiple cuencas, assign to the cuenca with largest intersection</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For now, just take the first occurrence</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    settlement_cuenca_mapping <span class="op">=</span> settlement_cuenca_mapping.drop_duplicates(</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>        subset<span class="op">=</span>[<span class="st">"id_renabap"</span>], keep<span class="op">=</span><span class="st">"first"</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>cuenca_areal_tidy <span class="op">=</span> barrio_areal_tidy[</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    barrio_areal_tidy[<span class="st">"peligrosidad"</span>] <span class="op">!=</span> NON_HAZARD_VALUE</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>].merge(settlement_cuenca_mapping, on<span class="op">=</span><span class="st">"id_renabap"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>cuenca_areal_tidy <span class="op">=</span> (</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    cuenca_areal_tidy.groupby([<span class="st">"Cuenca"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas_areal"</span>]</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. EJE AREAL EXPOSURE - same fix</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>cuenca_eje_mapping <span class="op">=</span> settle_hazard_cuencas[[<span class="st">"Cuenca"</span>, <span class="st">"eje"</span>]].drop_duplicates()</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>eje_areal_tidy <span class="op">=</span> cuenca_areal_tidy.merge(cuenca_eje_mapping, on<span class="op">=</span><span class="st">"Cuenca"</span>)</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>eje_areal_tidy <span class="op">=</span> (</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>    eje_areal_tidy.groupby([<span class="st">"eje"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas_areal"</span>]</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mapeo-dasymetrico" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="mapeo-dasymetrico"><span class="header-section-number">3.5.2</span> Mapeo dasymetrico</h3>
<p>El <a href="https://support.esri.com/en-us/gis-dictionary/dasymetric-mapping">mapeo dasimétrico</a> reorganiza datos cartográficos de una unidad de recolección en áreas más precisas, modificando los límites originales usando datos de apoyo relacionados. Por ejemplo, un atributo de población organizado por tracto censal se vuelve más significativo cuando se eliminan áreas donde es razonable inferir que la gente no vive (cuerpos de agua, terrenos vacíos). En nuestro caso, utilizamos datos GHSL y huellas de edificios como información auxiliar para mejorar la precisión de las estimaciones de distribución poblacional.</p>
<div id="c39e2ad4" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">### BUILDINGS</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get ALL buildings per settlement (not just hazard-intersected ones)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>buildings_settlement <span class="op">=</span> gpd.overlay(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    buildings_proj, renabap_pba_intersect, how<span class="op">=</span><span class="st">"intersection"</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>total_buildings_per_settlement <span class="op">=</span> (</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    buildings_settlement.groupby(<span class="st">"id_renabap"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"total_buildings"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Get buildings intersected with hazard zones</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>buildings_hazard <span class="op">=</span> gpd.overlay(</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    buildings_proj, settle_hazard_cuencas, how<span class="op">=</span><span class="st">"intersection"</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Buildings per barrio-hazard (including non-hazard areas)</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>buildings_barrio_hazard <span class="op">=</span> (</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    buildings_hazard.groupby([<span class="st">"id_renabap"</span>, <span class="st">"PELIGROSID"</span>])</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"buildings_count"</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ratios using TOTAL buildings per settlement (not just hazard buildings)</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>barrio_ratios <span class="op">=</span> buildings_barrio_hazard.merge(</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    total_buildings_per_settlement, on<span class="op">=</span><span class="st">"id_renabap"</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>barrio_ratios[<span class="st">"ratio"</span>] <span class="op">=</span> (</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    barrio_ratios[<span class="st">"buildings_count"</span>] <span class="op">/</span> barrio_ratios[<span class="st">"total_buildings"</span>]</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>barrio_pop <span class="op">=</span> renabap_pba_intersect[</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"id_renabap"</span>, <span class="st">"familias_aproximadas"</span>]</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>].drop_duplicates()</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>barrio_exposure <span class="op">=</span> barrio_ratios.merge(barrio_pop, on<span class="op">=</span><span class="st">"id_renabap"</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>barrio_exposure[<span class="st">"fam_expuestas"</span>] <span class="op">=</span> (</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    barrio_exposure[<span class="st">"ratio"</span>] <span class="op">*</span> barrio_exposure[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Add non-hazard population for each settlement</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>settlements_with_hazards <span class="op">=</span> barrio_exposure[<span class="st">"id_renabap"</span>].unique()</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>all_settlements <span class="op">=</span> total_buildings_per_settlement[<span class="st">"id_renabap"</span>].unique()</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> settlement <span class="kw">in</span> all_settlements:</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> settlement <span class="kw">in</span> settlements_with_hazards:</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate non-hazard population</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        hazard_pop <span class="op">=</span> barrio_exposure[barrio_exposure[<span class="st">"id_renabap"</span>] <span class="op">==</span> settlement][</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">"fam_expuestas"</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        ].<span class="bu">sum</span>()</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        total_pop <span class="op">=</span> barrio_pop[barrio_pop[<span class="st">"id_renabap"</span>] <span class="op">==</span> settlement][</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">"familias_aproximadas"</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>        ].iloc[<span class="dv">0</span>]</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>        non_hazard_pop <span class="op">=</span> total_pop <span class="op">-</span> hazard_pop</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> non_hazard_pop <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>            barrio_exposure <span class="op">=</span> pd.concat(</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>                [</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>                    barrio_exposure,</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>                    pd.DataFrame(</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>                        [</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>                            {</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"id_renabap"</span>: settlement,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"PELIGROSID"</span>: <span class="st">"none"</span>,</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"buildings_count"</span>: <span class="dv">0</span>,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"total_buildings"</span>: total_buildings_per_settlement[</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>                                    total_buildings_per_settlement[<span class="st">"id_renabap"</span>]</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>                                    <span class="op">==</span> settlement</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>                                ][<span class="st">"total_buildings"</span>].iloc[<span class="dv">0</span>],</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"ratio"</span>: (</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>                                    total_buildings_per_settlement[</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>                                        total_buildings_per_settlement[<span class="st">"id_renabap"</span>]</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>                                        <span class="op">==</span> settlement</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>                                    ][<span class="st">"total_buildings"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>                                    <span class="op">-</span> buildings_hazard[</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>                                        buildings_hazard[<span class="st">"id_renabap"</span>] <span class="op">==</span> settlement</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>                                    ].shape[<span class="dv">0</span>]</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>                                )</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>                                <span class="op">/</span> total_buildings_per_settlement[</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>                                    total_buildings_per_settlement[<span class="st">"id_renabap"</span>]</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>                                    <span class="op">==</span> settlement</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>                                ][<span class="st">"total_buildings"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> total_buildings_per_settlement[</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>                                    total_buildings_per_settlement[<span class="st">"id_renabap"</span>]</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>                                    <span class="op">==</span> settlement</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>                                ][<span class="st">"total_buildings"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>                                <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">else</span> <span class="dv">0</span>,</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"familias_aproximadas"</span>: total_pop,</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"fam_expuestas"</span>: non_hazard_pop,</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>                            }</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>                        ]</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>                    ),</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>                ignore_index<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Settlement with no hazard intersection - all population is non-hazard</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>        total_pop <span class="op">=</span> barrio_pop[barrio_pop[<span class="st">"id_renabap"</span>] <span class="op">==</span> settlement][</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>            <span class="st">"familias_aproximadas"</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>        ].iloc[<span class="dv">0</span>]</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>        barrio_exposure <span class="op">=</span> pd.concat(</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>            [</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>                barrio_exposure,</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>                pd.DataFrame(</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>                    [</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>                        {</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"id_renabap"</span>: settlement,</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"PELIGROSID"</span>: <span class="st">"none"</span>,</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"buildings_count"</span>: <span class="dv">0</span>,</span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"total_buildings"</span>: total_buildings_per_settlement[</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>                                total_buildings_per_settlement[<span class="st">"id_renabap"</span>]</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>                                <span class="op">==</span> settlement</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>                            ][<span class="st">"total_buildings"</span>].iloc[<span class="dv">0</span>],</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"ratio"</span>: <span class="fl">1.0</span>,</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"familias_aproximadas"</span>: total_pop,</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"fam_expuestas"</span>: total_pop,</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>                        }</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>                    ]</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>            ],</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>            ignore_index<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Create buildings tidy dataframe for barrio level using consolidated function</span></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>buildings_barrio_tidy <span class="op">=</span> create_exposure_tidy_data(</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>barrio_exposure,</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>    id_column<span class="op">=</span><span class="st">"id_renabap"</span>,</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column<span class="op">=</span><span class="st">"PELIGROSID"</span>,</span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>    method_suffix<span class="op">=</span><span class="st">"buildings"</span>,</span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>    exposure_values<span class="op">=</span>barrio_exposure[<span class="st">"fam_expuestas"</span>],</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">False</span>,  <span class="co"># Keep all values including zeros for completeness</span></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Cuenca exposure - using total buildings across all settlements in cuenca</span></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>buildings_cuenca_hazard <span class="op">=</span> (</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>    buildings_hazard.groupby([<span class="st">"Cuenca"</span>, <span class="st">"PELIGROSID"</span>])</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"buildings_count"</span>)</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>buildings_cuenca_total <span class="op">=</span> (</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>    buildings_settlement.merge(</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>        settle_hazard_cuencas[[<span class="st">"id_renabap"</span>, <span class="st">"Cuenca"</span>]].drop_duplicates(),</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>        on<span class="op">=</span><span class="st">"id_renabap"</span>,</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"Cuenca"</span>)</span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"total_buildings_all"</span>)</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>cuenca_ratios <span class="op">=</span> buildings_cuenca_hazard.merge(buildings_cuenca_total, on<span class="op">=</span><span class="st">"Cuenca"</span>)</span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a>cuenca_ratios[<span class="st">"ratio"</span>] <span class="op">=</span> (</span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>    cuenca_ratios[<span class="st">"buildings_count"</span>] <span class="op">/</span> cuenca_ratios[<span class="st">"total_buildings_all"</span>]</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>cuenca_pop <span class="op">=</span> (</span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>    settle_hazard_cuencas.drop_duplicates(<span class="st">"id_renabap"</span>)</span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"Cuenca"</span>)[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>cuenca_exposure <span class="op">=</span> cuenca_ratios.merge(cuenca_pop, on<span class="op">=</span><span class="st">"Cuenca"</span>)</span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>cuenca_exposure[<span class="st">"fam_expuestas"</span>] <span class="op">=</span> (</span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>    cuenca_exposure[<span class="st">"ratio"</span>] <span class="op">*</span> cuenca_exposure[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Create buildings tidy dataframe for cuenca level using consolidated function</span></span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>buildings_cuenca_tidy <span class="op">=</span> create_exposure_tidy_data(</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>cuenca_exposure,</span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>    id_column<span class="op">=</span><span class="st">"Cuenca"</span>,</span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column<span class="op">=</span><span class="st">"PELIGROSID"</span>,</span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>    method_suffix<span class="op">=</span><span class="st">"buildings"</span>,</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>    exposure_values<span class="op">=</span>cuenca_exposure[<span class="st">"fam_expuestas"</span>],</span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Eje exposure - using total buildings across all settlements in eje</span></span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>buildings_eje_hazard <span class="op">=</span> (</span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>    buildings_hazard.groupby([<span class="st">"eje"</span>, <span class="st">"PELIGROSID"</span>])</span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"buildings_count"</span>)</span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a>buildings_eje_total <span class="op">=</span> (</span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a>    buildings_settlement.merge(</span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>        settle_hazard_cuencas[[<span class="st">"id_renabap"</span>, <span class="st">"eje"</span>]].drop_duplicates(), on<span class="op">=</span><span class="st">"id_renabap"</span></span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"eje"</span>)</span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"total_buildings_all"</span>)</span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>eje_ratios <span class="op">=</span> buildings_eje_hazard.merge(buildings_eje_total, on<span class="op">=</span><span class="st">"eje"</span>)</span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a>eje_ratios[<span class="st">"ratio"</span>] <span class="op">=</span> eje_ratios[<span class="st">"buildings_count"</span>] <span class="op">/</span> eje_ratios[<span class="st">"total_buildings_all"</span>]</span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a>eje_pop <span class="op">=</span> (</span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>    settle_hazard_cuencas.drop_duplicates(<span class="st">"id_renabap"</span>)</span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"eje"</span>)[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a>eje_exposure <span class="op">=</span> eje_ratios.merge(eje_pop, on<span class="op">=</span><span class="st">"eje"</span>)</span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>eje_exposure[<span class="st">"fam_expuestas"</span>] <span class="op">=</span> (</span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a>    eje_exposure[<span class="st">"ratio"</span>] <span class="op">*</span> eje_exposure[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Create buildings tidy dataframe for eje level using consolidated function</span></span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a>buildings_eje_tidy <span class="op">=</span> create_exposure_tidy_data(</span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>eje_exposure,</span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>    id_column<span class="op">=</span><span class="st">"eje"</span>,</span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column<span class="op">=</span><span class="st">"PELIGROSID"</span>,</span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>    method_suffix<span class="op">=</span><span class="st">"buildings"</span>,</span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>    exposure_values<span class="op">=</span>eje_exposure[<span class="st">"fam_expuestas"</span>],</span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a><span class="co">### GHSL </span></span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to the format expected by rasterstats</span></span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>geometries <span class="op">=</span> [geom <span class="cf">for</span> geom <span class="kw">in</span> renabap_pba_intersect.geometry]</span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Use rasterstats for vectorized zonal statistics</span></span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> rasterstats.zonal_stats(</span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a>    geometries,</span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a>    ghsl_clipped.values[<span class="dv">0</span>],  <span class="co"># rasterstats expects 2D array</span></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a>    affine<span class="op">=</span>ghsl_clipped.rio.transform(),</span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a>    stats<span class="op">=</span>[<span class="st">"sum"</span>],</span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=</span>ghsl_clipped.rio.nodata,</span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the sum values</span></span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a>ghsl_totals <span class="op">=</span> [stat[<span class="st">"sum"</span>] <span class="cf">if</span> stat[<span class="st">"sum"</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> stat <span class="kw">in</span> stats]</span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the GHSL population estimates as a new column</span></span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a>renabap_pba_intersect[<span class="st">"ghsl_pop_est"</span>] <span class="op">=</span> ghsl_totals</span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the reference raster properties from GHSL data</span></span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a>reference_raster <span class="op">=</span> ghsl_clipped</span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a>reference_transform <span class="op">=</span> reference_raster.rio.transform()</span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a>reference_crs <span class="op">=</span> reference_raster.rio.crs</span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a>reference_shape <span class="op">=</span> reference_raster.shape[<span class="dv">1</span>:]  <span class="co"># Get 2D shape (height, width)</span></span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare geometries and values for rasterization</span></span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a>geometries_ghsl <span class="op">=</span> [</span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a>    (geom, value)</span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>        renabap_pba_intersect.geometry, renabap_pba_intersect[<span class="st">"ghsl_pop_est"</span>]</span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>geometries_familias <span class="op">=</span> [</span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a>    (geom, value)</span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>        renabap_pba_intersect.geometry, renabap_pba_intersect[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a><span class="co"># Create GHSL population raster</span></span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>ghsl_pop_raster <span class="op">=</span> rasterize(</span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a>    geometries_ghsl,</span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>reference_shape,</span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>reference_transform,</span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>np.float32,</span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>    all_touched<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a><span class="co"># Create familias aproximadas raster</span></span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a>familias_raster <span class="op">=</span> rasterize(</span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>    geometries_familias,</span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>reference_shape,</span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>reference_transform,</span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>np.float32,</span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a>    all_touched<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Divide original GHSL by the barrio-level GHSL to get fractional population</span></span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a><span class="co"># Use masking to avoid division on invalid cells</span></span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> (ghsl_clipped.values[<span class="dv">0</span>] <span class="op">!=</span> NODATA_VALUE) <span class="op">&amp;</span> (ghsl_pop_raster <span class="op">&gt;</span> <span class="fl">0.1</span>)</span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a>ghsl_fractional <span class="op">=</span> np.full_like(ghsl_clipped.values[<span class="dv">0</span>], NODATA_VALUE, dtype<span class="op">=</span>np.float64)</span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a>ghsl_fractional[mask] <span class="op">=</span> ghsl_clipped.values[<span class="dv">0</span>][mask] <span class="op">/</span> ghsl_pop_raster[mask]</span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Multiply fractional population by familias aproximadas to get downscaled data</span></span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a>mask2 <span class="op">=</span> (ghsl_fractional <span class="op">!=</span> NODATA_VALUE) <span class="op">&amp;</span> (familias_raster <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a>familias_downscaled <span class="op">=</span> np.full_like(</span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a>    ghsl_clipped.values[<span class="dv">0</span>], NODATA_VALUE, dtype<span class="op">=</span>np.float64</span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a>familias_downscaled[mask2] <span class="op">=</span> ghsl_fractional[mask2] <span class="op">*</span> familias_raster[mask2]</span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the results - exclude NODATA_VALUE from range calculations</span></span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a>ghsl_valid <span class="op">=</span> ghsl_clipped.values[<span class="dv">0</span>] <span class="op">!=</span> NODATA_VALUE</span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>fractional_valid <span class="op">=</span> ghsl_fractional <span class="op">!=</span> NODATA_VALUE</span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a>downscaled_valid <span class="op">=</span> familias_downscaled <span class="op">!=</span> NODATA_VALUE</span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a><span class="co"># GHSL downscaling for all three levels using the same approach</span></span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. BARRIO-HAZARD EXPOSURE using consolidated approach</span></span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a>ghsl_barrio_exposure <span class="op">=</span> []</span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> settlement_hazard.iterrows():</span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> zonal_stats(</span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a>        [row.geometry],</span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a>        familias_downscaled,</span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a>        affine<span class="op">=</span>reference_transform,</span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">=</span>[<span class="st">"sum"</span>],</span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a>        nodata<span class="op">=</span>NODATA_VALUE,</span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a>    )[<span class="dv">0</span>]</span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a>    ghsl_barrio_exposure.append(</span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a>            <span class="st">"id_renabap"</span>: row[<span class="st">"id_renabap"</span>],</span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a>            <span class="st">"PELIGROSID"</span>: row[<span class="st">"PELIGROSID"</span>],</span>
<span id="cb6-314"><a href="#cb6-314" aria-hidden="true" tabindex="-1"></a>            <span class="st">"fam_expuestas"</span>: stats[<span class="st">"sum"</span>] <span class="cf">if</span> stats[<span class="st">"sum"</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>,</span>
<span id="cb6-315"><a href="#cb6-315" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-316"><a href="#cb6-316" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-317"><a href="#cb6-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-318"><a href="#cb6-318" aria-hidden="true" tabindex="-1"></a>ghsl_barrio_temp <span class="op">=</span> pd.DataFrame(ghsl_barrio_exposure)</span>
<span id="cb6-319"><a href="#cb6-319" aria-hidden="true" tabindex="-1"></a>ghsl_barrio_tidy <span class="op">=</span> create_exposure_tidy_data(</span>
<span id="cb6-320"><a href="#cb6-320" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>ghsl_barrio_temp,</span>
<span id="cb6-321"><a href="#cb6-321" aria-hidden="true" tabindex="-1"></a>    id_column<span class="op">=</span><span class="st">"id_renabap"</span>,</span>
<span id="cb6-322"><a href="#cb6-322" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column<span class="op">=</span><span class="st">"PELIGROSID"</span>,</span>
<span id="cb6-323"><a href="#cb6-323" aria-hidden="true" tabindex="-1"></a>    method_suffix<span class="op">=</span><span class="st">"ghsl"</span>,</span>
<span id="cb6-324"><a href="#cb6-324" aria-hidden="true" tabindex="-1"></a>    exposure_values<span class="op">=</span>ghsl_barrio_temp[<span class="st">"fam_expuestas"</span>],</span>
<span id="cb6-325"><a href="#cb6-325" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-326"><a href="#cb6-326" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-327"><a href="#cb6-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-328"><a href="#cb6-328" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. CUENCA-HAZARD EXPOSURE using consolidated approach</span></span>
<span id="cb6-329"><a href="#cb6-329" aria-hidden="true" tabindex="-1"></a>ghsl_cuenca_exposure <span class="op">=</span> []</span>
<span id="cb6-330"><a href="#cb6-330" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cuenca <span class="kw">in</span> settle_hazard_cuencas[<span class="st">"Cuenca"</span>].unique():</span>
<span id="cb6-331"><a href="#cb6-331" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> peligro <span class="kw">in</span> settle_hazard_cuencas[<span class="st">"PELIGROSID"</span>].unique():</span>
<span id="cb6-332"><a href="#cb6-332" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get all geometries for this cuenca-hazard combination</span></span>
<span id="cb6-333"><a href="#cb6-333" aria-hidden="true" tabindex="-1"></a>        geoms <span class="op">=</span> settle_hazard_cuencas[</span>
<span id="cb6-334"><a href="#cb6-334" aria-hidden="true" tabindex="-1"></a>            (settle_hazard_cuencas[<span class="st">"Cuenca"</span>] <span class="op">==</span> cuenca)</span>
<span id="cb6-335"><a href="#cb6-335" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span> (settle_hazard_cuencas[<span class="st">"PELIGROSID"</span>] <span class="op">==</span> peligro)</span>
<span id="cb6-336"><a href="#cb6-336" aria-hidden="true" tabindex="-1"></a>        ].geometry.tolist()</span>
<span id="cb6-337"><a href="#cb6-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-338"><a href="#cb6-338" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> geoms:</span>
<span id="cb6-339"><a href="#cb6-339" aria-hidden="true" tabindex="-1"></a>            stats <span class="op">=</span> zonal_stats(</span>
<span id="cb6-340"><a href="#cb6-340" aria-hidden="true" tabindex="-1"></a>                geoms,</span>
<span id="cb6-341"><a href="#cb6-341" aria-hidden="true" tabindex="-1"></a>                familias_downscaled,</span>
<span id="cb6-342"><a href="#cb6-342" aria-hidden="true" tabindex="-1"></a>                affine<span class="op">=</span>reference_transform,</span>
<span id="cb6-343"><a href="#cb6-343" aria-hidden="true" tabindex="-1"></a>                stats<span class="op">=</span>[<span class="st">"sum"</span>],</span>
<span id="cb6-344"><a href="#cb6-344" aria-hidden="true" tabindex="-1"></a>                nodata<span class="op">=</span>NODATA_VALUE,</span>
<span id="cb6-345"><a href="#cb6-345" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-346"><a href="#cb6-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-347"><a href="#cb6-347" aria-hidden="true" tabindex="-1"></a>            total_pop <span class="op">=</span> <span class="bu">sum</span>(</span>
<span id="cb6-348"><a href="#cb6-348" aria-hidden="true" tabindex="-1"></a>                [stat[<span class="st">"sum"</span>] <span class="cf">if</span> stat[<span class="st">"sum"</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> stat <span class="kw">in</span> stats]</span>
<span id="cb6-349"><a href="#cb6-349" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-350"><a href="#cb6-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-351"><a href="#cb6-351" aria-hidden="true" tabindex="-1"></a>            ghsl_cuenca_exposure.append(</span>
<span id="cb6-352"><a href="#cb6-352" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb6-353"><a href="#cb6-353" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Cuenca"</span>: cuenca,</span>
<span id="cb6-354"><a href="#cb6-354" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"PELIGROSID"</span>: peligro,</span>
<span id="cb6-355"><a href="#cb6-355" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"fam_expuestas"</span>: total_pop,</span>
<span id="cb6-356"><a href="#cb6-356" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb6-357"><a href="#cb6-357" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-358"><a href="#cb6-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-359"><a href="#cb6-359" aria-hidden="true" tabindex="-1"></a>ghsl_cuenca_temp <span class="op">=</span> pd.DataFrame(ghsl_cuenca_exposure)</span>
<span id="cb6-360"><a href="#cb6-360" aria-hidden="true" tabindex="-1"></a>ghsl_cuenca_tidy <span class="op">=</span> create_exposure_tidy_data(</span>
<span id="cb6-361"><a href="#cb6-361" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>ghsl_cuenca_temp,</span>
<span id="cb6-362"><a href="#cb6-362" aria-hidden="true" tabindex="-1"></a>    id_column<span class="op">=</span><span class="st">"Cuenca"</span>,</span>
<span id="cb6-363"><a href="#cb6-363" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column<span class="op">=</span><span class="st">"PELIGROSID"</span>,</span>
<span id="cb6-364"><a href="#cb6-364" aria-hidden="true" tabindex="-1"></a>    method_suffix<span class="op">=</span><span class="st">"ghsl"</span>,</span>
<span id="cb6-365"><a href="#cb6-365" aria-hidden="true" tabindex="-1"></a>    exposure_values<span class="op">=</span>ghsl_cuenca_temp[<span class="st">"fam_expuestas"</span>],</span>
<span id="cb6-366"><a href="#cb6-366" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-367"><a href="#cb6-367" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-368"><a href="#cb6-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-369"><a href="#cb6-369" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. EJE-HAZARD EXPOSURE using consolidated approach</span></span>
<span id="cb6-370"><a href="#cb6-370" aria-hidden="true" tabindex="-1"></a>ghsl_eje_exposure <span class="op">=</span> []</span>
<span id="cb6-371"><a href="#cb6-371" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> eje <span class="kw">in</span> settle_hazard_cuencas[<span class="st">"eje"</span>].unique():</span>
<span id="cb6-372"><a href="#cb6-372" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> peligro <span class="kw">in</span> settle_hazard_cuencas[<span class="st">"PELIGROSID"</span>].unique():</span>
<span id="cb6-373"><a href="#cb6-373" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get all geometries for this eje-hazard combination</span></span>
<span id="cb6-374"><a href="#cb6-374" aria-hidden="true" tabindex="-1"></a>        geoms <span class="op">=</span> settle_hazard_cuencas[</span>
<span id="cb6-375"><a href="#cb6-375" aria-hidden="true" tabindex="-1"></a>            (settle_hazard_cuencas[<span class="st">"eje"</span>] <span class="op">==</span> eje)</span>
<span id="cb6-376"><a href="#cb6-376" aria-hidden="true" tabindex="-1"></a>            <span class="op">&amp;</span> (settle_hazard_cuencas[<span class="st">"PELIGROSID"</span>] <span class="op">==</span> peligro)</span>
<span id="cb6-377"><a href="#cb6-377" aria-hidden="true" tabindex="-1"></a>        ].geometry.tolist()</span>
<span id="cb6-378"><a href="#cb6-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-379"><a href="#cb6-379" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> geoms:</span>
<span id="cb6-380"><a href="#cb6-380" aria-hidden="true" tabindex="-1"></a>            stats <span class="op">=</span> zonal_stats(</span>
<span id="cb6-381"><a href="#cb6-381" aria-hidden="true" tabindex="-1"></a>                geoms,</span>
<span id="cb6-382"><a href="#cb6-382" aria-hidden="true" tabindex="-1"></a>                familias_downscaled,</span>
<span id="cb6-383"><a href="#cb6-383" aria-hidden="true" tabindex="-1"></a>                affine<span class="op">=</span>reference_transform,</span>
<span id="cb6-384"><a href="#cb6-384" aria-hidden="true" tabindex="-1"></a>                stats<span class="op">=</span>[<span class="st">"sum"</span>],</span>
<span id="cb6-385"><a href="#cb6-385" aria-hidden="true" tabindex="-1"></a>                nodata<span class="op">=</span>NODATA_VALUE,</span>
<span id="cb6-386"><a href="#cb6-386" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-387"><a href="#cb6-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-388"><a href="#cb6-388" aria-hidden="true" tabindex="-1"></a>            total_pop <span class="op">=</span> <span class="bu">sum</span>(</span>
<span id="cb6-389"><a href="#cb6-389" aria-hidden="true" tabindex="-1"></a>                [stat[<span class="st">"sum"</span>] <span class="cf">if</span> stat[<span class="st">"sum"</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> stat <span class="kw">in</span> stats]</span>
<span id="cb6-390"><a href="#cb6-390" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-391"><a href="#cb6-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-392"><a href="#cb6-392" aria-hidden="true" tabindex="-1"></a>            ghsl_eje_exposure.append(</span>
<span id="cb6-393"><a href="#cb6-393" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb6-394"><a href="#cb6-394" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"eje"</span>: eje,</span>
<span id="cb6-395"><a href="#cb6-395" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"PELIGROSID"</span>: peligro,</span>
<span id="cb6-396"><a href="#cb6-396" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"fam_expuestas"</span>: total_pop,</span>
<span id="cb6-397"><a href="#cb6-397" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb6-398"><a href="#cb6-398" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-399"><a href="#cb6-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-400"><a href="#cb6-400" aria-hidden="true" tabindex="-1"></a>ghsl_eje_temp <span class="op">=</span> pd.DataFrame(ghsl_eje_exposure)</span>
<span id="cb6-401"><a href="#cb6-401" aria-hidden="true" tabindex="-1"></a>ghsl_eje_tidy <span class="op">=</span> create_exposure_tidy_data(</span>
<span id="cb6-402"><a href="#cb6-402" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>ghsl_eje_temp,</span>
<span id="cb6-403"><a href="#cb6-403" aria-hidden="true" tabindex="-1"></a>    id_column<span class="op">=</span><span class="st">"eje"</span>,</span>
<span id="cb6-404"><a href="#cb6-404" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column<span class="op">=</span><span class="st">"PELIGROSID"</span>,</span>
<span id="cb6-405"><a href="#cb6-405" aria-hidden="true" tabindex="-1"></a>    method_suffix<span class="op">=</span><span class="st">"ghsl"</span>,</span>
<span id="cb6-406"><a href="#cb6-406" aria-hidden="true" tabindex="-1"></a>    exposure_values<span class="op">=</span>ghsl_eje_temp[<span class="st">"fam_expuestas"</span>],</span>
<span id="cb6-407"><a href="#cb6-407" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-408"><a href="#cb6-408" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="resultados" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="resultados"><span class="header-section-number">3.6</span> Resultados</h2>
<section id="comparación-de-métodos" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="comparación-de-métodos"><span class="header-section-number">3.6.1</span> Comparación de métodos</h3>
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. BARRIO-LEVEL WIDE DATAFRAME using consolidated function</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>renabap_info <span class="op">=</span> renabap_pba_intersect[[<span class="st">"id_renabap"</span>, <span class="st">"nombre_barrio"</span>]].drop_duplicates()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>barrio_wide <span class="op">=</span> create_wide_exposure_dataframe(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    areal_data<span class="op">=</span>barrio_areal_tidy,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    ghsl_data<span class="op">=</span>ghsl_barrio_tidy,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    buildings_data<span class="op">=</span>buildings_barrio_tidy,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    id_columns<span class="op">=</span>[<span class="st">"id_renabap"</span>, <span class="st">"peligrosidad"</span>],</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    exclude_hazard_value<span class="op">=</span>NON_HAZARD_VALUE,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add barrio names and reorder columns</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>barrio_wide <span class="op">=</span> barrio_wide.merge(renabap_info, on<span class="op">=</span><span class="st">"id_renabap"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>barrio_wide <span class="op">=</span> barrio_wide[</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"id_renabap"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"nombre_barrio"</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"peligrosidad"</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> EXPOSURE_COLUMNS</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. CUENCA-LEVEL WIDE DATAFRAME using consolidated function</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>settlement_cuenca_mapping <span class="op">=</span> settle_hazard_cuencas[</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"id_renabap"</span>, <span class="st">"Cuenca"</span>]</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>].drop_duplicates()</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>settlement_counts <span class="op">=</span> settlement_cuenca_mapping[<span class="st">"id_renabap"</span>].value_counts()</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>multi_cuenca_settlements <span class="op">=</span> settlement_counts[settlement_counts <span class="op">&gt;</span> <span class="dv">1</span>].index</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(multi_cuenca_settlements) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    settlement_cuenca_mapping <span class="op">=</span> settlement_cuenca_mapping.drop_duplicates(</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        subset<span class="op">=</span>[<span class="st">"id_renabap"</span>], keep<span class="op">=</span><span class="st">"first"</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate buildings data from barrio to cuenca level</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>cuenca_buildings_wide <span class="op">=</span> (</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    buildings_barrio_tidy[buildings_barrio_tidy[<span class="st">"peligrosidad"</span>] <span class="op">!=</span> NON_HAZARD_VALUE]</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    .merge(settlement_cuenca_mapping, on<span class="op">=</span><span class="st">"id_renabap"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"Cuenca"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas_buildings"</span>]</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to tidy format for the consolidated function</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>cuenca_buildings_tidy_for_merge <span class="op">=</span> create_exposure_tidy_data(</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>cuenca_buildings_wide,</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    id_column<span class="op">=</span><span class="st">"Cuenca"</span>,</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column<span class="op">=</span><span class="st">"peligrosidad"</span>,</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    method_suffix<span class="op">=</span><span class="st">"buildings"</span>,</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    exposure_values<span class="op">=</span>cuenca_buildings_wide[<span class="st">"fam_expuestas_buildings"</span>],</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>cuenca_wide <span class="op">=</span> create_wide_exposure_dataframe(</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    areal_data<span class="op">=</span>cuenca_areal_tidy,</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    ghsl_data<span class="op">=</span>ghsl_cuenca_tidy,</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    buildings_data<span class="op">=</span>cuenca_buildings_tidy_for_merge,</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    id_columns<span class="op">=</span>[<span class="st">"Cuenca"</span>, <span class="st">"peligrosidad"</span>],</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    exclude_hazard_value<span class="op">=</span>NON_HAZARD_VALUE,</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>cuenca_wide[<span class="st">"cuenca"</span>] <span class="op">=</span> cuenca_wide[<span class="st">"Cuenca"</span>].<span class="bu">str</span>.lower()</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>cuenca_wide <span class="op">=</span> cuenca_wide[</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cuenca"</span>,</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">"peligrosidad"</span>,</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> EXPOSURE_COLUMNS</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. EJE-LEVEL WIDE DATAFRAME using consolidated function</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>settlement_eje_mapping <span class="op">=</span> settle_hazard_cuencas[[<span class="st">"id_renabap"</span>, <span class="st">"eje"</span>]].drop_duplicates()</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>eje_settlement_counts <span class="op">=</span> settlement_eje_mapping[<span class="st">"id_renabap"</span>].value_counts()</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>multi_eje_settlements <span class="op">=</span> eje_settlement_counts[eje_settlement_counts <span class="op">&gt;</span> <span class="dv">1</span>].index</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(multi_eje_settlements) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>    settlement_eje_mapping <span class="op">=</span> settlement_eje_mapping.drop_duplicates(</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>        subset<span class="op">=</span>[<span class="st">"id_renabap"</span>], keep<span class="op">=</span><span class="st">"first"</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate buildings data from barrio to eje level</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>eje_buildings_wide <span class="op">=</span> (</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    buildings_barrio_tidy[buildings_barrio_tidy[<span class="st">"peligrosidad"</span>] <span class="op">!=</span> NON_HAZARD_VALUE]</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    .merge(settlement_eje_mapping, on<span class="op">=</span><span class="st">"id_renabap"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"eje"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas_buildings"</span>]</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to tidy format for the consolidated function</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>eje_buildings_tidy_for_merge <span class="op">=</span> create_exposure_tidy_data(</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>eje_buildings_wide,</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>    id_column<span class="op">=</span><span class="st">"eje"</span>,</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>    peligrosidad_column<span class="op">=</span><span class="st">"peligrosidad"</span>,</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>    method_suffix<span class="op">=</span><span class="st">"buildings"</span>,</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    exposure_values<span class="op">=</span>eje_buildings_wide[<span class="st">"fam_expuestas_buildings"</span>],</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>    exclude_zero<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>eje_wide <span class="op">=</span> create_wide_exposure_dataframe(</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>    areal_data<span class="op">=</span>eje_areal_tidy,</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>    ghsl_data<span class="op">=</span>ghsl_eje_tidy,</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>    buildings_data<span class="op">=</span>eje_buildings_tidy_for_merge,</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>    id_columns<span class="op">=</span>[<span class="st">"eje"</span>, <span class="st">"peligrosidad"</span>],</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>    exclude_hazard_value<span class="op">=</span>NON_HAZARD_VALUE,</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>eje_wide <span class="op">=</span> eje_wide[</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">"eje"</span>,</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">"peligrosidad"</span>,</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> EXPOSURE_COLUMNS</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>barrio_tidy <span class="op">=</span> pd.melt(</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>    barrio_wide,</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">"id_renabap"</span>, <span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>],</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>    value_vars<span class="op">=</span>EXPOSURE_COLUMNS,</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">"metodo"</span>,</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">"fam_expuestas"</span>,</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>barrio_tidy[<span class="st">"metodo"</span>] <span class="op">=</span> barrio_tidy[<span class="st">"metodo"</span>].<span class="bu">str</span>.replace(</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>    COLUMN_MAPPINGS[<span class="st">"method_cleanup_prefix"</span>], <span class="st">""</span></span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>barrio_tidy <span class="op">=</span> barrio_tidy.merge(</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>    renabap_pba_intersect[[<span class="st">"id_renabap"</span>, <span class="st">"geometry"</span>]], on<span class="op">=</span><span class="st">"id_renabap"</span>, how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>barrio_tidy[<span class="st">"area"</span>] <span class="op">=</span> barrio_tidy.geometry.<span class="bu">apply</span>(<span class="kw">lambda</span> geom: geom.area)</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by id_renabap and peligro, then find which method has the highest fam_expuestas</span></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>highest_methods <span class="op">=</span> barrio_tidy.groupby([<span class="st">"id_renabap"</span>, <span class="st">"peligrosidad"</span>])[</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fam_expuestas"</span></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>].idxmax()</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the method names for the highest estimates</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>method_counts <span class="op">=</span> barrio_tidy.loc[highest_methods, <span class="st">"metodo"</span>].value_counts()</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>method_counts.index, y<span class="op">=</span>method_counts.values, hue<span class="op">=</span>method_counts.index, palette<span class="op">=</span><span class="st">"viridis"</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>plt.title(</span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Métodos que Más Frecuentemente Devuelven la Mayor Estimación de Familias Expuestas"</span>,</span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>    fontweight<span class="op">=</span><span class="st">"bold"</span>,</span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a>    pad<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Método"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Frecuencia"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">"right"</span>)</span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by id_renabap and peligro, then find which method has the lowest fam_expuestas</span></span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a>lowest_methods <span class="op">=</span> barrio_tidy.groupby([<span class="st">"id_renabap"</span>, <span class="st">"peligrosidad"</span>])[</span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fam_expuestas"</span></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>].idxmin()</span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the method names for the lowest estimates</span></span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>lowest_method_counts <span class="op">=</span> barrio_tidy.loc[lowest_methods, <span class="st">"metodo"</span>].value_counts()</span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear gráfico de barras para métodos con menor estimación</span></span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>lowest_method_counts.index, y<span class="op">=</span>lowest_method_counts.values, hue<span class="op">=</span>lowest_method_counts.index, palette<span class="op">=</span><span class="st">"viridis"</span>, legend<span class="op">=</span><span class="va">False</span></span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>plt.title(</span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Métodos que Más Frecuentemente Devuelven la Menor Estimación de Familias Expuestas"</span>,</span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>    fontweight<span class="op">=</span><span class="st">"bold"</span>,</span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>    pad<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Método"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Frecuencia"</span>, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">"right"</span>)</span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a><span class="co"># First, left join familias_aproximadas from renabap_pba_intersect</span></span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a>final_tidy_with_pop <span class="op">=</span> barrio_tidy.merge(</span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a>    renabap_pba_intersect[[<span class="st">"id_renabap"</span>, <span class="st">"familias_aproximadas"</span>]],</span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">"id_renabap"</span>,</span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the range (highest - lowest) per id_renabap and peligro</span></span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a>range_by_barrio <span class="op">=</span> final_tidy_with_pop.groupby([<span class="st">"id_renabap"</span>, <span class="st">"peligrosidad"</span>])[</span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fam_expuestas"</span></span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a>].agg([<span class="st">"max"</span>, <span class="st">"min"</span>])</span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a>range_by_barrio[<span class="st">"range"</span>] <span class="op">=</span> range_by_barrio[<span class="st">"max"</span>] <span class="op">-</span> range_by_barrio[<span class="st">"min"</span>]</span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge back to get the total population for each barrio</span></span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>range_by_barrio <span class="op">=</span> range_by_barrio.reset_index().merge(</span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a>    final_tidy_with_pop[[<span class="st">"id_renabap"</span>, <span class="st">"familias_aproximadas"</span>]].drop_duplicates(),</span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">"id_renabap"</span>,</span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate absolute percent difference as fraction of total barrio population</span></span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a>range_by_barrio[<span class="st">"abs_pct_diff"</span>] <span class="op">=</span> (</span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a>    range_by_barrio[<span class="st">"range"</span>] <span class="op">/</span> range_by_barrio[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average absolute percent difference per peligro level</span></span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>avg_pct_diff_by_peligro <span class="op">=</span> range_by_barrio.groupby(<span class="st">"peligrosidad"</span>)[<span class="st">"abs_pct_diff"</span>].mean()</span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate absolute percent difference by method</span></span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a>method_errors <span class="op">=</span> final_tidy_with_pop.copy()</span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate absolute error as percent of total population for each method</span></span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a>method_errors[<span class="st">"abs_error_pct"</span>] <span class="op">=</span> (</span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a>    <span class="bu">abs</span>(</span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a>        method_errors[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span> method_errors.groupby([<span class="st">"id_renabap"</span>, <span class="st">"peligrosidad"</span>])[</span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>            <span class="st">"fam_expuestas"</span></span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a>        ].transform(<span class="st">"mean"</span>)</span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> method_errors[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate coefficient of variation for each barrio-peligro combination</span></span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>barrio_reliability <span class="op">=</span> (</span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a>    final_tidy_with_pop.groupby([<span class="st">"id_renabap"</span>, <span class="st">"peligrosidad"</span>])</span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a>    .agg({<span class="st">"fam_expuestas"</span>: [<span class="st">"mean"</span>, <span class="st">"std"</span>], <span class="st">"familias_aproximadas"</span>: <span class="st">"first"</span>})</span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a>barrio_reliability.columns <span class="op">=</span> [</span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id_renabap"</span>,</span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a>    <span class="st">"peligrosidad"</span>,</span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean_estimate"</span>,</span>
<span id="cb7-238"><a href="#cb7-238" aria-hidden="true" tabindex="-1"></a>    <span class="st">"std_estimate"</span>,</span>
<span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a>    <span class="st">"familias_aproximadas"</span>,</span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-241"><a href="#cb7-241" aria-hidden="true" tabindex="-1"></a>barrio_reliability[<span class="st">"coefficient_variation"</span>] <span class="op">=</span> (</span>
<span id="cb7-242"><a href="#cb7-242" aria-hidden="true" tabindex="-1"></a>    barrio_reliability[<span class="st">"std_estimate"</span>] <span class="op">/</span> barrio_reliability[<span class="st">"mean_estimate"</span>]</span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a><span class="co"># Create box plot</span></span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">3</span>))</span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a>sns.boxplot(</span>
<span id="cb7-248"><a href="#cb7-248" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>barrio_reliability,</span>
<span id="cb7-249"><a href="#cb7-249" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"peligrosidad"</span>,</span>
<span id="cb7-250"><a href="#cb7-250" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"coefficient_variation"</span>,</span>
<span id="cb7-251"><a href="#cb7-251" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"peligrosidad"</span>,</span>
<span id="cb7-252"><a href="#cb7-252" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"viridis"</span>,</span>
<span id="cb7-253"><a href="#cb7-253" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb7-254"><a href="#cb7-254" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb7-255"><a href="#cb7-255" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-256"><a href="#cb7-256" aria-hidden="true" tabindex="-1"></a>plt.title(</span>
<span id="cb7-257"><a href="#cb7-257" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Variabilidad de Estimaciones entre Métodos"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>, pad<span class="op">=</span><span class="dv">20</span></span>
<span id="cb7-258"><a href="#cb7-258" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-259"><a href="#cb7-259" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Peligrosidad"</span>, fontsize<span class="op">=</span><span class="dv">14</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-260"><a href="#cb7-260" aria-hidden="true" tabindex="-1"></a>plt.xlabel(</span>
<span id="cb7-261"><a href="#cb7-261" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Coeficiente de Variación (0 = estimaciones idénticas, 1 = muy variables)"</span>,</span>
<span id="cb7-262"><a href="#cb7-262" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb7-263"><a href="#cb7-263" aria-hidden="true" tabindex="-1"></a>    fontweight<span class="op">=</span><span class="st">"bold"</span>,</span>
<span id="cb7-264"><a href="#cb7-264" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-265"><a href="#cb7-265" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-266"><a href="#cb7-266" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-267"><a href="#cb7-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-268"><a href="#cb7-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-269"><a href="#cb7-269" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatter plot colored by peligrosidad</span></span>
<span id="cb7-270"><a href="#cb7-270" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique peligrosidad levels</span></span>
<span id="cb7-273"><a href="#cb7-273" aria-hidden="true" tabindex="-1"></a>peligrosidad_levels <span class="op">=</span> range_by_barrio[<span class="st">"peligrosidad"</span>].unique()</span>
<span id="cb7-274"><a href="#cb7-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> peligro <span class="kw">in</span> peligrosidad_levels:</span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data for this peligrosidad level</span></span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a>    peligro_data <span class="op">=</span> range_by_barrio[range_by_barrio[<span class="st">"peligrosidad"</span>] <span class="op">==</span> peligro]</span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a>    plt.scatter(</span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a>        peligro_data[<span class="st">"familias_aproximadas"</span>],</span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a>        peligro_data[<span class="st">"abs_pct_diff"</span>],</span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f"Peligro: </span><span class="sc">{</span>peligro<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb7-284"><a href="#cb7-284" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-285"><a href="#cb7-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Familias Aproximadas (Total Barrio Population)"</span>)</span>
<span id="cb7-287"><a href="#cb7-287" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Absolute Percent Difference (%)"</span>)</span>
<span id="cb7-288"><a href="#cb7-288" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Method Disagreement vs Barrio Size (Colored by Peligrosidad)"</span>)</span>
<span id="cb7-289"><a href="#cb7-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-290"><a href="#cb7-290" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb7-291"><a href="#cb7-291" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb7-292"><a href="#cb7-292" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-293"><a href="#cb7-293" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-294"><a href="#cb7-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-295"><a href="#cb7-295" aria-hidden="true" tabindex="-1"></a><span class="co"># First, get the area data from final_tidy</span></span>
<span id="cb7-296"><a href="#cb7-296" aria-hidden="true" tabindex="-1"></a>area_data <span class="op">=</span> barrio_tidy[[<span class="st">"id_renabap"</span>, <span class="st">"area"</span>]].drop_duplicates()</span>
<span id="cb7-297"><a href="#cb7-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-298"><a href="#cb7-298" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge area back into range_by_barrio</span></span>
<span id="cb7-299"><a href="#cb7-299" aria-hidden="true" tabindex="-1"></a>range_by_barrio_with_area <span class="op">=</span> range_by_barrio.merge(</span>
<span id="cb7-300"><a href="#cb7-300" aria-hidden="true" tabindex="-1"></a>    area_data, on<span class="op">=</span><span class="st">"id_renabap"</span>, how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb7-301"><a href="#cb7-301" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-302"><a href="#cb7-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-303"><a href="#cb7-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-304"><a href="#cb7-304" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb7-305"><a href="#cb7-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-306"><a href="#cb7-306" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique peligrosidad levels</span></span>
<span id="cb7-307"><a href="#cb7-307" aria-hidden="true" tabindex="-1"></a>peligrosidad_levels <span class="op">=</span> range_by_barrio_with_area[<span class="st">"peligrosidad"</span>].unique()</span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> peligro <span class="kw">in</span> peligrosidad_levels:</span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter data for this peligrosidad level</span></span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a>    peligro_data <span class="op">=</span> range_by_barrio_with_area[</span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a>        range_by_barrio_with_area[<span class="st">"peligrosidad"</span>] <span class="op">==</span> peligro</span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a>    plt.scatter(</span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a>        peligro_data[<span class="st">"area"</span>],</span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a>        peligro_data[<span class="st">"abs_pct_diff"</span>],</span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f"Peligro: </span><span class="sc">{</span>peligro<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb7-320"><a href="#cb7-320" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-321"><a href="#cb7-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Area"</span>)</span>
<span id="cb7-323"><a href="#cb7-323" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Absolute Percent Difference (%)"</span>)</span>
<span id="cb7-324"><a href="#cb7-324" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Method Disagreement vs Area (Colored by Peligrosidad)"</span>)</span>
<span id="cb7-325"><a href="#cb7-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-330"><a href="#cb7-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-331"><a href="#cb7-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-332"><a href="#cb7-332" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for high exposure (alta peligrosidad) using the joined dataframe</span></span>
<span id="cb7-333"><a href="#cb7-333" aria-hidden="true" tabindex="-1"></a>alta_data <span class="op">=</span> barrio_tidy[barrio_tidy[<span class="st">"peligrosidad"</span>] <span class="op">==</span> <span class="st">"alta"</span>].copy()</span>
<span id="cb7-334"><a href="#cb7-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-335"><a href="#cb7-335" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate by nombre_barrio and sum fam_expuestas for each method</span></span>
<span id="cb7-336"><a href="#cb7-336" aria-hidden="true" tabindex="-1"></a><span class="co"># This handles cases where there are multiple geometries with the same barrio name</span></span>
<span id="cb7-337"><a href="#cb7-337" aria-hidden="true" tabindex="-1"></a>alta_aggregated <span class="op">=</span> (</span>
<span id="cb7-338"><a href="#cb7-338" aria-hidden="true" tabindex="-1"></a>    alta_data.groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"metodo"</span>])[<span class="st">"fam_expuestas"</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb7-339"><a href="#cb7-339" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-340"><a href="#cb7-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-341"><a href="#cb7-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove cases where the barrio name is "Sin Nombre"</span></span>
<span id="cb7-342"><a href="#cb7-342" aria-hidden="true" tabindex="-1"></a>alta_aggregated <span class="op">=</span> alta_aggregated[</span>
<span id="cb7-343"><a href="#cb7-343" aria-hidden="true" tabindex="-1"></a>    alta_aggregated[<span class="st">"nombre_barrio"</span>] <span class="op">!=</span> <span class="st">"Sin Nombre"</span></span>
<span id="cb7-344"><a href="#cb7-344" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb7-345"><a href="#cb7-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-346"><a href="#cb7-346" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total exposure per barrio across all methods</span></span>
<span id="cb7-347"><a href="#cb7-347" aria-hidden="true" tabindex="-1"></a>total_exposure <span class="op">=</span> (</span>
<span id="cb7-348"><a href="#cb7-348" aria-hidden="true" tabindex="-1"></a>    alta_aggregated.groupby(<span class="st">"nombre_barrio"</span>)[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb7-349"><a href="#cb7-349" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb7-350"><a href="#cb7-350" aria-hidden="true" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-351"><a href="#cb7-351" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-352"><a href="#cb7-352" aria-hidden="true" tabindex="-1"></a>top_10_barrios <span class="op">=</span> total_exposure.head(<span class="dv">10</span>).index</span>
<span id="cb7-353"><a href="#cb7-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-354"><a href="#cb7-354" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter aggregated data for top 10 barrios</span></span>
<span id="cb7-355"><a href="#cb7-355" aria-hidden="true" tabindex="-1"></a>top_10_data <span class="op">=</span> alta_aggregated[</span>
<span id="cb7-356"><a href="#cb7-356" aria-hidden="true" tabindex="-1"></a>    alta_aggregated[<span class="st">"nombre_barrio"</span>].isin(top_10_barrios)</span>
<span id="cb7-357"><a href="#cb7-357" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb7-358"><a href="#cb7-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-359"><a href="#cb7-359" aria-hidden="true" tabindex="-1"></a><span class="co"># Create range plot showing min, max, and individual points</span></span>
<span id="cb7-360"><a href="#cb7-360" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))  <span class="co"># Increased height to accommodate longer barrio names</span></span>
<span id="cb7-361"><a href="#cb7-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-362"><a href="#cb7-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-363"><a href="#cb7-363" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, barrio <span class="kw">in</span> <span class="bu">enumerate</span>(top_10_barrios):</span>
<span id="cb7-364"><a href="#cb7-364" aria-hidden="true" tabindex="-1"></a>    barrio_data <span class="op">=</span> top_10_data[top_10_data[<span class="st">"nombre_barrio"</span>] <span class="op">==</span> barrio]</span>
<span id="cb7-365"><a href="#cb7-365" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(barrio_data) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-366"><a href="#cb7-366" aria-hidden="true" tabindex="-1"></a>        values <span class="op">=</span> barrio_data[<span class="st">"fam_expuestas"</span>].values</span>
<span id="cb7-367"><a href="#cb7-367" aria-hidden="true" tabindex="-1"></a>        min_val <span class="op">=</span> values.<span class="bu">min</span>()</span>
<span id="cb7-368"><a href="#cb7-368" aria-hidden="true" tabindex="-1"></a>        max_val <span class="op">=</span> values.<span class="bu">max</span>()</span>
<span id="cb7-369"><a href="#cb7-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-370"><a href="#cb7-370" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot range line</span></span>
<span id="cb7-371"><a href="#cb7-371" aria-hidden="true" tabindex="-1"></a>        plt.plot([min_val, max_val], [i, i], <span class="st">"k-"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-372"><a href="#cb7-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-373"><a href="#cb7-373" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot individual points colored by method</span></span>
<span id="cb7-374"><a href="#cb7-374" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> barrio_data.iterrows():</span>
<span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> METHOD_COLORS[row[<span class="st">"metodo"</span>]]</span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a>            plt.plot(row[<span class="st">"fam_expuestas"</span>], i, <span class="st">"o"</span>, color<span class="op">=</span>color, markersize<span class="op">=</span><span class="dv">6</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb7-377"><a href="#cb7-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-378"><a href="#cb7-378" aria-hidden="true" tabindex="-1"></a>plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(top_10_barrios)), top_10_barrios)</span>
<span id="cb7-379"><a href="#cb7-379" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Familias Expuestas"</span>)</span>
<span id="cb7-380"><a href="#cb7-380" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Barrio"</span>)</span>
<span id="cb7-381"><a href="#cb7-381" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Range of High Exposure Estimates for Top 10 Barrios"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb7-382"><a href="#cb7-382" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb7-383"><a href="#cb7-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-384"><a href="#cb7-384" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [</span>
<span id="cb7-386"><a href="#cb7-386" aria-hidden="true" tabindex="-1"></a>    plt.Line2D(</span>
<span id="cb7-387"><a href="#cb7-387" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">0</span>],</span>
<span id="cb7-388"><a href="#cb7-388" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">0</span>],</span>
<span id="cb7-389"><a href="#cb7-389" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">"o"</span>,</span>
<span id="cb7-390"><a href="#cb7-390" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"w"</span>,</span>
<span id="cb7-391"><a href="#cb7-391" aria-hidden="true" tabindex="-1"></a>        markerfacecolor<span class="op">=</span>color,</span>
<span id="cb7-392"><a href="#cb7-392" aria-hidden="true" tabindex="-1"></a>        markersize<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb7-393"><a href="#cb7-393" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>method,</span>
<span id="cb7-394"><a href="#cb7-394" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-395"><a href="#cb7-395" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> method, color <span class="kw">in</span> METHOD_COLORS.items()</span>
<span id="cb7-396"><a href="#cb7-396" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-397"><a href="#cb7-397" aria-hidden="true" tabindex="-1"></a>plt.legend(handles<span class="op">=</span>legend_elements, title<span class="op">=</span><span class="st">"Método"</span>)</span>
<span id="cb7-398"><a href="#cb7-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-399"><a href="#cb7-399" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb7-400"><a href="#cb7-400" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb7-401"><a href="#cb7-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-402"><a href="#cb7-402" aria-hidden="true" tabindex="-1"></a>area_data <span class="op">=</span> (</span>
<span id="cb7-403"><a href="#cb7-403" aria-hidden="true" tabindex="-1"></a>    barrio_tidy[barrio_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"fam_exp_areal"</span>]</span>
<span id="cb7-404"><a href="#cb7-404" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb7-405"><a href="#cb7-405" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb7-406"><a href="#cb7-406" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb7-407"><a href="#cb7-407" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-408"><a href="#cb7-408" aria-hidden="true" tabindex="-1"></a>area_data <span class="op">=</span> area_data.rename(columns<span class="op">=</span>{<span class="st">"fam_expuestas"</span>: <span class="st">"fam_exp_areal"</span>})</span>
<span id="cb7-409"><a href="#cb7-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-410"><a href="#cb7-410" aria-hidden="true" tabindex="-1"></a>ghsl_data <span class="op">=</span> (</span>
<span id="cb7-411"><a href="#cb7-411" aria-hidden="true" tabindex="-1"></a>    barrio_tidy[barrio_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"fam_exp_ghsl"</span>]</span>
<span id="cb7-412"><a href="#cb7-412" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb7-413"><a href="#cb7-413" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb7-414"><a href="#cb7-414" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb7-415"><a href="#cb7-415" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-416"><a href="#cb7-416" aria-hidden="true" tabindex="-1"></a>ghsl_data <span class="op">=</span> ghsl_data.rename(columns<span class="op">=</span>{<span class="st">"fam_expuestas"</span>: <span class="st">"fam_exp_ghsl"</span>})</span>
<span id="cb7-417"><a href="#cb7-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-418"><a href="#cb7-418" aria-hidden="true" tabindex="-1"></a>edificios_data <span class="op">=</span> (</span>
<span id="cb7-419"><a href="#cb7-419" aria-hidden="true" tabindex="-1"></a>    barrio_tidy[barrio_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"fam_exp_edificios"</span>]</span>
<span id="cb7-420"><a href="#cb7-420" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb7-421"><a href="#cb7-421" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb7-422"><a href="#cb7-422" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb7-423"><a href="#cb7-423" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-424"><a href="#cb7-424" aria-hidden="true" tabindex="-1"></a>edificios_data <span class="op">=</span> edificios_data.rename(</span>
<span id="cb7-425"><a href="#cb7-425" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{<span class="st">"fam_expuestas"</span>: <span class="st">"fam_exp_edificios"</span>}</span>
<span id="cb7-426"><a href="#cb7-426" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-427"><a href="#cb7-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-428"><a href="#cb7-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge all methods together</span></span>
<span id="cb7-429"><a href="#cb7-429" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> area_data.merge(</span>
<span id="cb7-430"><a href="#cb7-430" aria-hidden="true" tabindex="-1"></a>    ghsl_data, on<span class="op">=</span>[<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>], how<span class="op">=</span><span class="st">"outer"</span></span>
<span id="cb7-431"><a href="#cb7-431" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-432"><a href="#cb7-432" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> barrio_summary.merge(</span>
<span id="cb7-433"><a href="#cb7-433" aria-hidden="true" tabindex="-1"></a>    edificios_data, on<span class="op">=</span>[<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>], how<span class="op">=</span><span class="st">"outer"</span></span>
<span id="cb7-434"><a href="#cb7-434" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-435"><a href="#cb7-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-436"><a href="#cb7-436" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> barrio_summary.fillna(<span class="dv">0</span>)</span>
<span id="cb7-437"><a href="#cb7-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-438"><a href="#cb7-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-439"><a href="#cb7-439" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by nombre_barrio and peligrosidad in descending order</span></span>
<span id="cb7-440"><a href="#cb7-440" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> barrio_summary.sort_values(</span>
<span id="cb7-441"><a href="#cb7-441" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>], ascending<span class="op">=</span><span class="va">True</span></span>
<span id="cb7-442"><a href="#cb7-442" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-analisis-comparativo-barrios" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-analisis-comparativo-barrios-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-analisis-comparativo-barrios" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-analisis-comparativo-barrios-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-analisis-comparativo-barrios-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-1.png" class="lightbox" data-gallery="fig-analisis-comparativo-barrios" title="Figure&nbsp;3.2&nbsp;(a): Discrepancia vs población total del barrio"><img src="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-analisis-comparativo-barrios"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-analisis-comparativo-barrios-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Discrepancia vs población total del barrio
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-analisis-comparativo-barrios" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-analisis-comparativo-barrios-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-analisis-comparativo-barrios-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-2.png" class="lightbox" data-gallery="fig-analisis-comparativo-barrios" title="Figure&nbsp;3.2&nbsp;(b): Discrepancia vs área del barrio"><img src="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-analisis-comparativo-barrios"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-analisis-comparativo-barrios-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Discrepancia vs área del barrio
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-analisis-comparativo-barrios" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-analisis-comparativo-barrios-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-analisis-comparativo-barrios-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-3.png" class="lightbox" data-gallery="fig-analisis-comparativo-barrios" title="Figure&nbsp;3.2&nbsp;(c): Rango de estimaciones para barrios con mayor exposición"><img src="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-3.png" class="img-fluid figure-img" data-ref-parent="fig-analisis-comparativo-barrios"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-analisis-comparativo-barrios-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Rango de estimaciones para barrios con mayor exposición
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-analisis-comparativo-barrios" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-analisis-comparativo-barrios-4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-analisis-comparativo-barrios-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-4.png" class="lightbox" data-gallery="fig-analisis-comparativo-barrios" title="Figure&nbsp;3.2&nbsp;(d): "><img src="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-4.png" id="fig-analisis-comparativo-barrios-4" class="img-fluid figure-img" data-ref-parent="fig-analisis-comparativo-barrios"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-analisis-comparativo-barrios-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-analisis-comparativo-barrios" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-analisis-comparativo-barrios-5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-analisis-comparativo-barrios-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-5.png" class="lightbox" data-gallery="fig-analisis-comparativo-barrios" title="Figure&nbsp;3.2&nbsp;(e): "><img src="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-5.png" id="fig-analisis-comparativo-barrios-5" class="img-fluid figure-img" data-ref-parent="fig-analisis-comparativo-barrios"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-analisis-comparativo-barrios-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e)
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-analisis-comparativo-barrios" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-analisis-comparativo-barrios-6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-analisis-comparativo-barrios-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-6.png" class="lightbox" data-gallery="fig-analisis-comparativo-barrios" title="Figure&nbsp;3.2&nbsp;(f): "><img src="renabap_files/figure-html/fig-analisis-comparativo-barrios-output-6.png" id="fig-analisis-comparativo-barrios-6" class="img-fluid figure-img" data-ref-parent="fig-analisis-comparativo-barrios"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-analisis-comparativo-barrios-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f)
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-analisis-comparativo-barrios-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: Análisis comparativo de métodos de estimación por barrio
</figcaption>
</figure>
</div>
<div id="0679e44f" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_method_map(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    method_name,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    final_tidy,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    la_plata,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    PELIGROSIDAD_COLORS,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    common_bounds,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    create_consistent_map,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> create_consistent_map(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f"Barrios por población expuesta estimada - </span><span class="sc">{</span>method_name<span class="sc">.</span>capitalize()<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        common_bounds,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    method_data <span class="op">=</span> final_tidy[</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        (final_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> method_name)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (final_tidy[<span class="st">"peligrosidad"</span>].isin([<span class="st">"alta"</span>, <span class="st">"media"</span>]))</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    ].copy()</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    method_gdf <span class="op">=</span> gpd.GeoDataFrame(method_data, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span>USE_CRS)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    method_gdf <span class="op">=</span> method_gdf.clip(la_plata)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    method_gdf_3857 <span class="op">=</span> method_gdf.to_crs(WEB_MERCATOR_CRS)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    plotting_order <span class="op">=</span> [<span class="st">"media"</span>, <span class="st">"alta"</span>]</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">42</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> peligrosidad <span class="kw">in</span> plotting_order:</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        level_data <span class="op">=</span> method_gdf_3857[method_gdf_3857[<span class="st">"peligrosidad"</span>] <span class="op">==</span> peligrosidad]</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> level_data.iterrows():</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            centroid <span class="op">=</span> row[<span class="st">"geometry"</span>].centroid</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            jitter_x <span class="op">=</span> np.random.uniform(<span class="op">-</span><span class="dv">200</span>, <span class="dv">200</span>)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            jitter_y <span class="op">=</span> np.random.uniform(<span class="op">-</span><span class="dv">200</span>, <span class="dv">200</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            x_pos <span class="op">=</span> centroid.x <span class="op">+</span> jitter_x</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            y_pos <span class="op">=</span> centroid.y <span class="op">+</span> jitter_y</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> PELIGROSIDAD_COLORS[row[<span class="st">"peligrosidad"</span>]]</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>            size <span class="op">=</span> <span class="bu">max</span>(<span class="dv">10</span>, row[<span class="st">"fam_expuestas"</span>] <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">15</span>)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            ax.scatter(</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                x_pos,</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>                y_pos,</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                s<span class="op">=</span>size,</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>                color<span class="op">=</span>color,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>                alpha<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>                edgecolors<span class="op">=</span><span class="st">"white"</span>,</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>                linewidth<span class="op">=</span><span class="fl">1.0</span>,</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    legend_elements <span class="op">=</span> [</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        plt.Line2D(</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>            [<span class="dv">0</span>],</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>            [<span class="dv">0</span>],</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>            marker<span class="op">=</span><span class="st">"o"</span>,</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">"w"</span>,</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>            markerfacecolor<span class="op">=</span>color,</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>            markersize<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>level.capitalize(),</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> level, color <span class="kw">in</span> PELIGROSIDAD_COLORS.items()</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    ax.legend(handles<span class="op">=</span>legend_elements, title<span class="op">=</span><span class="st">"Nivel de Peligrosidad"</span>, loc<span class="op">=</span><span class="st">"upper right"</span>)</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>area_data <span class="op">=</span> (</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    barrio_tidy[barrio_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"fam_exp_areal"</span>]</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>area_data <span class="op">=</span> area_data.rename(columns<span class="op">=</span>{<span class="st">"fam_expuestas"</span>: <span class="st">"fam_exp_areal"</span>})</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>ghsl_data <span class="op">=</span> (</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>    barrio_tidy[barrio_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"fam_exp_ghsl"</span>]</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>ghsl_data <span class="op">=</span> ghsl_data.rename(columns<span class="op">=</span>{<span class="st">"fam_expuestas"</span>: <span class="st">"fam_exp_ghsl"</span>})</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>edificios_data <span class="op">=</span> (</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    barrio_tidy[barrio_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"fam_exp_edificios"</span>]</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>edificios_data <span class="op">=</span> edificios_data.rename(</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{<span class="st">"fam_expuestas"</span>: <span class="st">"fam_exp_edificios"</span>}</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge all methods together</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> area_data.merge(</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>    ghsl_data, on<span class="op">=</span>[<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>], how<span class="op">=</span><span class="st">"outer"</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> barrio_summary.merge(</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>    edificios_data, on<span class="op">=</span>[<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>], how<span class="op">=</span><span class="st">"outer"</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> barrio_summary.fillna(<span class="dv">0</span>)</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by nombre_barrio and peligrosidad in descending order</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> barrio_summary.sort_values(</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>], ascending<span class="op">=</span><span class="va">True</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exposición-por-barrio" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="exposición-por-barrio"><span class="header-section-number">3.6.2</span> Exposición por barrio</h3>
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>methods <span class="op">=</span> barrio_tidy[<span class="st">"metodo"</span>].unique()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> method <span class="kw">in</span> methods:</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    plot_method_map(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        method,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        barrio_tidy,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        la_plata,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        PELIGROSIDAD_COLORS,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        common_bounds,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        create_consistent_map,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-mapas-exposicion-barrios" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mapas-exposicion-barrios-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mapas-exposicion-barrios" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-mapas-exposicion-barrios-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mapas-exposicion-barrios-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-mapas-exposicion-barrios-output-1.png" class="lightbox" data-gallery="fig-mapas-exposicion-barrios" title="Figure&nbsp;3.3&nbsp;(a): Estimación basada en edificios"><img src="renabap_files/figure-html/fig-mapas-exposicion-barrios-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-mapas-exposicion-barrios"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mapas-exposicion-barrios-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Estimación basada en edificios
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mapas-exposicion-barrios" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-mapas-exposicion-barrios-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mapas-exposicion-barrios-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-mapas-exposicion-barrios-output-2.png" class="lightbox" data-gallery="fig-mapas-exposicion-barrios" title="Figure&nbsp;3.3&nbsp;(b): Estimación basada en GHSL"><img src="renabap_files/figure-html/fig-mapas-exposicion-barrios-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-mapas-exposicion-barrios"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mapas-exposicion-barrios-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Estimación basada en GHSL
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mapas-exposicion-barrios" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-mapas-exposicion-barrios-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mapas-exposicion-barrios-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-mapas-exposicion-barrios-output-3.png" class="lightbox" data-gallery="fig-mapas-exposicion-barrios" title="Figure&nbsp;3.3&nbsp;(c): Estimación basada en interpolación areal"><img src="renabap_files/figure-html/fig-mapas-exposicion-barrios-output-3.png" class="img-fluid figure-img" data-ref-parent="fig-mapas-exposicion-barrios"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mapas-exposicion-barrios-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Estimación basada en interpolación areal
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mapas-exposicion-barrios-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: Comparación de métodos de estimación de exposición por barrio
</figcaption>
</figure>
</div>
<div id="7f0c2de1" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>show(round_numeric_columns(barrio_summary))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<!--| quarto-html-table-processing: none -->
<table id="itables_d9f72ea1_b358_4f3f_aef7_f77326362325"><tbody><tr>
    <td style="vertical-align:middle; text-align:left">
    <a href="https://mwouts.github.io/itables/"><svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="64" viewbox="0 0 500 400" style="font-family: 'Droid Sans', sans-serif;">
    <g style="fill:#d9d7fc">
        <path d="M100,400H500V357H100Z"></path>
        <path d="M100,300H400V257H100Z"></path>
        <path d="M0,200H400V157H0Z"></path>
        <path d="M100,100H500V57H100Z"></path>
        <path d="M100,350H500V307H100Z"></path>
        <path d="M100,250H400V207H100Z"></path>
        <path d="M0,150H400V107H0Z"></path>
        <path d="M100,50H500V7H100Z"></path>
    </g>
    <g style="fill:#1a1366;stroke:#1a1366;">
   <rect x="100" y="7" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="5s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="0" y="107" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="3.5s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="0;0;400" dur="3.5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="207" width="300" height="43">
    <animate attributename="width" values="0;300;0" dur="3s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="100;100;400" dur="3s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="307" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="4s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="4s" repeatcount="indefinite"></animate>
  </rect>
        <g style="fill:transparent;stroke-width:8; stroke-linejoin:round" rx="5">
            <g transform="translate(45 50) rotate(-45)">
                <circle r="33" cx="0" cy="0"></circle>
                <rect x="-8" y="32" width="16" height="30"></rect>
            </g>

            <g transform="translate(450 152)">
                <polyline points="-15,-20 -35,-20 -35,40 25,40 25,20"></polyline>
                <rect x="-15" y="-40" width="60" height="60"></rect>
            </g>

            <g transform="translate(50 352)">
                <polygon points="-35,-5 0,-40 35,-5"></polygon>
                <polygon points="-35,10 0,45 35,10"></polygon>
            </g>

            <g transform="translate(75 250)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>

            <g transform="translate(425 250) rotate(180)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>
        </g>
    </g>
</svg>
</a>
    Loading ITables v2.4.4 from the internet...
    (need <a href="https://mwouts.github.io/itables/troubleshooting.html">help</a>?)</td>
    </tr></tbody></table>
<link href="https://www.unpkg.com/dt_for_itables@2.3.3/dt_bundle.css" rel="stylesheet">
<script type="module">
    import { ITable, jQuery as $ } from 'https://www.unpkg.com/dt_for_itables@2.3.3/dt_bundle.js';

    document.querySelectorAll("#itables_d9f72ea1_b358_4f3f_aef7_f77326362325:not(.dataTable)").forEach(table => {
        if (!(table instanceof HTMLTableElement))
            return;

        let dt_args = {"layout": {"topStart": "pageLength", "topEnd": "search", "bottomStart": "info", "bottomEnd": "paging"}, "language": {"aria": {"paginate": {"first": "Primera", "last": "Ultima", "next": "Siguiente", "previous": "Anterior"}}, "autoFill": {"cancel": "Cancelar", "fill": "Llenar las celdas con <i>%d<i></i></i>", "fillHorizontal": "Llenar las celdas horizontalmente", "fillVertical": "Llenar las celdas verticalmente", "info": ""}, "buttons": {"copy": "Copiar", "copyTitle": "Copiar al portapapeles", "createState": "Crear estado", "csv": "CSV", "excel": "Excel", "pdf": "PDF", "print": "Imprimir", "removeAllStates": "Eliminar todos los estados", "removeState": "Eliminar estado", "renameState": "Renombrar estado", "savedStates": "Estados guardados", "stateRestore": "Estado %d", "updateState": "Actualizar"}, "datetime": {"amPm": {"0": "AM", "1": "PM"}, "hours": "Hora", "minutes": "Minuto", "months": {"0": "Enero", "1": "Febrero", "10": "Noviembre", "11": "Diciembre", "2": "Marzo", "3": "Abril", "4": "Mayo", "5": "Junio", "6": "Julio", "7": "Agosto", "8": "Septiembre", "9": "Octubre"}, "next": "Siguiente", "previous": "Anterior", "seconds": "Segundo", "unknown": "-", "weekdays": {"0": "Dom", "1": "Lun", "2": "Mar", "3": "Mie", "4": "Jue", "5": "Vie", "6": "Sab"}}, "decimal": "", "editor": {"close": "Cerrar", "create": {"button": "Nuevo", "submit": "Crear", "title": "Crear nueva entrada"}, "edit": {"button": "Editar", "submit": "Actualizar", "title": "Editar entrada"}, "error": {"system": "Ocurri\u00f3 un error de sistema (&lt;a target=\"\\\" rel=\"nofollow\" href=\"\\\"&gt;M\u00e1s informaci\u00f3n)."}, "multi": {"info": "La selecci\u00f3n contiene diferentes valores para esta entrada. Para editarla y establecer todos los items al mismo valor, clickear o tocar aqu\u00ed, de otra manera conservar\u00e1n sus valores individuales.", "noMulti": "Esta entrada se puede editar individualmente, pero no como parte de un grupo.", "restore": "Deshacer cambios", "title": "M\u00faltiples valores"}, "remove": {"button": "Borrar", "confirm": {"_": "Est\u00e1 seguro que desea borrar %d filas?", "1": "Est\u00e1 seguro que desea borrar 1 fila?"}, "submit": "Borrar", "title": "Borrar"}}, "emptyTable": "No hay datos disponibles en la Tabla", "info": "Mostrando _START_ a _END_ de _TOTAL_ entradas", "infoEmpty": "Mostrando 0 a 0 de 0 entradas", "infoFiltered": "Filtrado de _MAX_ entradas totales", "infoPostFix": "", "infoThousands": ".", "lengthMenu": "Mostrar _MENU_ entradas", "loadingRecords": "Cargando...", "processing": "Procesando...", "search": "Busqueda:", "searchBuilder": {"add": "Agregar condici\u00f3n", "button": {"_": "Constructor de b\u00fasqueda (%d)", "0": "Constructor de b\u00fasqueda"}, "clearAll": "Quitar todo", "condition": "Condici\u00f3n", "conditions": {"array": {"contains": "Contiene", "empty": "Vacio", "equals": "Igual", "not": "Diferente de", "notEmpty": "No vacio", "without": "Sin"}, "date": {"after": "Luego", "before": "Luego", "between": "Entre", "empty": "Vacio", "equals": "Igual", "notBetween": "No entre", "notEmpty": "No vacio"}, "number": {"between": "Entre", "empty": "Vac\u00edo", "equals": "Igual", "gt": "Mayor a", "gte": "Mayor o igual a", "lt": "Menor a ", "lte": "Menor o igual a ", "not": "No", "notBetween": "No entre", "notEmpty": "No vac\u00edo"}, "string": {"contains": "Contiene", "empty": "Vac\u00edo", "endsWith": "Termina en ", "equals": "Igual a ", "not": "No", "notContains": "No contiene", "notEmpty": "No vac\u00edo", "notEndsWith": "No termina con", "notStartsWith": "No empieza con", "startsWith": "Comenza con "}}, "data": "Datos", "deleteTitle": "Borrar regla de filtrado", "leftTitle": "Criterio de alargado", "logicAnd": "Y", "logicOr": "O", "rightTitle": "Criterio de endentado", "title": {"_": "Constructor de b\u00fasqueda (%d)", "0": "Constructor de b\u00fasqueda"}, "value": "Valor"}, "searchPanes": {"clearMessage": "Limpiar todo", "collapse": {"_": "Paneles de b\u00fasqueda (%d)", "0": "Paneles de b\u00fasqueda"}, "collapseMessage": "Colapsar Todo", "count": "{total}", "countFiltered": "{shown} ({total})", "emptyPanes": "Sin paneles de b\u00fasqueda", "loadMessage": "Cargando paneles de b\u00fasqueda", "showMessage": "Mostrar Todo", "title": "Filtros Activos - %d"}, "searchPlaceholder": "", "select": {"cells": {"_": "%d celdas seleccionadas", "0": "", "1": "1 celda seleccionada"}, "columns": {"_": "%d columnas seleccionadas", "0": "", "1": "1 columna seleccionada"}, "rows": {"_": "%d filas seleccionadas", "0": "", "1": "1 fila seleccionada"}}, "stateRestore": {"creationModal": {"button": "Crear", "columns": {"search": "Busqueda de la columna", "visible": "Visibilidad de la columna"}, "name": "Nombre", "order": "Clasificaci\u00f3n", "paging": "Paginaci\u00f3n", "scroller": "Posici\u00f3n de desplazamiento", "search": "B\u00fasqueda", "searchBuilder": "Generador de b\u00fasqueda", "select": "Seleccionar", "title": "Crear nuevo estado", "toggleLabel": "Incluir:"}, "duplicateError": "Ya existe un estado con este nombre", "emptyError": "Debe indicar un nombre para el estado", "emptyStates": "No hay estados guardados", "removeConfirm": "\u00bfEst\u00e1 seguro de que quiere remover el estado %s?", "removeError": "Error al remover el estado", "removeJoiner": "y", "removeSubmit": "Borrar", "removeTitle": "Borrar estado", "renameButton": "Renombrar", "renameLabel": "Nuevo nombre para el estado %s", "renameTitle": "Renombrar estado"}, "thousands": ".", "zeroRecords": "No se encontraron registros que coincidan con la b\u00fasqueda"}, "classes": ["display", "nowrap"], "order": [], "text_in_header_can_be_selected": true, "style": {"table-layout": "auto", "width": "auto", "margin": "auto", "caption-side": "bottom"}, "table_html": "<table><thead>\n    <tr style=\"text-align: right;\">\n      \n      <th>nombre_barrio</th>\n      <th>peligrosidad</th>\n      <th>fam_exp_areal</th>\n      <th>fam_exp_ghsl</th>\n      <th>fam_exp_edificios</th>\n    </tr>\n  </thead></table>", "data_json": "[[\"116 y 77\", \"alta\", 1.0, 0.0, 4.0], [\"116 y 77\", \"baja\", 9.0, 33.0, 16.0], [\"116 y 77\", \"media\", 5.0, 0.0, 6.0], [\"154 y 413\", \"baja\", 1.0, 0.0, 2.0], [\"155 y 46\", \"alta\", 15.0, 0.0, 21.0], [\"155 y 46\", \"baja\", 6.0, 0.0, 4.0], [\"155 y 46\", \"media\", 22.0, 43.0, 30.0], [\"16 y 80\", \"alta\", 28.0, 21.0, 39.0], [\"16 y 80\", \"baja\", 65.0, 79.0, 90.0], [\"16 y 80\", \"media\", 120.0, 120.0, 152.0], [\"166 y 523\", \"baja\", 31.0, 34.0, 37.0], [\"166 y 523\", \"media\", 4.0, 0.0, 3.0], [\"19 y 77\", \"alta\", 14.0, 14.0, 12.0], [\"19 y 77\", \"baja\", 12.0, 13.0, 23.0], [\"19 y 77\", \"media\", 79.0, 69.0, 96.0], [\"29 y 90\", \"alta\", 28.0, 0.0, 45.0], [\"29 y 90\", \"baja\", 71.0, 85.0, 117.0], [\"29 y 90\", \"media\", 9.0, 42.0, 19.0], [\"36 Bis y 135\", \"alta\", 6.0, 0.0, 8.0], [\"36 Bis y 135\", \"media\", 19.0, 0.0, 21.0], [\"40 y 150\", \"baja\", 58.0, 48.0, 66.0], [\"40 y 150\", \"media\", 0.0, 0.0, 0.0], [\"48 y 144\", \"alta\", 136.0, 128.0, 141.0], [\"48 y 144\", \"baja\", 38.0, 32.0, 59.0], [\"48 y 144\", \"media\", 65.0, 68.0, 83.0], [\"514 y 138\", \"baja\", 20.0, 2.0, 26.0], [\"516Bis y 220\", \"baja\", 26.0, 39.0, 63.0], [\"516Bis y 220\", \"media\", 34.0, 5.0, 36.0], [\"65 y 153\", \"baja\", 0.0, 0.0, 0.0], [\"8 y 489\", \"alta\", 1.0, 0.0, 0.0], [\"8 y 489\", \"media\", 24.0, 25.0, 25.0], [\"90 y 19\", \"baja\", 3.0, 0.0, 4.0], [\"Abasto Nuevo\", \"alta\", 4.0, 0.0, 2.0], [\"Abasto Nuevo\", \"baja\", 9.0, 0.0, 13.0], [\"Abasto Nuevo\", \"media\", 13.0, 12.0, 19.0], [\"Aeropuerto\", \"alta\", 155.0, 146.0, 154.0], [\"Aeropuerto\", \"baja\", 103.0, 113.0, 133.0], [\"Aeropuerto\", \"media\", 99.0, 88.0, 132.0], [\"Alegre\", \"baja\", 306.0, 292.0, 341.0], [\"Alegre\", \"media\", 188.0, 218.0, 230.0], [\"Altos del Sol\", \"baja\", 94.0, 101.0, 105.0], [\"Altos del Sol\", \"media\", 1.0, 0.0, 0.0], [\"Arturo Segu\\u00ed II\", \"alta\", 1.0, 0.0, 0.0], [\"Arturo Segu\\u00ed II\", \"baja\", 6.0, 17.0, 11.0], [\"Arturo Segu\\u00ed II\", \"media\", 11.0, 0.0, 14.0], [\"Barrio Nuevo\", \"alta\", 48.0, 44.0, 37.0], [\"Barrio Nuevo\", \"baja\", 49.0, 52.0, 74.0], [\"Barrio Nuevo\", \"media\", 99.0, 88.0, 118.0], [\"Boliviana\", \"baja\", 0.0, 0.0, 1.0], [\"Carlos Agosti\", \"baja\", 143.0, 178.0, 173.0], [\"Carlos Agosti\", \"media\", 129.0, 97.0, 143.0], [\"Casaca\", \"alta\", 14.0, 1.0, 8.0], [\"Casaca\", \"baja\", 1.0, 21.0, 5.0], [\"Casaca\", \"media\", 3.0, 0.0, 5.0], [\"Colinas del Sol\", \"baja\", 46.0, 102.0, 66.0], [\"Colinas del Sol\", \"media\", 29.0, 0.0, 32.0], [\"Cristo Rey\", \"alta\", 26.0, 11.0, 20.0], [\"Cristo Rey\", \"baja\", 18.0, 0.0, 38.0], [\"Cristo Rey\", \"media\", 165.0, 93.0, 172.0], [\"Don Fabi\\u00e1n\", \"alta\", 48.0, 26.0, 50.0], [\"Don Fabi\\u00e1n\", \"baja\", 88.0, 136.0, 115.0], [\"Don Fabi\\u00e1n\", \"media\", 133.0, 120.0, 142.0], [\"Dos de abril\", \"baja\", 90.0, 67.0, 111.0], [\"Dos de abril\", \"media\", 15.0, 14.0, 19.0], [\"El Bajo\", \"baja\", 21.0, 30.0, 26.0], [\"El Bajo\", \"media\", 8.0, 0.0, 12.0], [\"El Country\", \"alta\", 1.0, 0.0, 3.0], [\"El Country\", \"baja\", 53.0, 60.0, 79.0], [\"El Country\", \"media\", 103.0, 108.0, 112.0], [\"El Futuro\", \"alta\", 45.0, 0.0, 44.0], [\"El Futuro\", \"baja\", 268.0, 205.0, 369.0], [\"El Futuro\", \"media\", 157.0, 162.0, 190.0], [\"El Mercadito\", \"alta\", 2.0, 0.0, 0.0], [\"El Mercadito\", \"baja\", 71.0, 101.0, 109.0], [\"El Mercadito\", \"media\", 96.0, 86.0, 71.0], [\"El Molino\", \"alta\", 31.0, 24.0, 39.0], [\"El Molino\", \"baja\", 45.0, 59.0, 56.0], [\"El Molino\", \"media\", 89.0, 90.0, 104.0], [\"El Molino I\", \"alta\", 3.0, 0.0, 0.0], [\"El Molino I\", \"baja\", 31.0, 32.0, 48.0], [\"El Molino I\", \"media\", 24.0, 30.0, 21.0], [\"El Olvido\", \"alta\", 79.0, 54.0, 80.0], [\"El Olvido\", \"baja\", 36.0, 47.0, 58.0], [\"El Olvido\", \"media\", 191.0, 221.0, 211.0], [\"El Omb\\u00fa\", \"baja\", 41.0, 55.0, 30.0], [\"El Parque\", \"baja\", 2.0, 13.0, 4.0], [\"El Parque\", \"media\", 11.0, 0.0, 10.0], [\"El Progreso\", \"alta\", 46.0, 36.0, 57.0], [\"El Progreso\", \"media\", 18.0, 28.0, 17.0], [\"El Retiro\", \"alta\", 89.0, 81.0, 87.0], [\"El Retiro\", \"baja\", 443.0, 418.0, 553.0], [\"El Retiro\", \"media\", 336.0, 384.0, 435.0], [\"El Retiro I\", \"baja\", 1.0, 0.0, 1.0], [\"El Rinc\\u00f3n I\", \"alta\", 0.0, 0.0, 0.0], [\"El Rinc\\u00f3n I\", \"baja\", 42.0, 39.0, 60.0], [\"El Rinc\\u00f3n I\", \"media\", 21.0, 25.0, 22.0], [\"El Rinc\\u00f3n II\", \"alta\", 27.0, 3.0, 25.0], [\"El Rinc\\u00f3n II\", \"baja\", 39.0, 87.0, 55.0], [\"El Rinc\\u00f3n II\", \"media\", 44.0, 43.0, 44.0], [\"El Rinc\\u00f3n III\", \"alta\", 54.0, 42.0, 80.0], [\"El Rinc\\u00f3n III\", \"baja\", 21.0, 4.0, 27.0], [\"El Rinc\\u00f3n III\", \"media\", 178.0, 207.0, 183.0], [\"El Triunfo\", \"alta\", 44.0, 44.0, 44.0], [\"El Triunfo\", \"baja\", 43.0, 44.0, 50.0], [\"El Triunfo\", \"media\", 0.0, 0.0, 0.0], [\"El Tri\\u00e1ngulo\", \"baja\", 22.0, 39.0, 29.0], [\"El Tri\\u00e1ngulo\", \"media\", 1.0, 0.0, 0.0], [\"Etcheverry I\", \"baja\", 1.0, 0.0, 5.0], [\"Evita\", \"alta\", 22.0, 0.0, 8.0], [\"Evita\", \"baja\", 13.0, 0.0, 27.0], [\"Evita\", \"media\", 76.0, 0.0, 63.0], [\"Ferroviario\", \"baja\", 19.0, 14.0, 34.0], [\"Ferroviario\", \"media\", 13.0, 33.0, 23.0], [\"Frison\", \"baja\", 78.0, 102.0, 126.0], [\"Frison\", \"media\", 8.0, 19.0, 13.0], [\"Gambier\", \"baja\", 26.0, 40.0, 29.0], [\"Gambier\", \"media\", 3.0, 0.0, 0.0], [\"Hijos de Malvinas\", \"baja\", 3.0, 0.0, 6.0], [\"Hijos de Malvinas\", \"media\", 0.0, 0.0, 0.0], [\"Hip\\u00f3dromo\", \"baja\", 27.0, 33.0, 31.0], [\"Jazm\\u00edn\", \"alta\", 2.0, 0.0, 1.0], [\"Jazm\\u00edn\", \"baja\", 2.0, 0.0, 4.0], [\"Jazm\\u00edn\", \"media\", 3.0, 0.0, 5.0], [\"Joel\", \"baja\", 218.0, 173.0, 229.0], [\"La 28\", \"alta\", 26.0, 31.0, 29.0], [\"La 28\", \"baja\", 1.0, 0.0, 1.0], [\"La 28\", \"media\", 3.0, 0.0, 9.0], [\"La Aceitera\", \"baja\", 71.0, 62.0, 67.0], [\"La Aceitera\", \"media\", 33.0, 0.0, 45.0], [\"La Bajada\", \"baja\", 48.0, 0.0, 0.0], [\"La Bajada\", \"media\", 29.0, 0.0, 0.0], [\"La Bajada II\", \"alta\", 7.0, 19.0, 5.0], [\"La Bajada II\", \"baja\", 2.0, 0.0, 3.0], [\"La Bajada II\", \"media\", 28.0, 18.0, 35.0], [\"La Banda\", \"alta\", 36.0, 81.0, 49.0], [\"La Banda\", \"baja\", 91.0, 87.0, 100.0], [\"La Banda\", \"media\", 76.0, 41.0, 92.0], [\"La Cantera\", \"alta\", 19.0, 8.0, 29.0], [\"La Cantera\", \"baja\", 52.0, 78.0, 86.0], [\"La Cantera\", \"media\", 85.0, 85.0, 87.0], [\"La Cer\\u00e1mica\", \"alta\", 1.0, 0.0, 1.0], [\"La Cer\\u00e1mica\", \"baja\", 1.0, 0.0, 4.0], [\"La Cer\\u00e1mica\", \"media\", 1.0, 0.0, 5.0], [\"La Esperanza\", \"alta\", 142.0, 144.0, 169.0], [\"La Esperanza\", \"baja\", 256.0, 276.0, 336.0], [\"La Esperanza\", \"media\", 176.0, 135.0, 229.0], [\"La Falcone\", \"alta\", 13.0, 6.0, 14.0], [\"La Falcone\", \"baja\", 15.0, 13.0, 24.0], [\"La Falcone\", \"media\", 35.0, 45.0, 38.0], [\"La Favelita\", \"alta\", 30.0, 0.0, 36.0], [\"La Favelita\", \"media\", 104.0, 134.0, 123.0], [\"La Fortaleza\", \"alta\", 83.0, 58.0, 83.0], [\"La Fortaleza\", \"baja\", 2.0, 0.0, 3.0], [\"La Fortaleza\", \"media\", 97.0, 124.0, 133.0], [\"La F\\u00e1brica\", \"baja\", 8.0, 0.0, 17.0], [\"La Granja\", \"alta\", 72.0, 34.0, 68.0], [\"La Granja\", \"baja\", 13.0, 20.0, 17.0], [\"La Granja\", \"media\", 157.0, 189.0, 195.0], [\"La Granja II\", \"alta\", 18.0, 22.0, 22.0], [\"La Granja II\", \"media\", 4.0, 0.0, 6.0], [\"La Granjita\", \"alta\", 0.0, 0.0, 0.0], [\"La Granjita\", \"baja\", 111.0, 118.0, 118.0], [\"La Granjita\", \"media\", 2.0, 0.0, 2.0], [\"La Granjita II\", \"alta\", 43.0, 0.0, 46.0], [\"La Granjita II\", \"baja\", 27.0, 31.0, 46.0], [\"La Granjita II\", \"media\", 71.0, 131.0, 75.0], [\"La G\\u00fcemes\", \"alta\", 12.0, 0.0, 13.0], [\"La G\\u00fcemes\", \"media\", 1.0, 0.0, 2.0], [\"La Isla\", \"alta\", 270.0, 293.0, 290.0], [\"La Isla\", \"media\", 23.0, 0.0, 27.0], [\"La Laguna\", \"alta\", 2.0, 5.0, 2.0], [\"La Laguna\", \"baja\", 2.0, 20.0, 5.0], [\"La Laguna\", \"media\", 14.0, 3.0, 17.0], [\"La Palangana\", \"baja\", 6.0, 0.0, 11.0], [\"La Palangana\", \"media\", 26.0, 17.0, 39.0], [\"La Piedad\", \"baja\", 189.0, 132.0, 248.0], [\"La Piedad\", \"media\", 80.0, 125.0, 100.0], [\"La Piojera\", \"baja\", 1.0, 0.0, 6.0], [\"La Rueda\", \"baja\", 28.0, 33.0, 31.0], [\"La Rueda\", \"media\", 0.0, 0.0, 0.0], [\"La Uni\\u00f3n\", \"alta\", 30.0, 0.0, 27.0], [\"La Uni\\u00f3n\", \"baja\", 37.0, 128.0, 82.0], [\"La Uni\\u00f3n\", \"media\", 79.0, 79.0, 135.0], [\"La Usina\", \"baja\", 18.0, 0.0, 23.0], [\"La Victoria\", \"alta\", 1.0, 1.0, 1.0], [\"La Victoria\", \"baja\", 206.0, 73.0, 259.0], [\"La Victoria\", \"media\", 22.0, 24.0, 22.0], [\"La V\\u00eda\", \"alta\", 28.0, 3.0, 12.0], [\"La V\\u00eda\", \"baja\", 100.0, 124.0, 111.0], [\"La V\\u00eda\", \"media\", 50.0, 24.0, 38.0], [\"Las Casuarinas\", \"alta\", 36.0, 31.0, 32.0], [\"Las Casuarinas\", \"baja\", 22.0, 49.0, 39.0], [\"Las Casuarinas\", \"media\", 42.0, 39.0, 59.0], [\"Las Dos Manzanas\", \"baja\", 2.0, 0.0, 1.0], [\"Las Margaritas\", \"baja\", 19.0, 9.0, 18.0], [\"Las Palmeras\", \"alta\", 237.0, 239.0, 257.0], [\"Las Palmeras\", \"baja\", 100.0, 103.0, 133.0], [\"Las Palmeras\", \"media\", 191.0, 220.0, 250.0], [\"Las Rosas\", \"alta\", 54.0, 53.0, 47.0], [\"Las Rosas\", \"baja\", 156.0, 181.0, 227.0], [\"Las Rosas\", \"media\", 230.0, 164.0, 246.0], [\"Las V\\u00edas\", \"alta\", 1.0, 0.0, 50.0], [\"Las V\\u00edas\", \"baja\", 21.0, 0.0, 50.0], [\"Las V\\u00edas\", \"media\", 29.0, 0.0, 0.0], [\"Los Chaques\", \"alta\", 1.0, 0.0, 1.0], [\"Los Chaques\", \"baja\", 10.0, 39.0, 21.0], [\"Los Chaques\", \"media\", 24.0, 0.0, 26.0], [\"Los Ciruelos\", \"baja\", 8.0, 4.0, 5.0], [\"Los Ciruelos\", \"media\", 0.0, 0.0, 0.0], [\"Los Colectiveros\", \"baja\", 1.0, 8.0, 1.0], [\"Los Pinos\", \"alta\", 12.0, 14.0, 15.0], [\"Los Pinos\", \"baja\", 103.0, 87.0, 113.0], [\"Los Pinos\", \"media\", 75.0, 95.0, 100.0], [\"Los Robles\", \"alta\", 60.0, 49.0, 63.0], [\"Los Robles\", \"baja\", 57.0, 71.0, 78.0], [\"Los Robles\", \"media\", 78.0, 82.0, 105.0], [\"Los Rosales\", \"baja\", 25.0, 9.0, 39.0], [\"Los Rosales\", \"media\", 56.0, 49.0, 56.0], [\"Los Zorzales\", \"baja\", 1.0, 0.0, 0.0], [\"Malvinas Argentinas\", \"baja\", 11.0, 34.0, 16.0], [\"Malvinas II\", \"baja\", 1.0, 0.0, 4.0], [\"Mart\\u00edn Fierro\", \"baja\", 17.0, 15.0, 22.0], [\"Mart\\u00edn Fierro\", \"media\", 6.0, 0.0, 6.0], [\"Medalla Milagrosa\", \"alta\", 82.0, 62.0, 87.0], [\"Medalla Milagrosa\", \"baja\", 20.0, 0.0, 30.0], [\"Medalla Milagrosa\", \"media\", 45.0, 87.0, 70.0], [\"Mercosur\", \"baja\", 162.0, 170.0, 201.0], [\"Mercosur\", \"media\", 26.0, 31.0, 36.0], [\"Monasterio\", \"alta\", 14.0, 42.0, 19.0], [\"Monasterio\", \"baja\", 2.0, 0.0, 6.0], [\"Monasterio\", \"media\", 4.0, 0.0, 10.0], [\"Nin\\u00ed\", \"baja\", 13.0, 0.0, 14.0], [\"Nin\\u00ed\", \"media\", 193.0, 383.0, 192.0], [\"Nueva Esperanza\", \"baja\", 5.0, 0.0, 8.0], [\"Nueva Esperanza\", \"media\", 2.0, 0.0, 2.0], [\"Padre Cajade\", \"baja\", 12.0, 0.0, 13.0], [\"Primero de Agosto\", \"alta\", 4.0, 0.0, 3.0], [\"Primero de Agosto\", \"baja\", 54.0, 34.0, 67.0], [\"Primero de Agosto\", \"media\", 13.0, 31.0, 17.0], [\"Progreso II\", \"baja\", 8.0, 38.0, 14.0], [\"Puente de Fierro\", \"alta\", 23.0, 31.0, 26.0], [\"Puente de Fierro\", \"baja\", 376.0, 397.0, 487.0], [\"Puente de Fierro\", \"media\", 213.0, 201.0, 251.0], [\"Ruta del Sol\", \"baja\", 79.0, 50.0, 94.0], [\"Ruta del Sol\", \"media\", 23.0, 15.0, 19.0], [\"San Antonio\", \"baja\", 1.0, 0.0, 0.0], [\"San Antonio\", \"media\", 2.0, 0.0, 4.0], [\"San Cayetano\", \"baja\", 158.0, 146.0, 171.0], [\"San Cayetano\", \"media\", 73.0, 96.0, 79.0], [\"San Luis\", \"alta\", 123.0, 105.0, 106.0], [\"San Luis\", \"baja\", 25.0, 21.0, 47.0], [\"San Luis\", \"media\", 72.0, 88.0, 99.0], [\"Santa Ana\", \"baja\", 76.0, 103.0, 89.0], [\"Santa Ana\", \"media\", 2.0, 0.0, 1.0], [\"Santa Isabel\", \"baja\", 0.0, 0.0, 0.0], [\"Santa Isabel\", \"media\", 1.0, 0.0, 1.0], [\"Santa Rosa\", \"alta\", 30.0, 1.0, 7.0], [\"Santa Rosa\", \"baja\", 37.0, 62.0, 67.0], [\"Santa Rosa\", \"media\", 65.0, 4.0, 26.0], [\"Santa Rosa Calle 39\", \"baja\", 3.0, 0.0, 2.0], [\"Savoia\", \"baja\", 267.0, 255.0, 302.0], [\"Savoia\", \"media\", 28.0, 63.0, 24.0], [\"Sebasti\\u00e1n\", \"baja\", 55.0, 40.0, 69.0], [\"Sebasti\\u00e1n\", \"media\", 9.0, 0.0, 19.0], [\"Sin Nombre\", \"alta\", 262.0, 221.0, 270.0], [\"Sin Nombre\", \"baja\", 337.0, 216.0, 443.0], [\"Sin Nombre\", \"media\", 327.0, 298.0, 357.0], [\"Terra M\\u00eda\", \"baja\", 3.0, 0.0, 7.0], [\"Terra M\\u00eda\", \"media\", 0.0, 0.0, 0.0], [\"Terra M\\u00eda II\", \"baja\", 2.0, 0.0, 0.0], [\"Toba\", \"alta\", 155.0, 149.0, 172.0], [\"Toba\", \"media\", 96.0, 102.0, 101.0], [\"Tres de Abril\", \"alta\", 48.0, 34.0, 68.0], [\"Tres de Abril\", \"baja\", 27.0, 28.0, 28.0], [\"Tres de Abril\", \"media\", 137.0, 159.0, 152.0], [\"Veintiseis de julio\", \"alta\", 0.0, 0.0, 0.0], [\"Veintiseis de julio\", \"baja\", 42.0, 34.0, 41.0], [\"Veintiseis de julio\", \"media\", 16.0, 10.0, 11.0], [\"Vieja Estaci\\u00f3n\", \"baja\", 2.0, 0.0, 4.0], [\"Villa Aburridita\", \"alta\", 2.0, 0.0, 0.0], [\"Villa Aburridita\", \"baja\", 286.0, 261.0, 380.0], [\"Villa Aburridita\", \"media\", 21.0, 21.0, 21.0], [\"Villa Alba\", \"baja\", 55.0, 27.0, 85.0], [\"Villa Alba\", \"media\", 0.0, 0.0, 0.0], [\"Villa Garivaldi\", \"baja\", 22.0, 5.0, 21.0], [\"Villa Garivaldi\", \"media\", 0.0, 0.0, 0.0], [\"Villa Las Rosas\", \"alta\", 36.0, 35.0, 31.0], [\"Villa Las Rosas\", \"baja\", 57.0, 27.0, 76.0], [\"Villa Las Rosas\", \"media\", 80.0, 59.0, 122.0], [\"Villa Montoro\", \"alta\", 293.0, 232.0, 303.0], [\"Villa Montoro\", \"baja\", 293.0, 300.0, 425.0], [\"Villa Montoro\", \"media\", 194.0, 331.0, 272.0], [\"Villa Rica\", \"alta\", 35.0, 11.0, 36.0], [\"Villa Rica\", \"media\", 24.0, 48.0, 33.0], [\"Villa San Mart\\u00edn\", \"baja\", 18.0, 24.0, 32.0], [\"Villa San Mart\\u00edn\", \"media\", 46.0, 25.0, 47.0], [\"YPF\", \"baja\", 5.0, 0.0, 9.0]]"};
        new ITable(table, dt_args);
    });
</script>
</div>
</div>
</section>
<section id="exposición-por-cuenca" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="exposición-por-cuenca"><span class="header-section-number">3.6.3</span> Exposición por cuenca</h3>
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cuencas_centroids <span class="op">=</span> cuencas.copy()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cuencas_centroids[<span class="st">"geometry"</span>] <span class="op">=</span> cuencas_centroids[<span class="st">"geometry"</span>].centroid</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a lowercase version of Cuenca for matching</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>cuencas_centroids[<span class="st">"cuenca_lower"</span>] <span class="op">=</span> cuencas_centroids[<span class="st">"Cuenca"</span>].<span class="bu">str</span>.lower()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>cuenca_tidy <span class="op">=</span> pd.melt(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    cuenca_wide,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">"cuenca"</span>, <span class="st">"peligrosidad"</span>],</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    value_vars<span class="op">=</span>EXPOSURE_COLUMNS,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">"metodo"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">"fam_expuestas"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>cuenca_tidy[<span class="st">"metodo"</span>] <span class="op">=</span> cuenca_tidy[<span class="st">"metodo"</span>].<span class="bu">str</span>.replace(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    COLUMN_MAPPINGS[<span class="st">"method_cleanup_prefix"</span>], <span class="st">""</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>cuenca_tidy_with_geometry <span class="op">=</span> cuenca_tidy.merge(</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    cuencas_centroids[[<span class="st">"cuenca_lower"</span>, <span class="st">"geometry"</span>]],</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">"cuenca"</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span><span class="st">"cuenca_lower"</span>,</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>cuenca_tidy_gdf <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    cuenca_tidy_with_geometry, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span>cuencas.crs</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>methods <span class="op">=</span> cuenca_tidy_gdf[<span class="st">"metodo"</span>].unique()</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> method <span class="kw">in</span> methods:</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    plot_method_map(</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>        method,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>        cuenca_tidy_gdf,</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        la_plata,</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        PELIGROSIDAD_COLORS,</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        common_bounds,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>        create_consistent_map,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-mapas-exposicion-cuencas" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mapas-exposicion-cuencas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mapas-exposicion-cuencas" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-mapas-exposicion-cuencas-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mapas-exposicion-cuencas-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-mapas-exposicion-cuencas-output-1.png" class="lightbox" data-gallery="fig-mapas-exposicion-cuencas" title="Figure&nbsp;3.4&nbsp;(a): Estimación basada en edificios"><img src="renabap_files/figure-html/fig-mapas-exposicion-cuencas-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-mapas-exposicion-cuencas"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mapas-exposicion-cuencas-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Estimación basada en edificios
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mapas-exposicion-cuencas" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-mapas-exposicion-cuencas-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mapas-exposicion-cuencas-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-mapas-exposicion-cuencas-output-2.png" class="lightbox" data-gallery="fig-mapas-exposicion-cuencas" title="Figure&nbsp;3.4&nbsp;(b): Estimación basada en GHSL"><img src="renabap_files/figure-html/fig-mapas-exposicion-cuencas-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-mapas-exposicion-cuencas"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mapas-exposicion-cuencas-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Estimación basada en GHSL
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mapas-exposicion-cuencas" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-mapas-exposicion-cuencas-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mapas-exposicion-cuencas-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-mapas-exposicion-cuencas-output-3.png" class="lightbox" data-gallery="fig-mapas-exposicion-cuencas" title="Figure&nbsp;3.4&nbsp;(c): Estimación basada en interpolación areal"><img src="renabap_files/figure-html/fig-mapas-exposicion-cuencas-output-3.png" class="img-fluid figure-img" data-ref-parent="fig-mapas-exposicion-cuencas"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mapas-exposicion-cuencas-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Estimación basada en interpolación areal
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mapas-exposicion-cuencas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: Comparación de métodos de estimación de exposición por cuenca
</figcaption>
</figure>
</div>
<div id="bfc8a9fd" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>show(round_numeric_columns(cuenca_wide))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<!--| quarto-html-table-processing: none -->
<table id="itables_f1789c82_0ddc_4512_bdd3_32b55f800080"><tbody><tr>
    <td style="vertical-align:middle; text-align:left">
    <a href="https://mwouts.github.io/itables/"><svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="64" viewbox="0 0 500 400" style="font-family: 'Droid Sans', sans-serif;">
    <g style="fill:#d9d7fc">
        <path d="M100,400H500V357H100Z"></path>
        <path d="M100,300H400V257H100Z"></path>
        <path d="M0,200H400V157H0Z"></path>
        <path d="M100,100H500V57H100Z"></path>
        <path d="M100,350H500V307H100Z"></path>
        <path d="M100,250H400V207H100Z"></path>
        <path d="M0,150H400V107H0Z"></path>
        <path d="M100,50H500V7H100Z"></path>
    </g>
    <g style="fill:#1a1366;stroke:#1a1366;">
   <rect x="100" y="7" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="5s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="0" y="107" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="3.5s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="0;0;400" dur="3.5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="207" width="300" height="43">
    <animate attributename="width" values="0;300;0" dur="3s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="100;100;400" dur="3s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="307" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="4s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="4s" repeatcount="indefinite"></animate>
  </rect>
        <g style="fill:transparent;stroke-width:8; stroke-linejoin:round" rx="5">
            <g transform="translate(45 50) rotate(-45)">
                <circle r="33" cx="0" cy="0"></circle>
                <rect x="-8" y="32" width="16" height="30"></rect>
            </g>

            <g transform="translate(450 152)">
                <polyline points="-15,-20 -35,-20 -35,40 25,40 25,20"></polyline>
                <rect x="-15" y="-40" width="60" height="60"></rect>
            </g>

            <g transform="translate(50 352)">
                <polygon points="-35,-5 0,-40 35,-5"></polygon>
                <polygon points="-35,10 0,45 35,10"></polygon>
            </g>

            <g transform="translate(75 250)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>

            <g transform="translate(425 250) rotate(180)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>
        </g>
    </g>
</svg>
</a>
    Loading ITables v2.4.4 from the internet...
    (need <a href="https://mwouts.github.io/itables/troubleshooting.html">help</a>?)</td>
    </tr></tbody></table>
<link href="https://www.unpkg.com/dt_for_itables@2.3.3/dt_bundle.css" rel="stylesheet">
<script type="module">
    import { ITable, jQuery as $ } from 'https://www.unpkg.com/dt_for_itables@2.3.3/dt_bundle.js';

    document.querySelectorAll("#itables_f1789c82_0ddc_4512_bdd3_32b55f800080:not(.dataTable)").forEach(table => {
        if (!(table instanceof HTMLTableElement))
            return;

        let dt_args = {"layout": {"topStart": "pageLength", "topEnd": "search", "bottomStart": "info", "bottomEnd": "paging"}, "language": {"aria": {"paginate": {"first": "Primera", "last": "Ultima", "next": "Siguiente", "previous": "Anterior"}}, "autoFill": {"cancel": "Cancelar", "fill": "Llenar las celdas con <i>%d<i></i></i>", "fillHorizontal": "Llenar las celdas horizontalmente", "fillVertical": "Llenar las celdas verticalmente", "info": ""}, "buttons": {"copy": "Copiar", "copyTitle": "Copiar al portapapeles", "createState": "Crear estado", "csv": "CSV", "excel": "Excel", "pdf": "PDF", "print": "Imprimir", "removeAllStates": "Eliminar todos los estados", "removeState": "Eliminar estado", "renameState": "Renombrar estado", "savedStates": "Estados guardados", "stateRestore": "Estado %d", "updateState": "Actualizar"}, "datetime": {"amPm": {"0": "AM", "1": "PM"}, "hours": "Hora", "minutes": "Minuto", "months": {"0": "Enero", "1": "Febrero", "10": "Noviembre", "11": "Diciembre", "2": "Marzo", "3": "Abril", "4": "Mayo", "5": "Junio", "6": "Julio", "7": "Agosto", "8": "Septiembre", "9": "Octubre"}, "next": "Siguiente", "previous": "Anterior", "seconds": "Segundo", "unknown": "-", "weekdays": {"0": "Dom", "1": "Lun", "2": "Mar", "3": "Mie", "4": "Jue", "5": "Vie", "6": "Sab"}}, "decimal": "", "editor": {"close": "Cerrar", "create": {"button": "Nuevo", "submit": "Crear", "title": "Crear nueva entrada"}, "edit": {"button": "Editar", "submit": "Actualizar", "title": "Editar entrada"}, "error": {"system": "Ocurri\u00f3 un error de sistema (&lt;a target=\"\\\" rel=\"nofollow\" href=\"\\\"&gt;M\u00e1s informaci\u00f3n)."}, "multi": {"info": "La selecci\u00f3n contiene diferentes valores para esta entrada. Para editarla y establecer todos los items al mismo valor, clickear o tocar aqu\u00ed, de otra manera conservar\u00e1n sus valores individuales.", "noMulti": "Esta entrada se puede editar individualmente, pero no como parte de un grupo.", "restore": "Deshacer cambios", "title": "M\u00faltiples valores"}, "remove": {"button": "Borrar", "confirm": {"_": "Est\u00e1 seguro que desea borrar %d filas?", "1": "Est\u00e1 seguro que desea borrar 1 fila?"}, "submit": "Borrar", "title": "Borrar"}}, "emptyTable": "No hay datos disponibles en la Tabla", "info": "Mostrando _START_ a _END_ de _TOTAL_ entradas", "infoEmpty": "Mostrando 0 a 0 de 0 entradas", "infoFiltered": "Filtrado de _MAX_ entradas totales", "infoPostFix": "", "infoThousands": ".", "lengthMenu": "Mostrar _MENU_ entradas", "loadingRecords": "Cargando...", "processing": "Procesando...", "search": "Busqueda:", "searchBuilder": {"add": "Agregar condici\u00f3n", "button": {"_": "Constructor de b\u00fasqueda (%d)", "0": "Constructor de b\u00fasqueda"}, "clearAll": "Quitar todo", "condition": "Condici\u00f3n", "conditions": {"array": {"contains": "Contiene", "empty": "Vacio", "equals": "Igual", "not": "Diferente de", "notEmpty": "No vacio", "without": "Sin"}, "date": {"after": "Luego", "before": "Luego", "between": "Entre", "empty": "Vacio", "equals": "Igual", "notBetween": "No entre", "notEmpty": "No vacio"}, "number": {"between": "Entre", "empty": "Vac\u00edo", "equals": "Igual", "gt": "Mayor a", "gte": "Mayor o igual a", "lt": "Menor a ", "lte": "Menor o igual a ", "not": "No", "notBetween": "No entre", "notEmpty": "No vac\u00edo"}, "string": {"contains": "Contiene", "empty": "Vac\u00edo", "endsWith": "Termina en ", "equals": "Igual a ", "not": "No", "notContains": "No contiene", "notEmpty": "No vac\u00edo", "notEndsWith": "No termina con", "notStartsWith": "No empieza con", "startsWith": "Comenza con "}}, "data": "Datos", "deleteTitle": "Borrar regla de filtrado", "leftTitle": "Criterio de alargado", "logicAnd": "Y", "logicOr": "O", "rightTitle": "Criterio de endentado", "title": {"_": "Constructor de b\u00fasqueda (%d)", "0": "Constructor de b\u00fasqueda"}, "value": "Valor"}, "searchPanes": {"clearMessage": "Limpiar todo", "collapse": {"_": "Paneles de b\u00fasqueda (%d)", "0": "Paneles de b\u00fasqueda"}, "collapseMessage": "Colapsar Todo", "count": "{total}", "countFiltered": "{shown} ({total})", "emptyPanes": "Sin paneles de b\u00fasqueda", "loadMessage": "Cargando paneles de b\u00fasqueda", "showMessage": "Mostrar Todo", "title": "Filtros Activos - %d"}, "searchPlaceholder": "", "select": {"cells": {"_": "%d celdas seleccionadas", "0": "", "1": "1 celda seleccionada"}, "columns": {"_": "%d columnas seleccionadas", "0": "", "1": "1 columna seleccionada"}, "rows": {"_": "%d filas seleccionadas", "0": "", "1": "1 fila seleccionada"}}, "stateRestore": {"creationModal": {"button": "Crear", "columns": {"search": "Busqueda de la columna", "visible": "Visibilidad de la columna"}, "name": "Nombre", "order": "Clasificaci\u00f3n", "paging": "Paginaci\u00f3n", "scroller": "Posici\u00f3n de desplazamiento", "search": "B\u00fasqueda", "searchBuilder": "Generador de b\u00fasqueda", "select": "Seleccionar", "title": "Crear nuevo estado", "toggleLabel": "Incluir:"}, "duplicateError": "Ya existe un estado con este nombre", "emptyError": "Debe indicar un nombre para el estado", "emptyStates": "No hay estados guardados", "removeConfirm": "\u00bfEst\u00e1 seguro de que quiere remover el estado %s?", "removeError": "Error al remover el estado", "removeJoiner": "y", "removeSubmit": "Borrar", "removeTitle": "Borrar estado", "renameButton": "Renombrar", "renameLabel": "Nuevo nombre para el estado %s", "renameTitle": "Renombrar estado"}, "thousands": ".", "zeroRecords": "No se encontraron registros que coincidan con la b\u00fasqueda"}, "classes": ["display", "nowrap"], "order": [], "text_in_header_can_be_selected": true, "style": {"table-layout": "auto", "width": "auto", "margin": "auto", "caption-side": "bottom"}, "table_html": "<table><thead>\n    <tr style=\"text-align: right;\">\n      \n      <th>cuenca</th>\n      <th>peligrosidad</th>\n      <th>fam_exp_edificios</th>\n      <th>fam_exp_ghsl</th>\n      <th>fam_exp_areal</th>\n    </tr>\n  </thead></table>", "data_json": "[[\"area de ba\\u00f1ados\", \"alta\", 239.0, 180.0, 189.0], [\"area de ba\\u00f1ados\", \"baja\", 1270.0, 1116.0, 977.0], [\"area de ba\\u00f1ados\", \"media\", 318.0, 350.0, 333.0], [\"cuenca arroyo el pescado\", \"baja\", 67.0, 62.0, 71.0], [\"cuenca arroyo el pescado\", \"media\", 22.0, 0.0, 17.0], [\"cuenca arroyo mart\\u00edn-carnaval\", \"alta\", 325.0, 174.0, 278.0], [\"cuenca arroyo mart\\u00edn-carnaval\", \"baja\", 455.0, 321.0, 349.0], [\"cuenca arroyo mart\\u00edn-carnaval\", \"media\", 629.0, 653.0, 556.0], [\"cuenca arroyo pereyra\", \"alta\", 1.0, 1.0, 2.0], [\"cuenca arroyo pereyra\", \"baja\", 29.0, 87.0, 16.0], [\"cuenca arroyo pereyra\", \"media\", 25.0, 24.0, 17.0], [\"cuenca arroyo rodriguez-don carlos\", \"alta\", 206.0, 173.0, 217.0], [\"cuenca arroyo rodriguez-don carlos\", \"baja\", 377.0, 305.0, 278.0], [\"cuenca arroyo rodriguez-don carlos\", \"media\", 359.0, 234.0, 261.0], [\"cuenca arroyo del gato\", \"alta\", 1972.0, 1595.0, 1927.0], [\"cuenca arroyo del gato\", \"baja\", 3877.0, 2926.0, 3017.0], [\"cuenca arroyo del gato\", \"media\", 3865.0, 3569.0, 3377.0], [\"cuenca a\\u00b0 maldonado\", \"alta\", 755.0, 564.0, 695.0], [\"cuenca a\\u00b0 maldonado\", \"baja\", 2755.0, 2076.0, 2132.0], [\"cuenca a\\u00b0 maldonado\", \"media\", 1782.0, 1427.0, 1453.0], [\"cuenca r\\u00edo samboromb\\u00f3n\", \"alta\", 2.0, 0.0, 4.0], [\"cuenca r\\u00edo samboromb\\u00f3n\", \"baja\", 337.0, 192.0, 227.0], [\"cuenca r\\u00edo samboromb\\u00f3n\", \"media\", 245.0, 157.0, 216.0]]"};
        new ITable(table, dt_args);
    });
</script>
</div>
</div>
</section>
<section id="exposición-por-eje" class="level3" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="exposición-por-eje"><span class="header-section-number">3.6.4</span> Exposición por eje</h3>
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>eje_tidy <span class="op">=</span> pd.melt(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    eje_wide,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">"eje"</span>, <span class="st">"peligrosidad"</span>],</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    value_vars<span class="op">=</span>EXPOSURE_COLUMNS,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">"metodo"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">"fam_expuestas"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>eje_tidy[<span class="st">"metodo"</span>] <span class="op">=</span> eje_tidy[<span class="st">"metodo"</span>].<span class="bu">str</span>.replace(</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    COLUMN_MAPPINGS[<span class="st">"method_cleanup_prefix"</span>], <span class="st">""</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create eje geodataframe by dissolving cuencas by eje and then taking centroids</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>ejes <span class="op">=</span> cuencas.dissolve(by<span class="op">=</span><span class="st">"eje"</span>).reset_index()</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>ejes_centroids <span class="op">=</span> ejes.copy()</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>ejes_centroids[<span class="st">"geometry"</span>] <span class="op">=</span> ejes_centroids[<span class="st">"geometry"</span>].centroid</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>eje_tidy_with_geometry <span class="op">=</span> eje_tidy.merge(</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    ejes_centroids[[<span class="st">"eje"</span>, <span class="st">"geometry"</span>]], on<span class="op">=</span><span class="st">"eje"</span>, how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>eje_tidy_gdf <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    eje_tidy_with_geometry, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span>cuencas.crs</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>methods <span class="op">=</span> eje_tidy_gdf[<span class="st">"metodo"</span>].unique()</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> method <span class="kw">in</span> methods:</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    plot_method_map(</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        method,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>        eje_tidy_gdf,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>        la_plata,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>        PELIGROSIDAD_COLORS,</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        common_bounds,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        create_consistent_map,</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-mapas-exposicion" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mapas-exposicion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mapas-exposicion" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-mapas-exposicion-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mapas-exposicion-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-mapas-exposicion-output-1.png" class="lightbox" data-gallery="fig-mapas-exposicion" title="Figure&nbsp;3.5&nbsp;(a): Estimación basada en edificios"><img src="renabap_files/figure-html/fig-mapas-exposicion-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-mapas-exposicion"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mapas-exposicion-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Estimación basada en edificios
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mapas-exposicion" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-mapas-exposicion-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mapas-exposicion-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-mapas-exposicion-output-2.png" class="lightbox" data-gallery="fig-mapas-exposicion" title="Figure&nbsp;3.5&nbsp;(b): Estimación basada en GHSL"><img src="renabap_files/figure-html/fig-mapas-exposicion-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-mapas-exposicion"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mapas-exposicion-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Estimación basada en GHSL
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mapas-exposicion" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-mapas-exposicion-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mapas-exposicion-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="renabap_files/figure-html/fig-mapas-exposicion-output-3.png" class="lightbox" data-gallery="fig-mapas-exposicion" title="Figure&nbsp;3.5&nbsp;(c): Estimación basada en interpolación areal"><img src="renabap_files/figure-html/fig-mapas-exposicion-output-3.png" class="img-fluid figure-img" data-ref-parent="fig-mapas-exposicion"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mapas-exposicion-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Estimación basada en interpolación areal
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mapas-exposicion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: Comparación de métodos de estimación de exposición por eje de cuenca
</figcaption>
</figure>
</div>
<div id="f69c85a8" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>show(round_numeric_columns(eje_wide))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<!--| quarto-html-table-processing: none -->
<table id="itables_4accc4be_7f64_4a93_a969_064f93bd19dd"><tbody><tr>
    <td style="vertical-align:middle; text-align:left">
    <a href="https://mwouts.github.io/itables/"><svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="64" viewbox="0 0 500 400" style="font-family: 'Droid Sans', sans-serif;">
    <g style="fill:#d9d7fc">
        <path d="M100,400H500V357H100Z"></path>
        <path d="M100,300H400V257H100Z"></path>
        <path d="M0,200H400V157H0Z"></path>
        <path d="M100,100H500V57H100Z"></path>
        <path d="M100,350H500V307H100Z"></path>
        <path d="M100,250H400V207H100Z"></path>
        <path d="M0,150H400V107H0Z"></path>
        <path d="M100,50H500V7H100Z"></path>
    </g>
    <g style="fill:#1a1366;stroke:#1a1366;">
   <rect x="100" y="7" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="5s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="0" y="107" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="3.5s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="0;0;400" dur="3.5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="207" width="300" height="43">
    <animate attributename="width" values="0;300;0" dur="3s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="100;100;400" dur="3s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="307" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="4s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="4s" repeatcount="indefinite"></animate>
  </rect>
        <g style="fill:transparent;stroke-width:8; stroke-linejoin:round" rx="5">
            <g transform="translate(45 50) rotate(-45)">
                <circle r="33" cx="0" cy="0"></circle>
                <rect x="-8" y="32" width="16" height="30"></rect>
            </g>

            <g transform="translate(450 152)">
                <polyline points="-15,-20 -35,-20 -35,40 25,40 25,20"></polyline>
                <rect x="-15" y="-40" width="60" height="60"></rect>
            </g>

            <g transform="translate(50 352)">
                <polygon points="-35,-5 0,-40 35,-5"></polygon>
                <polygon points="-35,10 0,45 35,10"></polygon>
            </g>

            <g transform="translate(75 250)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>

            <g transform="translate(425 250) rotate(180)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>
        </g>
    </g>
</svg>
</a>
    Loading ITables v2.4.4 from the internet...
    (need <a href="https://mwouts.github.io/itables/troubleshooting.html">help</a>?)</td>
    </tr></tbody></table>
<link href="https://www.unpkg.com/dt_for_itables@2.3.3/dt_bundle.css" rel="stylesheet">
<script type="module">
    import { ITable, jQuery as $ } from 'https://www.unpkg.com/dt_for_itables@2.3.3/dt_bundle.js';

    document.querySelectorAll("#itables_4accc4be_7f64_4a93_a969_064f93bd19dd:not(.dataTable)").forEach(table => {
        if (!(table instanceof HTMLTableElement))
            return;

        let dt_args = {"layout": {"topStart": "pageLength", "topEnd": "search", "bottomStart": "info", "bottomEnd": "paging"}, "language": {"aria": {"paginate": {"first": "Primera", "last": "Ultima", "next": "Siguiente", "previous": "Anterior"}}, "autoFill": {"cancel": "Cancelar", "fill": "Llenar las celdas con <i>%d<i></i></i>", "fillHorizontal": "Llenar las celdas horizontalmente", "fillVertical": "Llenar las celdas verticalmente", "info": ""}, "buttons": {"copy": "Copiar", "copyTitle": "Copiar al portapapeles", "createState": "Crear estado", "csv": "CSV", "excel": "Excel", "pdf": "PDF", "print": "Imprimir", "removeAllStates": "Eliminar todos los estados", "removeState": "Eliminar estado", "renameState": "Renombrar estado", "savedStates": "Estados guardados", "stateRestore": "Estado %d", "updateState": "Actualizar"}, "datetime": {"amPm": {"0": "AM", "1": "PM"}, "hours": "Hora", "minutes": "Minuto", "months": {"0": "Enero", "1": "Febrero", "10": "Noviembre", "11": "Diciembre", "2": "Marzo", "3": "Abril", "4": "Mayo", "5": "Junio", "6": "Julio", "7": "Agosto", "8": "Septiembre", "9": "Octubre"}, "next": "Siguiente", "previous": "Anterior", "seconds": "Segundo", "unknown": "-", "weekdays": {"0": "Dom", "1": "Lun", "2": "Mar", "3": "Mie", "4": "Jue", "5": "Vie", "6": "Sab"}}, "decimal": "", "editor": {"close": "Cerrar", "create": {"button": "Nuevo", "submit": "Crear", "title": "Crear nueva entrada"}, "edit": {"button": "Editar", "submit": "Actualizar", "title": "Editar entrada"}, "error": {"system": "Ocurri\u00f3 un error de sistema (&lt;a target=\"\\\" rel=\"nofollow\" href=\"\\\"&gt;M\u00e1s informaci\u00f3n)."}, "multi": {"info": "La selecci\u00f3n contiene diferentes valores para esta entrada. Para editarla y establecer todos los items al mismo valor, clickear o tocar aqu\u00ed, de otra manera conservar\u00e1n sus valores individuales.", "noMulti": "Esta entrada se puede editar individualmente, pero no como parte de un grupo.", "restore": "Deshacer cambios", "title": "M\u00faltiples valores"}, "remove": {"button": "Borrar", "confirm": {"_": "Est\u00e1 seguro que desea borrar %d filas?", "1": "Est\u00e1 seguro que desea borrar 1 fila?"}, "submit": "Borrar", "title": "Borrar"}}, "emptyTable": "No hay datos disponibles en la Tabla", "info": "Mostrando _START_ a _END_ de _TOTAL_ entradas", "infoEmpty": "Mostrando 0 a 0 de 0 entradas", "infoFiltered": "Filtrado de _MAX_ entradas totales", "infoPostFix": "", "infoThousands": ".", "lengthMenu": "Mostrar _MENU_ entradas", "loadingRecords": "Cargando...", "processing": "Procesando...", "search": "Busqueda:", "searchBuilder": {"add": "Agregar condici\u00f3n", "button": {"_": "Constructor de b\u00fasqueda (%d)", "0": "Constructor de b\u00fasqueda"}, "clearAll": "Quitar todo", "condition": "Condici\u00f3n", "conditions": {"array": {"contains": "Contiene", "empty": "Vacio", "equals": "Igual", "not": "Diferente de", "notEmpty": "No vacio", "without": "Sin"}, "date": {"after": "Luego", "before": "Luego", "between": "Entre", "empty": "Vacio", "equals": "Igual", "notBetween": "No entre", "notEmpty": "No vacio"}, "number": {"between": "Entre", "empty": "Vac\u00edo", "equals": "Igual", "gt": "Mayor a", "gte": "Mayor o igual a", "lt": "Menor a ", "lte": "Menor o igual a ", "not": "No", "notBetween": "No entre", "notEmpty": "No vac\u00edo"}, "string": {"contains": "Contiene", "empty": "Vac\u00edo", "endsWith": "Termina en ", "equals": "Igual a ", "not": "No", "notContains": "No contiene", "notEmpty": "No vac\u00edo", "notEndsWith": "No termina con", "notStartsWith": "No empieza con", "startsWith": "Comenza con "}}, "data": "Datos", "deleteTitle": "Borrar regla de filtrado", "leftTitle": "Criterio de alargado", "logicAnd": "Y", "logicOr": "O", "rightTitle": "Criterio de endentado", "title": {"_": "Constructor de b\u00fasqueda (%d)", "0": "Constructor de b\u00fasqueda"}, "value": "Valor"}, "searchPanes": {"clearMessage": "Limpiar todo", "collapse": {"_": "Paneles de b\u00fasqueda (%d)", "0": "Paneles de b\u00fasqueda"}, "collapseMessage": "Colapsar Todo", "count": "{total}", "countFiltered": "{shown} ({total})", "emptyPanes": "Sin paneles de b\u00fasqueda", "loadMessage": "Cargando paneles de b\u00fasqueda", "showMessage": "Mostrar Todo", "title": "Filtros Activos - %d"}, "searchPlaceholder": "", "select": {"cells": {"_": "%d celdas seleccionadas", "0": "", "1": "1 celda seleccionada"}, "columns": {"_": "%d columnas seleccionadas", "0": "", "1": "1 columna seleccionada"}, "rows": {"_": "%d filas seleccionadas", "0": "", "1": "1 fila seleccionada"}}, "stateRestore": {"creationModal": {"button": "Crear", "columns": {"search": "Busqueda de la columna", "visible": "Visibilidad de la columna"}, "name": "Nombre", "order": "Clasificaci\u00f3n", "paging": "Paginaci\u00f3n", "scroller": "Posici\u00f3n de desplazamiento", "search": "B\u00fasqueda", "searchBuilder": "Generador de b\u00fasqueda", "select": "Seleccionar", "title": "Crear nuevo estado", "toggleLabel": "Incluir:"}, "duplicateError": "Ya existe un estado con este nombre", "emptyError": "Debe indicar un nombre para el estado", "emptyStates": "No hay estados guardados", "removeConfirm": "\u00bfEst\u00e1 seguro de que quiere remover el estado %s?", "removeError": "Error al remover el estado", "removeJoiner": "y", "removeSubmit": "Borrar", "removeTitle": "Borrar estado", "renameButton": "Renombrar", "renameLabel": "Nuevo nombre para el estado %s", "renameTitle": "Renombrar estado"}, "thousands": ".", "zeroRecords": "No se encontraron registros que coincidan con la b\u00fasqueda"}, "classes": ["display", "nowrap"], "order": [], "text_in_header_can_be_selected": true, "style": {"table-layout": "auto", "width": "auto", "margin": "auto", "caption-side": "bottom"}, "table_html": "<table><thead>\n    <tr style=\"text-align: right;\">\n      \n      <th>eje</th>\n      <th>peligrosidad</th>\n      <th>fam_exp_edificios</th>\n      <th>fam_exp_ghsl</th>\n      <th>fam_exp_areal</th>\n    </tr>\n  </thead></table>", "data_json": "[[\"central\", \"alta\", 1972.0, 1595.0, 1927.0], [\"central\", \"baja\", 3877.0, 2926.0, 3017.0], [\"central\", \"media\", 3865.0, 3569.0, 3377.0], [\"noreste\", \"alta\", 445.0, 353.0, 406.0], [\"noreste\", \"baja\", 1647.0, 1421.0, 1255.0], [\"noreste\", \"media\", 677.0, 584.0, 595.0], [\"noroeste\", \"alta\", 326.0, 175.0, 279.0], [\"noroeste\", \"baja\", 484.0, 408.0, 365.0], [\"noroeste\", \"media\", 654.0, 678.0, 573.0], [\"sudeste\", \"baja\", 67.0, 62.0, 71.0], [\"sudeste\", \"media\", 22.0, 0.0, 17.0], [\"sudoeste\", \"alta\", 756.0, 564.0, 699.0], [\"sudoeste\", \"baja\", 3092.0, 2267.0, 2359.0], [\"sudoeste\", \"media\", 2027.0, 1583.0, 1669.0]]"};
        new ITable(table, dt_args);
    });
</script>
</div>
</div>
</section>
</section>
<section id="conclusiones" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="conclusiones"><span class="header-section-number">3.7</span> Conclusiones</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-romanazzi2019" class="csl-entry" role="listitem">
Romanazzi, Pablo et al. 2019. <em>Plan de Reducción Del Riesgo Por Inundaciones En La Región de La Plata</em>. Edited by Sebastián Guerrini, Pablo Morosi, Eduardo Pablo Spinelli, and Josefina López MacKenzie. 1st ed. La Plata: Universidad Nacional de La Plata. Facultad de Ingeniería; Municipalidad de La Plata. <a href="https://sedici.unlp.edu.ar/bitstream/handle/10915/165109/Documento_completo.pdf-PDFA.pdf?sequence=1&amp;isAllowed=y">https://sedici.unlp.edu.ar/bitstream/handle/10915/165109/Documento_completo.pdf-PDFA.pdf?sequence=1&amp;isAllowed=y</a>.
</div>
<div id="ref-ghsl_pop2023a" class="csl-entry" role="listitem">
Schiavina, M., S. Freire, A. Carioli, and K. MacManus. 2023. <span>“GHS-POP R2023A - GHS Population Grid Multitemporal (1975-2030).”</span> European Commission, Joint Research Centre (JRC). <a href="https://doi.org/10.2905/2FF68A52-5B5B-4A22-8F40-C41DA8332CFE">https://doi.org/10.2905/2FF68A52-5B5B-4A22-8F40-C41DA8332CFE</a>.
</div>
<div id="ref-smith2019" class="csl-entry" role="listitem">
Smith, A., P. D. Bates, O. Wing, et al. 2019. <span>“New Estimates of Flood Exposure in Developing Countries Using High-Resolution Population Data.”</span> <em>Nature Communications</em> 10: 1814. <a href="https://doi.org/10.1038/s41467-019-09282-y">https://doi.org/10.1038/s41467-019-09282-y</a>.
</div>
<div id="ref-tellman2021" class="csl-entry" role="listitem">
Tellman, B., J. A. Sullivan, C. Kuhn, et al. 2021. <span>“Satellite Imaging Reveals Increased Proportion of Population Exposed to Floods.”</span> <em>Nature</em> 596: 80–86. <a href="https://doi.org/10.1038/s41586-021-03695-w">https://doi.org/10.1038/s41586-021-03695-w</a>.
</div>
<div id="ref-google_microsoft_osm_buildings" class="csl-entry" role="listitem">
VIDA. 2023. <span>“Google-Microsoft-OSM Open Buildings - Combined by VIDA.”</span> <a href="https://source.coop/repositories/vida/google-microsoft-osm-open-buildings/access">https://source.coop/repositories/vida/google-microsoft-osm-open-buildings/access</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nlebovits\.github\.io\/ciut-riesgo\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./suavizacion.html" class="pagination-link" aria-label="Suavización">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Suavización</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./twi.html" class="pagination-link" aria-label="Índice de Humedad Topográfica (TWI)">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Índice de Humedad Topográfica (TWI)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","loop":false,"openEffect":"zoom","selector":".lightbox","descPosition":"bottom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>