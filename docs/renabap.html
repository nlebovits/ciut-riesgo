<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; RENABAP – CIUT Riesgo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./suavizacion.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./renabap.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RENABAP</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">CIUT Riesgo</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exposicion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Exposición</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./suavizacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Suavización</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./renabap.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RENABAP</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#resumen-ejecutivo" id="toc-resumen-ejecutivo" class="nav-link active" data-scroll-target="#resumen-ejecutivo"><span class="header-section-number">3.1</span> Resumen ejecutivo</a></li>
  <li><a href="#objetivos" id="toc-objetivos" class="nav-link" data-scroll-target="#objetivos"><span class="header-section-number">3.2</span> Objetivos</a></li>
  <li><a href="#contexto" id="toc-contexto" class="nav-link" data-scroll-target="#contexto"><span class="header-section-number">3.3</span> Contexto</a></li>
  <li><a href="#fuentes-de-datos" id="toc-fuentes-de-datos" class="nav-link" data-scroll-target="#fuentes-de-datos"><span class="header-section-number">3.4</span> Fuentes de datos</a>
  <ul class="collapse">
  <li><a href="#renabap" id="toc-renabap" class="nav-link" data-scroll-target="#renabap"><span class="header-section-number">3.4.1</span> RENABAP</a></li>
  <li><a href="#ghsl" id="toc-ghsl" class="nav-link" data-scroll-target="#ghsl"><span class="header-section-number">3.4.2</span> GHSL</a></li>
  <li><a href="#google-microsoft-osm-open-buildings" id="toc-google-microsoft-osm-open-buildings" class="nav-link" data-scroll-target="#google-microsoft-osm-open-buildings"><span class="header-section-number">3.4.3</span> Google-Microsoft-OSM Open Buildings</a></li>
  </ul></li>
  <li><a href="#metodología-y-procesamiento" id="toc-metodología-y-procesamiento" class="nav-link" data-scroll-target="#metodología-y-procesamiento"><span class="header-section-number">3.5</span> Metodología y procesamiento</a>
  <ul class="collapse">
  <li><a href="#interpolación-por-area" id="toc-interpolación-por-area" class="nav-link" data-scroll-target="#interpolación-por-area"><span class="header-section-number">3.5.1</span> Interpolación por area</a></li>
  <li><a href="#cuenta-de-edificios" id="toc-cuenta-de-edificios" class="nav-link" data-scroll-target="#cuenta-de-edificios"><span class="header-section-number">3.5.2</span> Cuenta de edificios</a></li>
  <li><a href="#mapeo-dasymetrico" id="toc-mapeo-dasymetrico" class="nav-link" data-scroll-target="#mapeo-dasymetrico"><span class="header-section-number">3.5.3</span> Mapeo dasymetrico</a></li>
  </ul></li>
  <li><a href="#resultados-y-conclusiones" id="toc-resultados-y-conclusiones" class="nav-link" data-scroll-target="#resultados-y-conclusiones"><span class="header-section-number">3.6</span> Resultados y conclusiones</a>
  <ul class="collapse">
  <li><a href="#comparación-de-métodos" id="toc-comparación-de-métodos" class="nav-link" data-scroll-target="#comparación-de-métodos"><span class="header-section-number">3.6.1</span> Comparación de métodos</a></li>
  <li><a href="#exposición-por-barrio" id="toc-exposición-por-barrio" class="nav-link" data-scroll-target="#exposición-por-barrio"><span class="header-section-number">3.6.2</span> Exposición por barrio</a></li>
  <li><a href="#exposición-por-cuenca" id="toc-exposición-por-cuenca" class="nav-link" data-scroll-target="#exposición-por-cuenca"><span class="header-section-number">3.6.3</span> Exposición por cuenca</a></li>
  <li><a href="#exposición-por-eje" id="toc-exposición-por-eje" class="nav-link" data-scroll-target="#exposición-por-eje"><span class="header-section-number">3.6.4</span> Exposición por eje</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RENABAP</span></h1>
<p class="subtitle lead">Análisis de la exposición poblacional a peligros de inundación en el Partido de La Plata</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="resumen-ejecutivo" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="resumen-ejecutivo"><span class="header-section-number">3.1</span> Resumen ejecutivo</h2>
</section>
<section id="objetivos" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="objetivos"><span class="header-section-number">3.2</span> Objetivos</h2>
<p>El objetivo principal de este análisis es calcular con mayor precisión la exposición poblacional en la región del Partido de La Plata, comparando el enfoque actual de interpolación por área de datos del RENABAP con enfoques de mapeo dasimétrico de mayor resolución utilizando datos de la Capa Global de Asentamientos Humanos (GHSL) y el conjunto de datos de edificios abiertos de Google-Microsoft OpenStreetMap.</p>
<p>Para lograr este objetivo, necesitamos:</p>
<ol type="1">
<li><strong>Explicar y comparar metodologías</strong>: Desarrollar una comprensión clara de las diferencias entre interpolación por área y mapeo dasimétrico</li>
<li><strong>Evaluar fuentes de datos</strong>: Analizar las ventajas y limitaciones de cada conjunto de datos utilizado</li>
<li><strong>Crear estimaciones robustas</strong>: Generar un rango de posibles exposiciones poblacionales para informar la toma de decisiones</li>
<li><strong>Priorizar recursos</strong>: Identificar áreas donde se requiera recopilación de datos más precisa</li>
</ol>
</section>
<section id="contexto" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="contexto"><span class="header-section-number">3.3</span> Contexto</h2>
<div id="0b1ed6c0" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> ctx</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> BytesIO, StringIO</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> owslib.wfs <span class="im">import</span> WebFeatureService</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s2sphere</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> botocore.config <span class="im">import</span> Config</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterstats</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>USE_CRS <span class="op">=</span> <span class="st">"EPSG:5349"</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Generic mapping functions</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_base_map(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>), bounds<span class="op">=</span><span class="va">None</span>, padding_x<span class="op">=</span><span class="dv">500</span>, padding_y<span class="op">=</span><span class="dv">500</span>):</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create figure and set up basic map boundaries with padding."""</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bounds <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        bounds <span class="op">=</span> renabap_pba_intersect.total_bounds</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert bounds to Web Mercator for basemap compatibility</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> bounds <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create a temporary GeoDataFrame with the bounds to reproject</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        temp_bounds <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>            geometry<span class="op">=</span>[box(bounds[<span class="dv">0</span>], bounds[<span class="dv">1</span>], bounds[<span class="dv">2</span>], bounds[<span class="dv">3</span>])], crs<span class="op">=</span>USE_CRS</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        bounds_3857 <span class="op">=</span> temp_bounds.to_crs(<span class="st">"EPSG:3857"</span>).total_bounds</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        bounds_3857 <span class="op">=</span> bounds</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>figsize)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(bounds_3857[<span class="dv">0</span>] <span class="op">-</span> padding_x, bounds_3857[<span class="dv">2</span>] <span class="op">+</span> padding_x)</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(bounds_3857[<span class="dv">1</span>] <span class="op">-</span> padding_y, bounds_3857[<span class="dv">3</span>] <span class="op">+</span> padding_y)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig, ax</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_basemap(ax, zoom<span class="op">=</span><span class="dv">13</span>):</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add CartoDB basemap to the axes."""</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The axes are already in Web Mercator from setup_base_map</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    ctx.add_basemap(</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        ax,</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        source<span class="op">=</span>ctx.providers.CartoDB.PositronNoLabels,</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        zorder<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        zoom<span class="op">=</span>zoom,</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_north_arrow(ax, x<span class="op">=</span><span class="fl">0.95</span>, y<span class="op">=</span><span class="fl">0.05</span>, arrow_length<span class="op">=</span><span class="fl">0.04</span>):</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add a north arrow to the map."""</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add north arrow, https://stackoverflow.com/a/58110049/604456</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    ax.annotate(<span class="st">'N'</span>, xy<span class="op">=</span>(x, y), xytext<span class="op">=</span>(x, y<span class="op">-</span>arrow_length),</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>                arrowprops<span class="op">=</span><span class="bu">dict</span>(facecolor<span class="op">=</span><span class="st">'black'</span>, width<span class="op">=</span><span class="dv">3</span>, headwidth<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>                xycoords<span class="op">=</span>ax.transAxes)</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_la_plata_outline(ax):</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Add the outline of Partido de La Plata to a map."""</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    la_plata_3857 <span class="op">=</span> la_plata.to_crs(<span class="st">"EPSG:3857"</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    la_plata_3857.plot(</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>        ax<span class="op">=</span>ax,</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>        facecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>        zorder<span class="op">=</span><span class="dv">5</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_consistent_map(title, bounds<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create a map with consistent styling and basemap."""</span></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> setup_base_map(bounds<span class="op">=</span>bounds)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add basemap</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    add_basemap(ax)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add north arrow</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    add_north_arrow(ax)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add La Plata partido outline</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    add_la_plata_outline(ax)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set title</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">"bold"</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove axes</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig, ax</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> wfs_to_gdf(</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    wfs_url: <span class="bu">str</span>, layer_name: <span class="bu">str</span>, srs: <span class="bu">str</span> <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> gpd.GeoDataFrame:</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a><span class="co">    Descarga una capa WFS y la devuelve como GeoDataFrame.</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="co">        wfs_url (str): URL del servicio WFS.</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="co">        layer_name (str): Nombre de la capa (typename).</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="co">        srs (str): Código EPSG del sistema de referencia de coordenadas.</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a><span class="co">        gpd.GeoDataFrame: Capa descargada como GeoDataFrame.</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    wfs <span class="op">=</span> WebFeatureService(url<span class="op">=</span>wfs_url, version<span class="op">=</span><span class="st">"2.0.0"</span>)</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> wfs.getfeature(typename<span class="op">=</span>layer_name, srsname<span class="op">=</span>srs)</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> gpd.read_file(BytesIO(response.read()))</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gdf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="8e627ed5" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">### import data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.argentina.gob.ar/sites/default/files/renabap-2023-12-06.geojson"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>renabap <span class="op">=</span> gpd.read_file(StringIO(response.text))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>renabap_pba <span class="op">=</span> renabap[renabap[<span class="st">"provincia"</span>] <span class="op">==</span> <span class="st">"Buenos Aires"</span>]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>renabap_pba <span class="op">=</span> renabap_pba.to_crs(USE_CRS)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>peligro_path <span class="op">=</span> <span class="st">"/home/nissim/Documents/dev/fulbright/ciut-riesgo/notebooks/data/la_plata_pelig_2023_datos_originales.geojson"</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>peligro <span class="op">=</span> gpd.read_file(peligro_path)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>peligro <span class="op">=</span> peligro.to_crs(USE_CRS)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>peligro_bounds <span class="op">=</span> peligro.total_bounds</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>peligro_bbox <span class="op">=</span> box(<span class="op">*</span>peligro_bounds)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>partidos <span class="op">=</span> wfs_to_gdf(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    wfs_url<span class="op">=</span><span class="st">"https://geo.arba.gov.ar/geoserver/idera/wfs"</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    layer_name<span class="op">=</span><span class="st">"idera:Departamento"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    srs<span class="op">=</span><span class="st">"EPSG:5347"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>partidos <span class="op">=</span> partidos.to_crs(USE_CRS)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>la_plata <span class="op">=</span> partidos[partidos[<span class="st">"fna"</span>] <span class="op">==</span> <span class="st">"Partido de La Plata"</span>]</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener la geometría principal</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>main_geom <span class="op">=</span> la_plata.geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Si es un MultiPolygon, mantener solo el polígono más grande (el partido principal)</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Esto elimina la pequeña isla que aparece en los datos</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> main_geom.geom_type <span class="op">==</span> <span class="st">'MultiPolygon'</span>:</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Obtener todos los polígonos y mantener el que tenga mayor área</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    largest_polygon <span class="op">=</span> <span class="bu">max</span>(main_geom.geoms, key<span class="op">=</span><span class="kw">lambda</span> p: p.area)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    la_plata.geometry.iloc[<span class="dv">0</span>] <span class="op">=</span> largest_polygon</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>la_plata_bbox <span class="op">=</span> la_plata.geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>renabap_pba_intersect <span class="op">=</span> renabap_pba[</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    renabap_pba.geometry.intersects(la_plata_bbox)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total area of RENABAP settlements in hectares (POSGAR projection is in meters)</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>renabap_total_area_ha <span class="op">=</span> renabap_pba_intersect.geometry.area.<span class="bu">sum</span>() <span class="op">/</span> <span class="dv">10000</span>  <span class="co"># Convert m² to hectares</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>la_plata_area_ha <span class="op">=</span> la_plata.geometry.iloc[<span class="dv">0</span>].area <span class="op">/</span> <span class="dv">10000</span> </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>percentage_coverage <span class="op">=</span> (renabap_total_area_ha <span class="op">/</span> la_plata_area_ha) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Get common bounds for all maps</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>common_bounds <span class="op">=</span> la_plata.total_bounds</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersect settlements with hazard zones</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>settlement_hazard <span class="op">=</span> gpd.overlay(renabap_pba_intersect, peligro, how<span class="op">=</span><span class="st">"intersection"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_627798/4181857673.py:34: FutureWarning: ChainedAssignmentError: behaviour will change in pandas 3.0!
You are setting values through chained assignment. Currently this works in certain cases, but when using Copy-on-Write (which will become the default behaviour in pandas 3.0) this will never work to update the original DataFrame or Series, because the intermediate object on which we are setting values will behave as a copy.
A typical example is when you are setting values in a column of a DataFrame, like:

df["col"][row_indexer] = value

Use `df.loc[row_indexer, "col"] = values` instead, to perform the assignment in a single step and ensure this keeps updating the original `df`.

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

  la_plata.geometry.iloc[0] = largest_polygon
/tmp/ipykernel_627798/4181857673.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  la_plata.geometry.iloc[0] = largest_polygon</code></pre>
</div>
</div>
<p>Hay un total de <code>python len(renabap_pba_intersect)</code> barrios populares en el Partido de La Plata, que representan <code>python renabap_pba_intersect['familias_aproximadas'].sum()</code> familias. Estos barrios ocupan <code>python renabap_total_area_ha</code> hectáreas del Partido de La Plata, o <code>python percentage_coverage</code> por ciento del partido.</p>
</section>
<section id="fuentes-de-datos" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="fuentes-de-datos"><span class="header-section-number">3.4</span> Fuentes de datos</h2>
<section id="renabap" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="renabap"><span class="header-section-number">3.4.1</span> RENABAP</h3>
<p>El Registro Nacional de Barrios Populares (RENABAP) es producido por la Subsecretaría de Integración Socio Urbana y proporciona información sobre asentamientos informales en Argentina, incluyendo estimaciones de población y delimitaciones geográficas de estos barrios. Más información sobre el RENABAP está disponible en el <a href="https://www.argentina.gob.ar/obras-publicas/sisu/renabap/observatorio-de-barrios-populares">Observatorio de Barrios Populares</a>. Los datos fueron obtenidos a través del <a href="https://www.argentina.gob.ar/obras-publicas/sisu/renabap/mapa">Mapa de Barrios Populares</a> y están disponibles para <a href="https://www.argentina.gob.ar/sites/default/files/renabap-2023-12-06.geojson">descarga como GeoJSON</a>.</p>
<div id="7eeb89f2" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> create_consistent_map(<span class="st">"Asentamientos RENABAP en La Plata"</span>, common_bounds)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add RENABAP settlements as black outline with no fill</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject to Web Mercator to match the map's coordinate system</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>renabap_pba_intersect_3857 <span class="op">=</span> renabap_pba_intersect.to_crs(<span class="st">"EPSG:3857"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>renabap_pba_intersect_3857.plot(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax1,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    facecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    zorder<span class="op">=</span><span class="dv">10</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="renabap_files/figure-html/cell-4-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="renabap_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ghsl" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="ghsl"><span class="header-section-number">3.4.2</span> GHSL</h3>
<p>La <a href="https://human-settlement.emergency.copernicus.eu/ghs_pop2023.php">Capa Global de Asentamientos Humanos (Global Human Settlement Layer)</a> <span class="citation" data-cites="ghsl_pop2023a">(<a href="references.html#ref-ghsl_pop2023a" role="doc-biblioref">Schiavina et al. 2023</a>)</span> es un conjunto de datos de resolución de 100 metros que proporciona estimaciones de población multitemporales (1975-2030) derivadas de datos censales y administrativos, informadas por la distribución y clasificación de áreas construidas. El GHSL ya tiene un uso científico establecido para mapear la exposición poblacional a peligros de inundación <span class="citation" data-cites="tellman2021">(<a href="references.html#ref-tellman2021" role="doc-biblioref">Tellman et al. 2021</a>)</span>. Sin embargo, esta fuente presenta limitaciones importantes: estudios sobre modelado de riesgo de inundación con conjuntos de datos globales han demostrado que evaluar la exposición a esta escala de resolución puede llevar a sobreestimaciones de la exposición poblacional en zonas de peligro de inundación en comparación con datos de mayor resolución <span class="citation" data-cites="smith2019">(<a href="references.html#ref-smith2019" role="doc-biblioref">Smith et al. 2019</a>)</span>.</p>
<div id="99e2275f" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load GHSL data with dask chunking for memory efficiency</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>ghsl <span class="op">=</span> rioxarray.open_rasterio(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"/home/nissim/Downloads/spatial/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R14_C13/GHS_POP_E2025_GLOBE_R2023A_54009_100_V1_0_R14_C13.tif"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    chunks<span class="op">=</span>{<span class="st">"x"</span>: <span class="dv">1024</span>, <span class="st">"y"</span>: <span class="dv">1024</span>},  <span class="co"># Adjust chunk size based on your memory constraints</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject to your target CRS with streaming</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>ghsl <span class="op">=</span> ghsl.rio.reproject(dst_crs<span class="op">=</span>USE_CRS)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Clip GHSL data to ONLY the Partido de La Plata boundaries</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># This will remove any GHSL data outside the partido</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>ghsl_clipped <span class="op">=</span> ghsl.rio.clip(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    [la_plata.geometry.iloc[<span class="dv">0</span>]],  <span class="co"># Use the actual La Plata partido geometry</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    from_disk<span class="op">=</span><span class="va">True</span>,  <span class="co"># Process from disk to avoid loading entire dataset into memory</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="04ea55be" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import config for color palette</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> config <span class="im">import</span> PINK_PALETTE</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> jenkspy <span class="im">import</span> jenks_breaks</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Map 2: GHSL population data</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> create_consistent_map(<span class="st">"Datos de población GHSL"</span>, common_bounds)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create masked array to hide zero values (do this before jenks classification)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.ma <span class="im">as</span> ma</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>ghsl_masked <span class="op">=</span> ma.masked_where(ghsl_clipped.values[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>, ghsl_clipped.values[<span class="dv">0</span>])</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Use continuous log scale for GHSL data (excluding nodata values and zeros)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>ghsl_valid <span class="op">=</span> (ghsl_clipped.values[<span class="dv">0</span>] <span class="op">!=</span> <span class="op">-</span><span class="dv">200</span>) <span class="op">&amp;</span> (ghsl_clipped.values[<span class="dv">0</span>] <span class="op">!=</span> <span class="dv">0</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>ghsl_valid_data <span class="op">=</span> ghsl_clipped.values[<span class="dv">0</span>][ghsl_valid]</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Use plasma colormap from matplotlib</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.colors <span class="im">as</span> mcolors</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>plasma_cmap <span class="op">=</span> plt.cm.plasma</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject GHSL data to Web Mercator to match the map's coordinate system</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>ghsl_clipped_3857 <span class="op">=</span> ghsl_clipped.rio.reproject(<span class="st">"EPSG:3857"</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask out zeros AND nodata values</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>ghsl_masked_3857 <span class="op">=</span> ma.masked_where(</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    (ghsl_clipped_3857.values[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">|</span> (ghsl_clipped_3857.values[<span class="dv">0</span>] <span class="op">==</span> <span class="op">-</span><span class="dv">200</span>),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    ghsl_clipped_3857.values[<span class="dv">0</span>]</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot GHSL raster with continuous log scale and zero masking</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Use power normalization to emphasize distinctions without extreme compression</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>im <span class="op">=</span> ax2.imshow(</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    ghsl_masked_3857,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    extent<span class="op">=</span>[ghsl_clipped_3857.x.<span class="bu">min</span>(), ghsl_clipped_3857.x.<span class="bu">max</span>(), </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>            ghsl_clipped_3857.y.<span class="bu">min</span>(), ghsl_clipped_3857.y.<span class="bu">max</span>()],</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span>plasma_cmap,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.75</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="renabap_files/figure-html/cell-6-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="renabap_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="google-microsoft-osm-open-buildings" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="google-microsoft-osm-open-buildings"><span class="header-section-number">3.4.3</span> Google-Microsoft-OSM Open Buildings</h3>
<p>Los datos de <a href="https://source.coop/repositories/vida/google-microsoft-osm-open-buildings/access">Google-Microsoft-OSM Open Buildings - combined by VIDA</a> <span class="citation" data-cites="google_microsoft_osm_buildings">(<a href="references.html#ref-google_microsoft_osm_buildings" role="doc-biblioref">VIDA 2023</a>)</span> representan una forma más precisa de evaluar dónde se ubican los asentamientos humanos. Este conjunto de datos combina Google’s V3 Open Buildings, Microsoft’s GlobalMLFootprints, y OpenStreetMap building footprints, conteniendo más de 2.7 mil millones de huellas de edificios. Estos datos han sido <a href="https://www.ice.com/insights/sustainable-finance/ice-climates-exposure-datasets-understanding-how-climate-risks-impact-infrastructure-and-communities">exitosamente aplicados a evaluaciones de riesgo de inundación por empresas globales de riesgo financiero como ICE</a>, demostrando su utilidad para mapear la exposición climática a nivel de huella de edificio individual. Sin embargo, en ausencia de información sobre si los edificios son residenciales o tienen otros usos, y sin datos sobre el número total de unidades en el edificio y habitantes por edificio, solo podemos obtener estimaciones proporcionales aproximadas de dónde se ubican las personas, sin tener una comprensión precisa de quién vive realmente allí y cuántas personas.</p>
<div id="da45c9fd" class="cell" data-cache="false" data-execution_count="6">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_buildings(geodataframe, temp_file<span class="op">=</span><span class="st">"buildings_filtered.parquet"</span>):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Fetch building data for a given GeoDataFrame region"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get S2 cell and bounds</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    center <span class="op">=</span> geodataframe.to_crs(<span class="st">"epsg:3857"</span>).union_all().centroid</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    center_wgs84 <span class="op">=</span> (</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        gpd.GeoDataFrame(geometry<span class="op">=</span>[center], crs<span class="op">=</span><span class="st">"EPSG:3857"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        .to_crs(epsg<span class="op">=</span><span class="dv">4326</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        .geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    cell <span class="op">=</span> s2sphere.CellId.from_lat_lng(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        s2sphere.LatLng.from_degrees(center_wgs84.y, center_wgs84.x)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    ).parent(<span class="dv">10</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    bounds <span class="op">=</span> geodataframe.to_crs(<span class="st">"epsg:4326"</span>).total_bounds</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find matching S2 partition</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    s3 <span class="op">=</span> boto3.client(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"s3"</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        endpoint_url<span class="op">=</span><span class="st">"https://data.source.coop"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        aws_access_key_id<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        aws_secret_access_key<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>Config(s3<span class="op">=</span>{<span class="st">"addressing_style"</span>: <span class="st">"path"</span>}),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    partitions <span class="op">=</span> {</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        obj[<span class="st">"Key"</span>].split(<span class="st">"/"</span>)[<span class="op">-</span><span class="dv">1</span>].replace(<span class="st">".parquet"</span>, <span class="st">""</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> obj <span class="kw">in</span> s3.list_objects_v2(</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>            Bucket<span class="op">=</span><span class="st">"vida"</span>,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>            Prefix<span class="op">=</span><span class="st">"google-microsoft-osm-open-buildings/geoparquet/by_country_s2/country_iso=ARG/"</span>,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        ).get(<span class="st">"Contents"</span>, [])</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    parent_id <span class="op">=</span> <span class="bu">next</span>(</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">str</span>(cell.parent(level).<span class="bu">id</span>())</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> level <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">str</span>(cell.parent(level).<span class="bu">id</span>()) <span class="kw">in</span> partitions</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Setup DuckDB and query</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    con <span class="op">=</span> duckdb.<span class="ex">connect</span>()</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cmd <span class="kw">in</span> [</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"INSTALL spatial"</span>,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LOAD spatial"</span>,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        <span class="st">"INSTALL httpfs"</span>,</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LOAD httpfs"</span>,</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SET s3_region='us-east-1'"</span>,</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SET s3_endpoint='data.source.coop'"</span>,</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SET s3_use_ssl=true"</span>,</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SET s3_url_style='path'"</span>,</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    ]:</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>        con.execute(cmd)</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Export and read back</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="ss">    COPY (SELECT * FROM 's3://vida/google-microsoft-osm-open-buildings/geoparquet/by_country_s2/country_iso=ARG/</span><span class="sc">{</span>parent_id<span class="sc">}</span><span class="ss">.parquet'</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="ss">          WHERE bbox.xmax &gt;= </span><span class="sc">{</span>bounds[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> AND bbox.xmin &lt;= </span><span class="sc">{</span>bounds[<span class="dv">2</span>]<span class="sc">}</span><span class="ss"> AND</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="ss">                bbox.ymax &gt;= </span><span class="sc">{</span>bounds[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> AND bbox.ymin &lt;= </span><span class="sc">{</span>bounds[<span class="dv">3</span>]<span class="sc">}</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="ss">    ) TO '</span><span class="sc">{</span>temp_file<span class="sc">}</span><span class="ss">' (FORMAT PARQUET);</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    con.execute(query)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_parquet(temp_file)</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"geometry"</span>] <span class="op">=</span> gpd.GeoSeries.from_wkb(df[<span class="st">"geometry"</span>])</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gpd.GeoDataFrame(df, geometry<span class="op">=</span><span class="st">"geometry"</span>, crs<span class="op">=</span><span class="st">"EPSG:4326"</span>)</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage:</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>buildings <span class="op">=</span> fetch_buildings(renabap_pba_intersect)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject buildings to match the analysis CRS</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>buildings_proj <span class="op">=</span> buildings.to_crs(USE_CRS)</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="co"># clip the buildings to the partido de la plata</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>buildings_proj <span class="op">=</span> buildings_proj.clip(la_plata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"b98bde13fb564be6b2cc9587135ef23b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="09549221" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Map 3: Building footprints</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>fig3, ax3 <span class="op">=</span> create_consistent_map(<span class="st">"Huellas de edificios"</span>, common_bounds)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add building footprints with grey fill and no outline</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>buildings_3857 <span class="op">=</span> buildings_proj.to_crs(<span class="st">"EPSG:3857"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>buildings_3857.plot(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax3,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    facecolor<span class="op">=</span><span class="st">'grey'</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.7</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="renabap_files/figure-html/cell-8-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="renabap_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="metodología-y-procesamiento" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="metodología-y-procesamiento"><span class="header-section-number">3.5</span> Metodología y procesamiento</h2>
<section id="interpolación-por-area" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="interpolación-por-area"><span class="header-section-number">3.5.1</span> Interpolación por area</h3>
<p>La <a href="https://pysal.org/tobler/notebooks/01_interpolation_methods_overview.html">interpolación areal</a> es un método simple en el que las variables de los datos fuente se ponderan según la superposición entre polígonos fuente y objetivo, luego se reagregan para ajustarse a las geometrías de los polígonos objetivo. En nuestro análisis, esto significa distribuir proporcionalmente la población de cada barrio popular según el área de intersección con diferentes niveles de peligro de inundación. El analasis original de la exposición poblacional a peligros de inundación en la región del Partido de La Plata se realizó utilizando este método.</p>
<div id="26819db6" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure both GeoDataFrames have the same CRS</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> renabap_pba_intersect.crs <span class="op">!=</span> peligro.crs:</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    peligro <span class="op">=</span> peligro.to_crs(renabap_pba_intersect.crs)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique hazard levels</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>hazard_levels <span class="op">=</span> peligro[<span class="st">"PELIGROSID"</span>].unique()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize result columns</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>renabap_with_porciones <span class="op">=</span> renabap_pba_intersect.copy()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level <span class="kw">in</span> hazard_levels:</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    renabap_with_porciones[<span class="ss">f"porcion_</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total area of each barrio</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>renabap_with_porciones[<span class="st">'total_area'</span>] <span class="op">=</span> renabap_with_porciones.geometry.area</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># For each barrio, calculate intersection with each hazard level</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, barrio <span class="kw">in</span> renabap_with_porciones.iterrows():</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    barrio_geom <span class="op">=</span> barrio.geometry</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    barrio_total_area <span class="op">=</span> barrio_geom.area</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> barrio_total_area <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> level <span class="kw">in</span> hazard_levels:</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        hazard_subset <span class="op">=</span> peligro[peligro[<span class="st">"PELIGROSID"</span>] <span class="op">==</span> level]</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> hazard_subset.empty:</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate intersection area</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        intersection_area <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, hazard_row <span class="kw">in</span> hazard_subset.iterrows():</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                intersection <span class="op">=</span> barrio_geom.intersection(hazard_row.geometry)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> intersection.is_empty:</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>                    intersection_area <span class="op">+=</span> intersection.area</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Error calculating intersection for </span><span class="sc">{</span>barrio<span class="sc">.</span>get(<span class="st">'nombre_barrio'</span>, idx)<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate proportion</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>        proportion <span class="op">=</span> intersection_area <span class="op">/</span> barrio_total_area <span class="cf">if</span> barrio_total_area <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>        renabap_with_porciones.at[idx, <span class="ss">f"porcion_</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">"</span>] <span class="op">=</span> proportion</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Create tidy format dataframe</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>renabap_tidy <span class="op">=</span> []</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> renabap_with_porciones.iterrows():</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> level <span class="kw">in</span> hazard_levels:</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        familias_expuestas <span class="op">=</span> row[<span class="ss">f"porcion_</span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">"</span>] <span class="op">*</span> row[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        renabap_tidy.append({</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">"id_renabap"</span>: row[<span class="st">"id_renabap"</span>],</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">"nombre_barrio"</span>: row[<span class="st">"nombre_barrio"</span>],</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">"peligrosidad"</span>: level,</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>            <span class="st">"fam_expuestas_areal"</span>: familias_expuestas</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>renabap_tidy <span class="op">=</span> pd.DataFrame(renabap_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cuenta-de-edificios" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="cuenta-de-edificios"><span class="header-section-number">3.5.2</span> Cuenta de edificios</h3>
</section>
<section id="mapeo-dasymetrico" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="mapeo-dasymetrico"><span class="header-section-number">3.5.3</span> Mapeo dasymetrico</h3>
<p>El <a href="https://support.esri.com/en-us/gis-dictionary/dasymetric-mapping">mapeo dasimétrico</a> reorganiza datos cartográficos de una unidad de recolección en áreas más precisas, modificando los límites originales usando datos de apoyo relacionados. Por ejemplo, un atributo de población organizado por tracto censal se vuelve más significativo cuando se eliminan áreas donde es razonable inferir que la gente no vive (cuerpos de agua, terrenos vacíos). En nuestro caso, utilizamos datos GHSL y huellas de edificios como información auxiliar para mejorar la precisión de las estimaciones de distribución poblacional.</p>
<section id="mapeo-dasymetrico-con-datos-de-edificios" class="level4" data-number="3.5.3.1">
<h4 data-number="3.5.3.1" class="anchored" data-anchor-id="mapeo-dasymetrico-con-datos-de-edificios"><span class="header-section-number">3.5.3.1</span> Mapeo dasymetrico con datos de edificios</h4>
<div id="eefa022e" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Calculate buildings per settlement-hazard intersection</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>buildings_hazard <span class="op">=</span> gpd.overlay(buildings_proj, settlement_hazard, how<span class="op">=</span><span class="st">"intersection"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Count buildings per settlement-hazard combination</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>buildings_per_hazard <span class="op">=</span> (</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    buildings_hazard.groupby([<span class="st">"id_renabap"</span>, <span class="st">"PELIGROSID"</span>])</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"buildings_count"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate total buildings per settlement (barrio popular)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>buildings_settlement <span class="op">=</span> gpd.overlay(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    buildings_proj, renabap_pba_intersect, how<span class="op">=</span><span class="st">"intersection"</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>total_buildings_per_settlement <span class="op">=</span> (</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    buildings_settlement.groupby(<span class="st">"id_renabap"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"total_buildings"</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Merge and calculate ratios</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>hazard_ratios <span class="op">=</span> buildings_per_hazard.merge(</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    total_buildings_per_settlement, on<span class="op">=</span><span class="st">"id_renabap"</span>, how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>hazard_ratios[<span class="st">"building_ratio"</span>] <span class="op">=</span> (</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    hazard_ratios[<span class="st">"buildings_count"</span>] <span class="op">/</span> hazard_ratios[<span class="st">"total_buildings"</span>]</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Get total population per settlement and apply ratios</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>settlement_population <span class="op">=</span> renabap_pba_intersect[</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"id_renabap"</span>, <span class="st">"familias_aproximadas"</span>]</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with ratios and calculate population estimates</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>population_estimates <span class="op">=</span> hazard_ratios.merge(</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    settlement_population, on<span class="op">=</span><span class="st">"id_renabap"</span>, how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>population_estimates[<span class="st">"estimated_population_hazard"</span>] <span class="op">=</span> (</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    population_estimates[<span class="st">"building_ratio"</span>]</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span> population_estimates[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Create final results with totals</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>final_results <span class="op">=</span> population_estimates[</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"id_renabap"</span>, <span class="st">"PELIGROSID"</span>, <span class="st">"estimated_population_hazard"</span>]</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Add total population rows (no hazard breakdown)</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>total_pop_rows <span class="op">=</span> settlement_population.copy()</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>total_pop_rows[<span class="st">"PELIGROSID"</span>] <span class="op">=</span> <span class="st">"total"</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>total_pop_rows[<span class="st">"estimated_population_hazard"</span>] <span class="op">=</span> total_pop_rows[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>final_results <span class="op">=</span> pd.concat(</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>        final_results,</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>        total_pop_rows[[<span class="st">"id_renabap"</span>, <span class="st">"PELIGROSID"</span>, <span class="st">"estimated_population_hazard"</span>]],</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    ignore_index<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Create buildings tidy dataframe with matching structure</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>buildings_tidy <span class="op">=</span> final_results[</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"id_renabap"</span>, <span class="st">"PELIGROSID"</span>, <span class="st">"estimated_population_hazard"</span>]</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns to match the structure</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>buildings_tidy <span class="op">=</span> buildings_tidy.rename(</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">"PELIGROSID"</span>: <span class="st">"peligrosidad"</span>,</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">"estimated_population_hazard"</span>: <span class="st">"fam_expuestas_edificios"</span>,</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out the 'total' rows since we only want hazard-specific data</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>buildings_tidy <span class="op">=</span> buildings_tidy[buildings_tidy[<span class="st">"peligrosidad"</span>] <span class="op">!=</span> <span class="st">"total"</span>].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mapeo-dasymetrico-con-datos-ghsl" class="level4" data-number="3.5.3.2">
<h4 data-number="3.5.3.2" class="anchored" data-anchor-id="mapeo-dasymetrico-con-datos-ghsl"><span class="header-section-number">3.5.3.2</span> Mapeo dasymetrico con datos GHSL</h4>
<div id="09a2d7ce" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterstats</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Calculate the total GHSL population per barrio popular using zonal statistics</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to the format expected by rasterstats</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>geometries <span class="op">=</span> [geom <span class="cf">for</span> geom <span class="kw">in</span> renabap_pba_intersect.geometry]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use rasterstats for vectorized zonal statistics</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> rasterstats.zonal_stats(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    geometries,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    ghsl_clipped.values[<span class="dv">0</span>],  <span class="co"># rasterstats expects 2D array</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    affine<span class="op">=</span>ghsl_clipped.rio.transform(),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    stats<span class="op">=</span>[<span class="st">"sum"</span>],</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=</span>ghsl_clipped.rio.nodata,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the sum values</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>ghsl_totals <span class="op">=</span> [stat[<span class="st">"sum"</span>] <span class="cf">if</span> stat[<span class="st">"sum"</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> stat <span class="kw">in</span> stats]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the GHSL population estimates as a new column</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>renabap_pba_intersect[<span class="st">"ghsl_pop_est"</span>] <span class="op">=</span> ghsl_totals</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the reference raster properties from GHSL data</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>reference_raster <span class="op">=</span> ghsl_clipped</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>reference_transform <span class="op">=</span> reference_raster.rio.transform()</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>reference_crs <span class="op">=</span> reference_raster.rio.crs</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>reference_shape <span class="op">=</span> reference_raster.shape[<span class="dv">1</span>:]  <span class="co"># Get 2D shape (height, width)</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare geometries and values for rasterization</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>geometries_ghsl <span class="op">=</span> [</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    (geom, value)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>        renabap_pba_intersect.geometry, renabap_pba_intersect[<span class="st">"ghsl_pop_est"</span>]</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>geometries_familias <span class="op">=</span> [</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    (geom, value)</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>        renabap_pba_intersect.geometry, renabap_pba_intersect[<span class="st">"familias_aproximadas"</span>]</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Create GHSL population raster</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>ghsl_pop_raster <span class="op">=</span> rasterize(</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>    geometries_ghsl,</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>reference_shape,</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>reference_transform,</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>np.float32,</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    all_touched<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Create familias aproximadas raster</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>familias_raster <span class="op">=</span> rasterize(</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>    geometries_familias,</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>reference_shape,</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>reference_transform,</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>np.float32,</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    all_touched<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Divide original GHSL by the barrio-level GHSL to get fractional population</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Use masking to avoid division on invalid cells</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> (ghsl_clipped.values[<span class="dv">0</span>] <span class="op">!=</span> <span class="op">-</span><span class="dv">200</span>) <span class="op">&amp;</span> (ghsl_pop_raster <span class="op">&gt;</span> <span class="fl">0.1</span>)</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>ghsl_fractional <span class="op">=</span> np.full_like(ghsl_clipped.values[<span class="dv">0</span>], <span class="op">-</span><span class="dv">200</span>, dtype<span class="op">=</span>np.float64)</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>ghsl_fractional[mask] <span class="op">=</span> ghsl_clipped.values[<span class="dv">0</span>][mask] <span class="op">/</span> ghsl_pop_raster[mask]</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Multiply fractional population by familias aproximadas to get downscaled data</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>mask2 <span class="op">=</span> (ghsl_fractional <span class="op">!=</span> <span class="op">-</span><span class="dv">200</span>) <span class="op">&amp;</span> (familias_raster <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>familias_downscaled <span class="op">=</span> np.full_like(ghsl_clipped.values[<span class="dv">0</span>], <span class="op">-</span><span class="dv">200</span>, dtype<span class="op">=</span>np.float64)</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>familias_downscaled[mask2] <span class="op">=</span> ghsl_fractional[mask2] <span class="op">*</span> familias_raster[mask2]</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the results - exclude -200 from range calculations</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>ghsl_valid <span class="op">=</span> ghsl_clipped.values[<span class="dv">0</span>] <span class="op">!=</span> <span class="op">-</span><span class="dv">200</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>fractional_valid <span class="op">=</span> ghsl_fractional <span class="op">!=</span> <span class="op">-</span><span class="dv">200</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>downscaled_valid <span class="op">=</span> familias_downscaled <span class="op">!=</span> <span class="op">-</span><span class="dv">200</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that the sum of downscaled familias equals the original familias aproximadas</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>total_original_familias <span class="op">=</span> renabap_pba_intersect[<span class="st">"familias_aproximadas"</span>].<span class="bu">sum</span>()</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>total_downscaled_familias <span class="op">=</span> np.<span class="bu">sum</span>(familias_downscaled[downscaled_valid])</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Create GHSL tidy dataframe with matching structure</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>ghsl_tidy <span class="op">=</span> []</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> idx, row <span class="kw">in</span> settlement_hazard.iterrows():</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>    stats <span class="op">=</span> zonal_stats(</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>        [row.geometry],</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>        familias_downscaled,  <span class="co"># your numpy array</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>        affine<span class="op">=</span>reference_transform,  <span class="co"># get transform from your xarray</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>        stats<span class="op">=</span>[<span class="st">"sum"</span>],</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>        nodata<span class="op">=-</span><span class="dv">200</span>,  <span class="co"># use your actual nodata value</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>    )[<span class="dv">0</span>]</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    ghsl_tidy.append(</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>            <span class="st">"id_renabap"</span>: row[<span class="st">"id_renabap"</span>],</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>            <span class="st">"peligrosidad"</span>: row[<span class="st">"PELIGROSID"</span>],</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>            <span class="st">"fam_expuestas_ghsl"</span>: stats[<span class="st">"sum"</span>] <span class="cf">if</span> stats[<span class="st">"sum"</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="cf">else</span> <span class="dv">0</span>,</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>ghsl_tidy <span class="op">=</span> pd.DataFrame(ghsl_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="resultados-y-conclusiones" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="resultados-y-conclusiones"><span class="header-section-number">3.6</span> Resultados y conclusiones</h2>
<section id="comparación-de-métodos" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="comparación-de-métodos"><span class="header-section-number">3.6.1</span> Comparación de métodos</h3>
</section>
<section id="exposición-por-barrio" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="exposición-por-barrio"><span class="header-section-number">3.6.2</span> Exposición por barrio</h3>
<div id="1bb3fe2f" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join all three dataframes by id_renabap and peligrosidad</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> renabap_tidy.merge(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    ghsl_tidy, on<span class="op">=</span>[<span class="st">"id_renabap"</span>, <span class="st">"peligrosidad"</span>], how<span class="op">=</span><span class="st">"outer"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>final_df <span class="op">=</span> final_df.merge(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    buildings_tidy, on<span class="op">=</span>[<span class="st">"id_renabap"</span>, <span class="st">"peligrosidad"</span>], how<span class="op">=</span><span class="st">"outer"</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute 0s for NA values in fam_expuestas columns</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>fam_expuestas_columns <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> final_df.columns <span class="cf">if</span> <span class="st">'fam_expuestas'</span> <span class="kw">in</span> col]</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>final_df[fam_expuestas_columns] <span class="op">=</span> final_df[fam_expuestas_columns].fillna(<span class="dv">0</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the geometry and nombre_barrio information from renabap_pba_intersect</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># We only need one row per id_renabap since these are constant</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>renabap_info <span class="op">=</span> renabap_pba_intersect[[<span class="st">'id_renabap'</span>, <span class="st">'nombre_barrio'</span>, <span class="st">'geometry'</span>]].drop_duplicates(subset<span class="op">=</span>[<span class="st">'id_renabap'</span>])</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create long format dataframe with aggregation</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>final_tidy <span class="op">=</span> []</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add renabap data</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> renabap_tidy.iterrows():</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the corresponding barrio info</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    barrio_info <span class="op">=</span> renabap_info[renabap_info[<span class="st">'id_renabap'</span>] <span class="op">==</span> row[<span class="st">"id_renabap"</span>]]</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(barrio_info) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        final_tidy.append(</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">"id_renabap"</span>: row[<span class="st">"id_renabap"</span>],</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">"nombre_barrio"</span>: barrio_info.iloc[<span class="dv">0</span>][<span class="st">"nombre_barrio"</span>],</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">"geometry"</span>: barrio_info.iloc[<span class="dv">0</span>][<span class="st">"geometry"</span>],</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">"peligrosidad"</span>: row[<span class="st">"peligrosidad"</span>],</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">"metodo"</span>: <span class="st">"area"</span>,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">"fam_expuestas"</span>: row[<span class="st">"fam_expuestas_areal"</span>],</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Add ghsl data</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> ghsl_tidy.iterrows():</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    barrio_info <span class="op">=</span> renabap_info[renabap_info[<span class="st">'id_renabap'</span>] <span class="op">==</span> row[<span class="st">"id_renabap"</span>]]</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(barrio_info) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>        final_tidy.append(</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>                <span class="st">"id_renabap"</span>: row[<span class="st">"id_renabap"</span>],</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>                <span class="st">"nombre_barrio"</span>: barrio_info.iloc[<span class="dv">0</span>][<span class="st">"nombre_barrio"</span>],</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>                <span class="st">"geometry"</span>: barrio_info.iloc[<span class="dv">0</span>][<span class="st">"geometry"</span>],</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>                <span class="st">"peligrosidad"</span>: row[<span class="st">"peligrosidad"</span>],</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>                <span class="st">"metodo"</span>: <span class="st">"ghsl"</span>,</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>                <span class="st">"fam_expuestas"</span>: row[<span class="st">"fam_expuestas_ghsl"</span>],</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Add buildings data</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> buildings_tidy.iterrows():</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>    barrio_info <span class="op">=</span> renabap_info[renabap_info[<span class="st">'id_renabap'</span>] <span class="op">==</span> row[<span class="st">"id_renabap"</span>]]</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(barrio_info) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>        final_tidy.append(</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>                <span class="st">"id_renabap"</span>: row[<span class="st">"id_renabap"</span>],</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>                <span class="st">"nombre_barrio"</span>: barrio_info.iloc[<span class="dv">0</span>][<span class="st">"nombre_barrio"</span>],</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>                <span class="st">"geometry"</span>: barrio_info.iloc[<span class="dv">0</span>][<span class="st">"geometry"</span>],</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>                <span class="st">"peligrosidad"</span>: row[<span class="st">"peligrosidad"</span>],</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>                <span class="st">"metodo"</span>: <span class="st">"edificios"</span>,</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>                <span class="st">"fam_expuestas"</span>: row[<span class="st">"fam_expuestas_edificios"</span>],</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>final_tidy <span class="op">=</span> pd.DataFrame(final_tidy)</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate to get one observation per barrio per hazard level per method</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Exclude geometry from groupby since it can't be sorted</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>final_tidy <span class="op">=</span> (</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>    final_tidy.groupby([<span class="st">"id_renabap"</span>, <span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>, <span class="st">"metodo"</span>])[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Create complete combination of all barrios, hazard levels, and methods</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>all_barrios <span class="op">=</span> final_tidy[<span class="st">"id_renabap"</span>].unique()</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>all_hazard_levels <span class="op">=</span> [<span class="st">"alta"</span>, <span class="st">"baja"</span>, <span class="st">"media"</span>]</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>all_methods <span class="op">=</span> [<span class="st">"area"</span>, <span class="st">"ghsl"</span>, <span class="st">"edificios"</span>]</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the barrio info for complete combinations</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>complete_combinations <span class="op">=</span> []</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> barrio <span class="kw">in</span> all_barrios:</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>    barrio_info <span class="op">=</span> renabap_info[renabap_info[<span class="st">'id_renabap'</span>] <span class="op">==</span> barrio]</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(barrio_info) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> hazard <span class="kw">in</span> all_hazard_levels:</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> method <span class="kw">in</span> all_methods:</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>                complete_combinations.append({</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"id_renabap"</span>: barrio,</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"nombre_barrio"</span>: barrio_info.iloc[<span class="dv">0</span>][<span class="st">"nombre_barrio"</span>],</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"peligrosidad"</span>: hazard,</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"metodo"</span>: method</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>complete_combinations <span class="op">=</span> pd.DataFrame(complete_combinations)</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with actual data and fill missing values with 0</span></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>final_tidy <span class="op">=</span> complete_combinations.merge(</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>    final_tidy, on<span class="op">=</span>[<span class="st">"id_renabap"</span>, <span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>, <span class="st">"metodo"</span>], how<span class="op">=</span><span class="st">"left"</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>final_tidy[<span class="st">"fam_expuestas"</span>] <span class="op">=</span> final_tidy[<span class="st">"fam_expuestas"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Add geometry back to complete combinations - only once!</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>final_tidy <span class="op">=</span> final_tidy.merge(</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>    renabap_info[[<span class="st">'id_renabap'</span>, <span class="st">'geometry'</span>]], </span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'id_renabap'</span>, </span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total exposure per hazard level per method</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> (</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>    final_tidy.groupby([<span class="st">"peligrosidad"</span>, <span class="st">"metodo"</span>])[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>    .pivot(index<span class="op">=</span><span class="st">"peligrosidad"</span>, columns<span class="op">=</span><span class="st">"metodo"</span>, values<span class="op">=</span><span class="st">"fam_expuestas"</span>)</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="8f0c4fa2" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import categorical colors from config</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> config <span class="im">import</span> CATEGORICAL_COLORS</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for high exposure (alta peligrosidad) using the joined dataframe</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>alta_data <span class="op">=</span> final_tidy[final_tidy[<span class="st">"peligrosidad"</span>] <span class="op">==</span> <span class="st">"alta"</span>].copy()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate by nombre_barrio and sum fam_expuestas for each method</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># This handles cases where there are multiple geometries with the same barrio name</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>alta_aggregated <span class="op">=</span> (</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    alta_data.groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"metodo"</span>])[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove cases where the barrio name is "Sin Nombre"</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>alta_aggregated <span class="op">=</span> alta_aggregated[alta_aggregated[<span class="st">"nombre_barrio"</span>] <span class="op">!=</span> <span class="st">"Sin Nombre"</span>].copy()</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate total exposure per barrio across all methods</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>total_exposure <span class="op">=</span> (</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    alta_aggregated.groupby(<span class="st">"nombre_barrio"</span>)[<span class="st">"fam_expuestas"</span>]</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>()</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>top_10_barrios <span class="op">=</span> total_exposure.head(<span class="dv">10</span>).index</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter aggregated data for top 10 barrios</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>top_10_data <span class="op">=</span> alta_aggregated[</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    alta_aggregated[<span class="st">"nombre_barrio"</span>].isin(top_10_barrios)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create range plot showing min, max, and individual points</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">10</span>))  <span class="co"># Increased height to accommodate longer barrio names</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for methods using categorical color scheme</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>method_colors <span class="op">=</span> {</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"area"</span>: CATEGORICAL_COLORS[<span class="dv">0</span>],      <span class="co"># Blue alta</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ghsl"</span>: CATEGORICAL_COLORS[<span class="dv">1</span>],      <span class="co"># Pink alta  </span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"edificios"</span>: CATEGORICAL_COLORS[<span class="dv">2</span>]  <span class="co"># Teal</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, barrio <span class="kw">in</span> <span class="bu">enumerate</span>(top_10_barrios):</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    barrio_data <span class="op">=</span> top_10_data[top_10_data[<span class="st">"nombre_barrio"</span>] <span class="op">==</span> barrio]</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(barrio_data) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>        values <span class="op">=</span> barrio_data[<span class="st">"fam_expuestas"</span>].values</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        min_val <span class="op">=</span> values.<span class="bu">min</span>()</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>        max_val <span class="op">=</span> values.<span class="bu">max</span>()</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot range line</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        plt.plot([min_val, max_val], [i, i], <span class="st">"k-"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot individual points colored by method</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _, row <span class="kw">in</span> barrio_data.iterrows():</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>            color <span class="op">=</span> method_colors[row[<span class="st">"metodo"</span>]]</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>            plt.plot(row[<span class="st">"fam_expuestas"</span>], i, <span class="st">"o"</span>, color<span class="op">=</span>color, markersize<span class="op">=</span><span class="dv">6</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>plt.yticks(<span class="bu">range</span>(<span class="bu">len</span>(top_10_barrios)), top_10_barrios)</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Familias Expuestas"</span>)</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Barrio"</span>)</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Range of High Exposure Estimates for Top 10 Barrios"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>    plt.Line2D(</span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">0</span>],</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">0</span>],</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>        marker<span class="op">=</span><span class="st">"o"</span>,</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"w"</span>,</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        markerfacecolor<span class="op">=</span>color,</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>        markersize<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span>method,</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> method, color <span class="kw">in</span> method_colors.items()</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>plt.legend(handles<span class="op">=</span>legend_elements, title<span class="op">=</span><span class="st">"Método"</span>)</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="renabap_files/figure-html/cell-13-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="renabap_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<div id="ec9d348e" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dataframe that has all of the aggregated barrios, with the following columns:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># nombre_barrio</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># peligrosidad</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fam expouestas area</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fam expouestas ghsl</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fam expouestas edificios</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># output a basic, scrollable table of the dataframe with simple formatting, including row highlighting, scrolling, and pagination, with 20 records per page</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create aggregated dataframe with all barrios and methods</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># First, create separate dataframes for each method</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>area_data <span class="op">=</span> final_tidy[final_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"area"</span>].groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas"</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>area_data <span class="op">=</span> area_data.rename(columns<span class="op">=</span>{<span class="st">"fam_expuestas"</span>: <span class="st">"fam_expuestas_area"</span>})</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>ghsl_data <span class="op">=</span> final_tidy[final_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"ghsl"</span>].groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas"</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>ghsl_data <span class="op">=</span> ghsl_data.rename(columns<span class="op">=</span>{<span class="st">"fam_expuestas"</span>: <span class="st">"fam_expuestas_ghsl"</span>})</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>edificios_data <span class="op">=</span> final_tidy[final_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"edificios"</span>].groupby([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>])[<span class="st">"fam_expuestas"</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>edificios_data <span class="op">=</span> edificios_data.rename(columns<span class="op">=</span>{<span class="st">"fam_expuestas"</span>: <span class="st">"fam_expuestas_edificios"</span>})</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge all methods together</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> area_data.merge(ghsl_data, on<span class="op">=</span>[<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>], how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> barrio_summary.merge(edificios_data, on<span class="op">=</span>[<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>], how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill NaN values with 0</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> barrio_summary.fillna(<span class="dv">0</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns are already properly named from the aggregation</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itables <span class="im">import</span> show</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort by nombre_barrio and peligrosidad in descending order</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>barrio_summary <span class="op">=</span> barrio_summary.sort_values([<span class="st">"nombre_barrio"</span>, <span class="st">"peligrosidad"</span>], ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Display as interactive table with pagination</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>show(barrio_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<!--| quarto-html-table-processing: none -->
<table id="itables_374efb19_d1c3_4e10_b8f5_b4c56c5fba3a"><tbody><tr>
    <td style="vertical-align:middle; text-align:left">
    <a href="https://mwouts.github.io/itables/"><svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="64" viewbox="0 0 500 400" style="font-family: 'Droid Sans', sans-serif;">
    <g style="fill:#d9d7fc">
        <path d="M100,400H500V357H100Z"></path>
        <path d="M100,300H400V257H100Z"></path>
        <path d="M0,200H400V157H0Z"></path>
        <path d="M100,100H500V57H100Z"></path>
        <path d="M100,350H500V307H100Z"></path>
        <path d="M100,250H400V207H100Z"></path>
        <path d="M0,150H400V107H0Z"></path>
        <path d="M100,50H500V7H100Z"></path>
    </g>
    <g style="fill:#1a1366;stroke:#1a1366;">
   <rect x="100" y="7" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="5s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="0" y="107" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="3.5s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="0;0;400" dur="3.5s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="207" width="300" height="43">
    <animate attributename="width" values="0;300;0" dur="3s" repeatcount="indefinite"></animate>
    <animate attributename="x" values="100;100;400" dur="3s" repeatcount="indefinite"></animate>
  </rect>
        <rect x="100" y="307" width="400" height="43">
    <animate attributename="width" values="0;400;0" dur="4s" repeatcount="indefinite"></animate>
      <animate attributename="x" values="100;100;500" dur="4s" repeatcount="indefinite"></animate>
  </rect>
        <g style="fill:transparent;stroke-width:8; stroke-linejoin:round" rx="5">
            <g transform="translate(45 50) rotate(-45)">
                <circle r="33" cx="0" cy="0"></circle>
                <rect x="-8" y="32" width="16" height="30"></rect>
            </g>

            <g transform="translate(450 152)">
                <polyline points="-15,-20 -35,-20 -35,40 25,40 25,20"></polyline>
                <rect x="-15" y="-40" width="60" height="60"></rect>
            </g>

            <g transform="translate(50 352)">
                <polygon points="-35,-5 0,-40 35,-5"></polygon>
                <polygon points="-35,10 0,45 35,10"></polygon>
            </g>

            <g transform="translate(75 250)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>

            <g transform="translate(425 250) rotate(180)">
                <polyline points="-30,30 -60,0 -30,-30"></polyline>
                <polyline points="0,30 -30,0 0,-30"></polyline>
            </g>
        </g>
    </g>
</svg>
</a>
    Loading ITables v2.4.4 from the internet...
    (need <a href="https://mwouts.github.io/itables/troubleshooting.html">help</a>?)</td>
    </tr></tbody></table>
<link href="https://www.unpkg.com/dt_for_itables@2.3.3/dt_bundle.css" rel="stylesheet">
<script type="module">
    import { ITable, jQuery as $ } from 'https://www.unpkg.com/dt_for_itables@2.3.3/dt_bundle.js';

    document.querySelectorAll("#itables_374efb19_d1c3_4e10_b8f5_b4c56c5fba3a:not(.dataTable)").forEach(table => {
        if (!(table instanceof HTMLTableElement))
            return;

        let dt_args = {"layout": {"topStart": "pageLength", "topEnd": "search", "bottomStart": "info", "bottomEnd": "paging"}, "classes": ["display", "nowrap"], "style": {"table-layout": "auto", "width": "auto", "margin": "auto", "caption-side": "bottom"}, "order": [], "text_in_header_can_be_selected": true, "table_html": "<table><thead>\n    <tr style=\"text-align: right;\">\n      \n      <th>nombre_barrio</th>\n      <th>peligrosidad</th>\n      <th>fam_expuestas_area</th>\n      <th>fam_expuestas_ghsl</th>\n      <th>fam_expuestas_edificios</th>\n    </tr>\n  </thead></table>", "data_json": "[[\"116 y 77\", \"alta\", 1.022497, 0.0, 3.735849], [\"116 y 77\", \"baja\", 8.559608, 33.0, 15.566038], [\"116 y 77\", \"media\", 4.524553, 0.0, 6.226415], [\"154 y 413\", \"alta\", 0.0, 0.0, 0.0], [\"154 y 413\", \"baja\", 0.972783, 0.0, 2.040816], [\"154 y 413\", \"media\", 0.0, 0.0, 0.0], [\"155 y 46\", \"alta\", 14.807198, 0.0, 20.806452], [\"155 y 46\", \"baja\", 5.567789, 0.0, 4.16129], [\"155 y 46\", \"media\", 21.871151, 43.000001, 30.053763], [\"16 y 80\", \"alta\", 27.819791, 21.077458, 38.712195], [\"16 y 80\", \"baja\", 65.391086, 78.687924, 89.521951], [\"16 y 80\", \"media\", 120.229196, 119.608424, 151.82439], [\"166 y 523\", \"alta\", 0.0, 0.0, 0.0], [\"166 y 523\", \"baja\", 30.61201, 33.842749, 36.991525], [\"166 y 523\", \"media\", 3.730714, 0.0, 3.432203], [\"19 y 77\", \"alta\", 14.454693, 13.716635, 11.66113], [\"19 y 77\", \"baja\", 12.167507, 12.536534, 23.322259], [\"19 y 77\", \"media\", 78.844756, 68.976214, 95.880399], [\"29 y 90\", \"alta\", 28.463785, 0.0, 45.262646], [\"29 y 90\", \"baja\", 70.509434, 84.974446, 116.527237], [\"29 y 90\", \"media\", 9.322562, 41.874023, 18.779183], [\"36 Bis y 135\", \"alta\", 6.30149, 0.0, 7.954545], [\"36 Bis y 135\", \"baja\", 0.0, 0.0, 0.0], [\"36 Bis y 135\", \"media\", 18.69851, 0.0, 21.022727], [\"40 y 150\", \"alta\", 0.0, 0.0, 0.0], [\"40 y 150\", \"baja\", 57.511917, 47.77861, 66.27451], [\"40 y 150\", \"media\", 0.241325, 0.0, 0.0], [\"48 y 144\", \"alta\", 136.288622, 128.277031, 141.359649], [\"48 y 144\", \"baja\", 37.736381, 32.061439, 59.342105], [\"48 y 144\", \"media\", 65.190557, 67.802128, 83.464912], [\"514 y 138\", \"alta\", 0.0, 0.0, 0.0], [\"514 y 138\", \"baja\", 9.891252, 1.723032, 12.513369], [\"514 y 138\", \"media\", 0.0, 0.0, 0.0], [\"516Bis y 220\", \"alta\", 0.0, 0.0, 0.0], [\"516Bis y 220\", \"baja\", 25.598578, 38.79496, 62.843049], [\"516Bis y 220\", \"media\", 34.280307, 4.769113, 35.910314], [\"65 y 153\", \"alta\", 0.0, 0.0, 0.0], [\"65 y 153\", \"baja\", 0.250603, 0.0, 0.0], [\"65 y 153\", \"media\", 0.0, 0.0, 0.0], [\"8 y 489\", \"alta\", 0.701577, 0.0, 0.0], [\"8 y 489\", \"baja\", 0.0, 0.0, 0.0], [\"8 y 489\", \"media\", 24.298423, 25.0, 25.0], [\"90 y 19\", \"alta\", 0.0, 0.0, 0.0], [\"90 y 19\", \"baja\", 2.746648, 0.0, 3.756098], [\"90 y 19\", \"media\", 0.0, 0.0, 0.0], [\"Abasto Nuevo\", \"alta\", 4.489577, 0.153365, 1.51497], [\"Abasto Nuevo\", \"baja\", 9.423714, 0.0, 13.201882], [\"Abasto Nuevo\", \"media\", 13.357694, 12.413357, 18.612489], [\"Aeropuerto\", \"alta\", 154.719603, 145.540192, 153.699379], [\"Aeropuerto\", \"baja\", 103.423813, 113.17999, 133.448447], [\"Aeropuerto\", \"media\", 99.353646, 88.282973, 132.409938], [\"Alegre\", \"alta\", 0.0, 0.0, 0.0], [\"Alegre\", \"baja\", 306.104947, 292.147908, 340.604332], [\"Alegre\", \"media\", 188.045688, 218.11391, 230.357522], [\"Altos del Sol\", \"alta\", 0.0, 0.0, 0.0], [\"Altos del Sol\", \"baja\", 94.023406, 101.479474, 101.944908], [\"Altos del Sol\", \"media\", 1.494501, 0.0, 0.0], [\"Arturo Segu\\u00ed II\", \"alta\", 0.627484, 0.0, 0.0], [\"Arturo Segu\\u00ed II\", \"baja\", 5.576413, 17.0, 10.625], [\"Arturo Segu\\u00ed II\", \"media\", 10.796102, 0.0, 13.8125], [\"Barrio Nuevo\", \"alta\", 48.324597, 43.578956, 37.225369], [\"Barrio Nuevo\", \"baja\", 49.016639, 52.421078, 73.628079], [\"Barrio Nuevo\", \"media\", 98.645864, 87.845291, 118.463054], [\"Boliviana\", \"alta\", 0.0, 0.0, 0.0], [\"Boliviana\", \"baja\", 0.215175, 0.0, 0.88], [\"Boliviana\", \"media\", 0.0, 0.0, 0.0], [\"Carlos Agosti\", \"alta\", 0.0, 0.0, 0.0], [\"Carlos Agosti\", \"baja\", 143.469687, 178.128223, 172.89604], [\"Carlos Agosti\", \"media\", 129.085333, 96.871774, 142.945545], [\"Casaca\", \"alta\", 13.675382, 0.55136, 8.411765], [\"Casaca\", \"baja\", 1.245437, 21.44864, 5.176471], [\"Casaca\", \"media\", 3.266462, 0.0, 5.176471], [\"Colinas del Sol\", \"alta\", 0.0, 0.0, 0.0], [\"Colinas del Sol\", \"baja\", 45.965183, 101.613768, 65.776515], [\"Colinas del Sol\", \"media\", 28.921731, 0.0, 32.030303], [\"Cristo Rey\", \"alta\", 25.674715, 11.290326, 20.407362], [\"Cristo Rey\", \"baja\", 18.264162, 0.0, 37.899387], [\"Cristo Rey\", \"media\", 164.594699, 92.675045, 171.519018], [\"Don Fabi\\u00e1n\", \"alta\", 48.136002, 26.288098, 49.711423], [\"Don Fabi\\u00e1n\", \"baja\", 88.236179, 135.786097, 115.154309], [\"Don Fabi\\u00e1n\", \"media\", 132.775462, 120.254806, 142.212425], [\"Dos de abril\", \"alta\", 0.0, 0.0, 0.0], [\"Dos de abril\", \"baja\", 90.439026, 67.275325, 110.978723], [\"Dos de abril\", \"media\", 15.22312, 13.685403, 18.826748], [\"El Bajo\", \"alta\", 0.0, 0.0, 0.0], [\"El Bajo\", \"baja\", 20.761303, 30.210975, 25.836755], [\"El Bajo\", \"media\", 7.689212, 0.0, 11.980392], [\"El Country\", \"alta\", 1.167145, 0.0, 2.823529], [\"El Country\", \"baja\", 52.621486, 60.080494, 79.058824], [\"El Country\", \"media\", 102.88311, 107.91951, 112.235294], [\"El Futuro\", \"alta\", 45.391797, 0.0, 43.924933], [\"El Futuro\", \"baja\", 268.477963, 204.530781, 368.969437], [\"El Futuro\", \"media\", 156.95857, 162.422654, 189.975335], [\"El Mercadito\", \"alta\", 1.775296, 0.0, 0.0], [\"El Mercadito\", \"baja\", 71.122865, 100.908158, 108.580645], [\"El Mercadito\", \"media\", 96.060637, 86.091838, 69.370968], [\"El Molino\", \"alta\", 30.625118, 23.836841, 39.085714], [\"El Molino\", \"baja\", 45.115263, 58.911717, 50.153234], [\"El Molino\", \"media\", 88.908396, 90.281796, 102.783227], [\"El Molino I\", \"alta\", 3.202468, 0.0, 0.0], [\"El Molino I\", \"baja\", 30.811343, 31.698529, 47.548387], [\"El Molino I\", \"media\", 23.644228, 29.67859, 20.580645], [\"El Olvido\", \"alta\", 79.176538, 54.459472, 80.283604], [\"El Olvido\", \"baja\", 35.600141, 47.311905, 58.434269], [\"El Olvido\", \"media\", 190.904813, 220.525798, 211.379616], [\"El Omb\\u00fa\", \"alta\", 0.0, 0.0, 0.0], [\"El Omb\\u00fa\", \"baja\", 41.153381, 55.046679, 29.534247], [\"El Omb\\u00fa\", \"media\", 0.0, 0.0, 0.0], [\"El Parque\", \"alta\", 0.0, 0.0, 0.0], [\"El Parque\", \"baja\", 2.178209, 13.0, 3.714286], [\"El Parque\", \"media\", 10.821791, 0.0, 10.4], [\"El Progreso\", \"alta\", 45.961936, 35.737902, 56.96], [\"El Progreso\", \"baja\", 0.0, 0.0, 0.0], [\"El Progreso\", \"media\", 18.038064, 28.262098, 16.64], [\"El Retiro\", \"alta\", 89.498212, 81.473407, 87.038031], [\"El Retiro\", \"baja\", 443.296744, 418.167141, 553.44231], [\"El Retiro\", \"media\", 335.714622, 383.970831, 435.360856], [\"El Retiro I\", \"alta\", 0.0, 0.0, 0.0], [\"El Retiro I\", \"baja\", 1.00403, 0.0, 1.071429], [\"El Retiro I\", \"media\", 0.0, 0.0, 0.0], [\"El Rinc\\u00f3n I\", \"alta\", 0.289949, 0.0, 0.5], [\"El Rinc\\u00f3n I\", \"baja\", 42.360374, 39.449801, 59.5], [\"El Rinc\\u00f3n I\", \"media\", 21.349676, 24.550196, 22.0], [\"El Rinc\\u00f3n II\", \"alta\", 26.878729, 3.000706, 25.375], [\"El Rinc\\u00f3n II\", \"baja\", 38.615858, 87.45414, 55.125], [\"El Rinc\\u00f3n II\", \"media\", 44.133375, 42.857065, 43.75], [\"El Rinc\\u00f3n III\", \"alta\", 54.426326, 42.484822, 80.447005], [\"El Rinc\\u00f3n III\", \"baja\", 21.056035, 3.934464, 27.398618], [\"El Rinc\\u00f3n III\", \"media\", 177.517639, 206.580712, 183.046083], [\"El Triunfo\", \"alta\", 43.793681, 44.0, 44.0], [\"El Triunfo\", \"baja\", 43.259526, 44.160993, 50.460705], [\"El Triunfo\", \"media\", 0.206319, 0.0, 0.0], [\"El Tri\\u00e1ngulo\", \"alta\", 0.0, 0.0, 0.0], [\"El Tri\\u00e1ngulo\", \"baja\", 22.200361, 38.662307, 28.695652], [\"El Tri\\u00e1ngulo\", \"media\", 1.478429, 0.0, 0.0], [\"Etcheverry I\", \"alta\", 0.0, 0.0, 0.0], [\"Etcheverry I\", \"baja\", 0.939585, 0.0, 4.736842], [\"Etcheverry I\", \"media\", 0.0, 0.0, 0.0], [\"Evita\", \"alta\", 22.480079, 0.0, 7.859331], [\"Evita\", \"baja\", 13.49172, 0.0, 27.071031], [\"Evita\", \"media\", 76.277422, 0.0, 62.874652], [\"Ferroviario\", \"alta\", 0.0, 0.0, 0.0], [\"Ferroviario\", \"baja\", 18.936166, 14.286419, 33.654237], [\"Ferroviario\", \"media\", 12.808609, 32.931858, 22.766102], [\"Frison\", \"alta\", 0.0, 0.0, 0.0], [\"Frison\", \"baja\", 78.493544, 101.846602, 126.2625], [\"Frison\", \"media\", 7.860682, 18.705321, 12.675], [\"Gambier\", \"alta\", 0.0, 0.0, 0.0], [\"Gambier\", \"baja\", 25.98254, 39.725651, 29.192857], [\"Gambier\", \"media\", 2.548522, 0.0, 0.0], [\"Hijos de Malvinas\", \"alta\", 0.0, 0.0, 0.0], [\"Hijos de Malvinas\", \"baja\", 2.78183, 0.0, 6.446721], [\"Hijos de Malvinas\", \"media\", 0.011654, 0.0, 0.495902], [\"Hip\\u00f3dromo\", \"alta\", 0.0, 0.0, 0.0], [\"Hip\\u00f3dromo\", \"baja\", 27.214456, 33.000001, 31.2], [\"Hip\\u00f3dromo\", \"media\", 0.0, 0.0, 0.0], [\"Jazm\\u00edn\", \"alta\", 2.22762, 0.0, 1.412844], [\"Jazm\\u00edn\", \"baja\", 2.078077, 0.0, 4.238532], [\"Jazm\\u00edn\", \"media\", 2.700616, 0.0, 4.944954], [\"Joel\", \"alta\", 0.0, 0.0, 0.0], [\"Joel\", \"baja\", 218.109495, 173.113815, 225.358974], [\"Joel\", \"media\", 0.0, 0.0, 0.0], [\"La 28\", \"alta\", 25.892179, 31.0, 28.615385], [\"La 28\", \"baja\", 0.572547, 0.0, 0.794872], [\"La 28\", \"media\", 3.21519, 0.0, 8.74359], [\"La Aceitera\", \"alta\", 0.0, 0.0, 0.0], [\"La Aceitera\", \"baja\", 70.899841, 62.41936, 67.360825], [\"La Aceitera\", \"media\", 16.596955, 0.0, 22.453608], [\"La Bajada\", \"alta\", 0.0, 0.0, 0.0], [\"La Bajada\", \"baja\", 47.503318, 81.157528, 72.57754], [\"La Bajada\", \"media\", 28.76935, 12.339227, 27.529412], [\"La Bajada II\", \"alta\", 6.956215, 17.984011, 2.276923], [\"La Bajada II\", \"baja\", 2.223756, 0.0, 3.984615], [\"La Bajada II\", \"media\", 27.815, 19.015987, 34.723077], [\"La Banda\", \"alta\", 35.842743, 80.57252, 48.705441], [\"La Banda\", \"baja\", 90.583982, 86.871605, 99.88743], [\"La Banda\", \"media\", 75.791109, 41.472084, 92.457786], [\"La Cantera\", \"alta\", 18.662267, 7.801328, 28.78208], [\"La Cantera\", \"baja\", 52.231497, 78.469719, 86.346239], [\"La Cantera\", \"media\", 84.823558, 84.806919, 87.259956], [\"La Cer\\u00e1mica\", \"alta\", 1.071499, 0.0, 0.823529], [\"La Cer\\u00e1mica\", \"baja\", 0.930977, 0.384314, 4.117647], [\"La Cer\\u00e1mica\", \"media\", 1.388593, 0.0, 4.941176], [\"La Esperanza\", \"alta\", 141.664461, 144.29887, 168.652944], [\"La Esperanza\", \"baja\", 256.333512, 276.498257, 336.425673], [\"La Esperanza\", \"media\", 175.789715, 135.383931, 229.362058], [\"La Falcone\", \"alta\", 13.110679, 5.833349, 14.5], [\"La Falcone\", \"baja\", 14.718732, 13.341805, 23.5], [\"La Falcone\", \"media\", 34.741035, 45.063167, 38.0], [\"La Favelita\", \"alta\", 29.808781, 0.0, 36.258824], [\"La Favelita\", \"baja\", 0.0, 0.0, 0.0], [\"La Favelita\", \"media\", 104.191219, 134.000006, 122.964706], [\"La Fortaleza\", \"alta\", 82.646412, 58.028817, 83.22865], [\"La Fortaleza\", \"baja\", 2.243625, 0.0, 2.506887], [\"La Fortaleza\", \"media\", 97.109963, 123.971184, 133.366391], [\"La F\\u00e1brica\", \"alta\", 0.0, 0.0, 0.0], [\"La F\\u00e1brica\", \"baja\", 7.852107, 0.0, 16.525822], [\"La F\\u00e1brica\", \"media\", 0.0, 0.0, 0.0], [\"La Granja\", \"alta\", 72.394061, 33.514499, 67.723881], [\"La Granja\", \"baja\", 12.589711, 19.534609, 17.156716], [\"La Granja\", \"media\", 156.931371, 188.950884, 195.044776], [\"La Granja I\", \"alta\", 0.0, 0.0, 0.0], [\"La Granja I\", \"baja\", 0.0, 0.0, 0.0], [\"La Granja I\", \"media\", 0.0, 0.0, 0.0], [\"La Granja II\", \"alta\", 18.183699, 22.0, 22.0], [\"La Granja II\", \"baja\", 0.0, 0.0, 0.0], [\"La Granja II\", \"media\", 3.816301, 0.0, 6.387097], [\"La Granjita\", \"alta\", 0.400062, 0.0, 0.0], [\"La Granjita\", \"baja\", 110.822235, 117.994517, 117.97052], [\"La Granjita\", \"media\", 2.238128, 0.0, 1.638479], [\"La Granjita II\", \"alta\", 42.783783, 0.0, 45.958457], [\"La Granjita II\", \"baja\", 26.674944, 30.607204, 45.958457], [\"La Granjita II\", \"media\", 71.261505, 131.104915, 74.682493], [\"La G\\u00fcemes\", \"alta\", 11.546746, 0.0, 13.0], [\"La G\\u00fcemes\", \"baja\", 0.0, 0.0, 0.0], [\"La G\\u00fcemes\", \"media\", 1.453254, 0.0, 2.4375], [\"La Hermosura\", \"alta\", 0.0, 0.0, 0.0], [\"La Hermosura\", \"baja\", 0.0, 0.0, 0.0], [\"La Hermosura\", \"media\", 0.0, 0.0, 0.0], [\"La Isla\", \"alta\", 270.214479, 293.000016, 282.954286], [\"La Isla\", \"baja\", 0.0, 0.0, 0.0], [\"La Isla\", \"media\", 22.785521, 0.0, 23.44], [\"La Laguna\", \"alta\", 2.095182, 4.971475, 2.358696], [\"La Laguna\", \"baja\", 1.894486, 19.7286, 5.054348], [\"La Laguna\", \"media\", 13.935071, 3.149963, 17.184783], [\"La Palangana\", \"alta\", 0.0, 0.0, 0.0], [\"La Palangana\", \"baja\", 5.645325, 0.0, 11.140625], [\"La Palangana\", \"media\", 26.423817, 17.400454, 38.75], [\"La Piedad\", \"alta\", 0.0, 0.0, 0.0], [\"La Piedad\", \"baja\", 188.929317, 132.228317, 248.131915], [\"La Piedad\", \"media\", 79.536901, 125.308835, 100.32], [\"La Piojera\", \"alta\", 0.0, 0.0, 0.0], [\"La Piojera\", \"baja\", 1.393949, 0.0, 5.577465], [\"La Piojera\", \"media\", 0.0, 0.0, 0.0], [\"La Rueda\", \"alta\", 0.0, 0.0, 0.0], [\"La Rueda\", \"baja\", 28.455921, 33.465318, 30.608696], [\"La Rueda\", \"media\", 0.033562, 0.0, 0.0], [\"La Uni\\u00f3n\", \"alta\", 30.184637, 0.0, 27.498139], [\"La Uni\\u00f3n\", \"baja\", 36.846877, 92.68366, 60.66786], [\"La Uni\\u00f3n\", \"media\", 78.577027, 86.552475, 104.153408], [\"La Usina\", \"alta\", 0.0, 0.0, 0.0], [\"La Usina\", \"baja\", 17.909312, 0.0, 22.544554], [\"La Usina\", \"media\", 0.0, 0.0, 0.0], [\"La Victoria\", \"alta\", 0.943756, 0.662239, 0.517647], [\"La Victoria\", \"baja\", 102.942056, 72.759869, 129.411765], [\"La Victoria\", \"media\", 11.029724, 24.481591, 10.870588], [\"La V\\u00eda\", \"alta\", 28.015183, 3.085426, 11.634615], [\"La V\\u00eda\", \"baja\", 99.79647, 123.795605, 110.528846], [\"La V\\u00eda\", \"media\", 50.069744, 23.720743, 38.076923], [\"Las Casuarinas\", \"alta\", 36.405729, 30.649401, 32.355311], [\"Las Casuarinas\", \"baja\", 21.6814, 48.830347, 38.56044], [\"Las Casuarinas\", \"media\", 41.560725, 39.190834, 58.948718], [\"Las Dos Manzanas\", \"alta\", 0.0, 0.0, 0.0], [\"Las Dos Manzanas\", \"baja\", 1.867519, 0.0, 0.835821], [\"Las Dos Manzanas\", \"media\", 0.0, 0.0, 0.0], [\"Las Margaritas\", \"alta\", 0.0, 0.0, 0.0], [\"Las Margaritas\", \"baja\", 18.515764, 8.726591, 18.439024], [\"Las Margaritas\", \"media\", 0.0, 0.0, 0.0], [\"Las Palmeras\", \"alta\", 236.935254, 238.901164, 256.968523], [\"Las Palmeras\", \"baja\", 99.703879, 102.999424, 133.242938], [\"Las Palmeras\", \"media\", 190.934449, 220.032811, 249.830508], [\"Las Rosas\", \"alta\", 53.531696, 53.256271, 46.683958], [\"Las Rosas\", \"baja\", 155.937503, 180.863305, 227.460134], [\"Las Rosas\", \"media\", 229.58601, 163.748704, 245.835735], [\"Las V\\u00edas\", \"alta\", 0.927897, 0.0, 2.678571], [\"Las V\\u00edas\", \"baja\", 20.548627, 50.0, 25.0], [\"Las V\\u00edas\", \"media\", 28.51538, 0.0, 31.25], [\"Los Chaques\", \"alta\", 0.629463, 0.0, 1.3], [\"Los Chaques\", \"baja\", 9.524541, 39.0, 20.8], [\"Los Chaques\", \"media\", 24.375296, 0.0, 26.0], [\"Los Ciruelos\", \"alta\", 0.0, 0.0, 0.0], [\"Los Ciruelos\", \"baja\", 8.136501, 4.463569, 5.125], [\"Los Ciruelos\", \"media\", 0.449402, 0.0, 0.0], [\"Los Colectiveros\", \"alta\", 0.0, 0.0, 0.0], [\"Los Colectiveros\", \"baja\", 0.603715, 8.449704, 0.545455], [\"Los Colectiveros\", \"media\", 0.0, 0.0, 0.0], [\"Los Pinos\", \"alta\", 11.74193, 13.568905, 14.517197], [\"Los Pinos\", \"baja\", 103.190838, 87.314376, 112.516653], [\"Los Pinos\", \"media\", 74.730973, 95.347661, 100.050955], [\"Los Robles\", \"alta\", 59.679457, 48.810389, 62.811236], [\"Los Robles\", \"baja\", 57.194479, 71.133271, 78.38427], [\"Los Robles\", \"media\", 77.633695, 82.470944, 105.377528], [\"Los Rosales\", \"alta\", 0.0, 0.0, 0.0], [\"Los Rosales\", \"baja\", 25.19701, 8.924369, 39.162162], [\"Los Rosales\", \"media\", 56.103495, 48.92038, 56.454545], [\"Los Zorzales\", \"alta\", 0.0, 0.0, 0.0], [\"Los Zorzales\", \"baja\", 0.901255, 0.0, 0.0], [\"Los Zorzales\", \"media\", 0.0, 0.0, 0.0], [\"Malvinas Argentinas\", \"alta\", 0.0, 0.0, 0.0], [\"Malvinas Argentinas\", \"baja\", 11.457004, 34.310811, 16.081218], [\"Malvinas Argentinas\", \"media\", 0.0, 0.0, 0.0], [\"Malvinas II\", \"alta\", 0.0, 0.0, 0.0], [\"Malvinas II\", \"baja\", 1.001885, 0.0, 3.538827], [\"Malvinas II\", \"media\", 0.0, 0.0, 0.0], [\"Mart\\u00edn Fierro\", \"alta\", 0.0, 0.0, 0.0], [\"Mart\\u00edn Fierro\", \"baja\", 17.067865, 15.130979, 21.508436], [\"Mart\\u00edn Fierro\", \"media\", 5.535293, 0.0, 5.807692], [\"Medalla Milagrosa\", \"alta\", 81.749276, 62.112604, 87.429752], [\"Medalla Milagrosa\", \"baja\", 20.258571, 0.0, 29.553719], [\"Medalla Milagrosa\", \"media\", 44.929344, 86.887393, 70.190083], [\"Mercosur\", \"alta\", 0.0, 0.0, 0.0], [\"Mercosur\", \"baja\", 161.811201, 170.44331, 201.29304], [\"Mercosur\", \"media\", 26.325813, 30.760616, 36.062271], [\"Monasterio\", \"alta\", 14.284268, 42.0, 19.2], [\"Monasterio\", \"baja\", 1.87981, 0.0, 6.0], [\"Monasterio\", \"media\", 4.161598, 0.0, 9.6], [\"Nin\\u00ed\", \"alta\", 0.0, 0.0, 0.0], [\"Nin\\u00ed\", \"baja\", 13.108648, 0.0, 14.3625], [\"Nin\\u00ed\", \"media\", 193.255231, 383.0, 191.5], [\"Nueva Esperanza\", \"alta\", 0.0, 0.0, 0.0], [\"Nueva Esperanza\", \"baja\", 4.506922, 0.0, 8.060345], [\"Nueva Esperanza\", \"media\", 2.34399, 0.0, 2.37069], [\"Padre Cajade\", \"alta\", 0.0, 0.0, 0.0], [\"Padre Cajade\", \"baja\", 12.091148, 0.0, 13.172043], [\"Padre Cajade\", \"media\", 0.0, 0.0, 0.0], [\"Primero de Agosto\", \"alta\", 3.823075, 0.0, 3.423237], [\"Primero de Agosto\", \"baja\", 54.133249, 33.602567, 67.437759], [\"Primero de Agosto\", \"media\", 13.362643, 31.010964, 17.458506], [\"Puente de Fierro\", \"alta\", 23.149127, 30.545877, 26.344966], [\"Puente de Fierro\", \"baja\", 376.491438, 396.683606, 487.142372], [\"Puente de Fierro\", \"media\", 212.949014, 200.594443, 250.516677], [\"Ruta del Sol\", \"alta\", 0.0, 0.0, 0.0], [\"Ruta del Sol\", \"baja\", 79.281056, 49.948509, 94.131391], [\"Ruta del Sol\", \"media\", 22.676832, 15.243208, 18.502447], [\"San Antonio\", \"alta\", 0.0, 0.0, 0.0], [\"San Antonio\", \"baja\", 0.575143, 0.0, 0.445946], [\"San Antonio\", \"media\", 1.66221, 0.0, 4.459459], [\"San Cayetano\", \"alta\", 0.0, 0.0, 0.0], [\"San Cayetano\", \"baja\", 157.740419, 146.036062, 170.553612], [\"San Cayetano\", \"media\", 73.317025, 96.357779, 79.229323], [\"San Luis\", \"alta\", 122.509173, 104.697426, 106.462562], [\"San Luis\", \"baja\", 25.209259, 20.717869, 47.454243], [\"San Luis\", \"media\", 71.875745, 88.485041, 99.034942], [\"Santa Ana\", \"alta\", 0.0, 0.0, 0.0], [\"Santa Ana\", \"baja\", 76.308217, 103.144996, 88.724919], [\"Santa Ana\", \"media\", 1.572985, 0.0, 1.190939], [\"Santa Isabel\", \"alta\", 0.0, 0.0, 0.0], [\"Santa Isabel\", \"baja\", 0.128841, 0.0, 0.417112], [\"Santa Isabel\", \"media\", 0.868426, 0.0, 0.834225], [\"Santa Rosa\", \"alta\", 29.850404, 1.419693, 6.844978], [\"Santa Rosa\", \"baja\", 37.316229, 62.288102, 67.008734], [\"Santa Rosa\", \"media\", 65.050319, 3.716162, 25.578603], [\"Santa Rosa Calle 39\", \"alta\", 0.0, 0.0, 0.0], [\"Santa Rosa Calle 39\", \"baja\", 2.588795, 0.0, 1.976744], [\"Santa Rosa Calle 39\", \"media\", 0.0, 0.0, 0.0], [\"Savoia\", \"alta\", 0.0, 0.0, 0.0], [\"Savoia\", \"baja\", 266.839625, 254.723016, 301.654545], [\"Savoia\", \"media\", 27.642659, 63.187157, 23.697902], [\"Sebasti\\u00e1n\", \"alta\", 0.0, 0.0, 0.0], [\"Sebasti\\u00e1n\", \"baja\", 54.882408, 40.05151, 68.728643], [\"Sebasti\\u00e1n\", \"media\", 8.927892, 0.0, 19.01005], [\"Sin Nombre\", \"alta\", 261.636908, 220.759643, 269.961637], [\"Sin Nombre\", \"baja\", 317.540916, 215.730142, 424.878139], [\"Sin Nombre\", \"media\", 341.385638, 338.152311, 374.344535], [\"Terra M\\u00eda\", \"alta\", 0.0, 0.0, 0.0], [\"Terra M\\u00eda\", \"baja\", 3.348481, 0.0, 6.578947], [\"Terra M\\u00eda\", \"media\", 0.074689, 0.0, 0.0], [\"Terra M\\u00eda II\", \"alta\", 0.0, 0.0, 0.0], [\"Terra M\\u00eda II\", \"baja\", 2.011214, 0.0, 0.0], [\"Terra M\\u00eda II\", \"media\", 0.0, 0.0, 0.0], [\"Toba\", \"alta\", 154.978645, 148.871627, 172.128458], [\"Toba\", \"baja\", 0.0, 0.0, 0.0], [\"Toba\", \"media\", 96.021355, 102.128378, 101.193676], [\"Tres de Abril\", \"alta\", 47.977518, 33.897612, 67.87234], [\"Tres de Abril\", \"baja\", 27.257228, 27.507853, 27.5], [\"Tres de Abril\", \"media\", 137.101949, 158.594537, 152.12766], [\"Universitario\", \"alta\", 3.687577, 0.0, 0.0], [\"Universitario\", \"baja\", 25.221354, 0.0, 0.0], [\"Universitario\", \"media\", 41.38152, 0.0, 0.0], [\"Veintiseis de julio\", \"alta\", 0.482037, 0.0, 0.0], [\"Veintiseis de julio\", \"baja\", 42.222669, 34.472537, 40.615385], [\"Veintiseis de julio\", \"media\", 16.291389, 9.820109, 10.549451], [\"Vieja Estaci\\u00f3n\", \"alta\", 0.0, 0.0, 0.0], [\"Vieja Estaci\\u00f3n\", \"baja\", 1.78391, 0.0, 4.125], [\"Vieja Estaci\\u00f3n\", \"media\", 0.0, 0.0, 0.0], [\"Villa Aburridita\", \"alta\", 1.631103, 0.0, 0.414521], [\"Villa Aburridita\", \"baja\", 285.868067, 261.303892, 379.701339], [\"Villa Aburridita\", \"media\", 21.261297, 21.032786, 21.140577], [\"Villa Alba\", \"alta\", 0.0, 0.0, 0.0], [\"Villa Alba\", \"baja\", 55.201589, 27.359054, 84.719158], [\"Villa Alba\", \"media\", 0.17995, 0.0, 0.364253], [\"Villa Garivaldi\", \"alta\", 0.0, 0.0, 0.0], [\"Villa Garivaldi\", \"baja\", 21.512094, 5.389179, 21.0], [\"Villa Garivaldi\", \"media\", 0.145805, 0.0, 0.0], [\"Villa Las Rosas\", \"alta\", 36.152073, 35.374391, 31.304348], [\"Villa Las Rosas\", \"baja\", 56.794688, 26.712373, 75.652174], [\"Villa Las Rosas\", \"media\", 79.551464, 59.339365, 121.73913], [\"Villa Montoro\", \"alta\", 293.294986, 232.04829, 302.009912], [\"Villa Montoro\", \"baja\", 293.274127, 300.148233, 425.009584], [\"Villa Montoro\", \"media\", 193.643482, 330.952907, 270.219003], [\"Villa Rica\", \"alta\", 34.572741, 10.858778, 35.776596], [\"Villa Rica\", \"baja\", 0.0, 0.0, 0.0], [\"Villa Rica\", \"media\", 24.427259, 48.141223, 32.638298], [\"Villa San Mart\\u00edn\", \"alta\", 0.0, 0.0, 0.0], [\"Villa San Mart\\u00edn\", \"baja\", 18.443534, 24.29571, 31.633333], [\"Villa San Mart\\u00edn\", \"media\", 46.389429, 24.934306, 46.8], [\"YPF\", \"alta\", 0.0, 0.0, 0.0], [\"YPF\", \"baja\", 5.102236, 0.0, 8.58], [\"YPF\", \"media\", 0.0, 0.0, 0.0]]"};
        new ITable(table, dt_args);
    });
</script>
</div>
</div>
<p>This map is based on the “edificios” method, but could be replicated for the “area” or “GHSL” methods just as easily.</p>
<div id="45691254" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Mostrar código</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Map 4: Barrios por población expuesta estimada</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fig4, ax4 <span class="op">=</span> create_consistent_map(<span class="st">"Barrios por población expuesta estimada"</span>, common_bounds)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get edificios method data from final_tidy, filtering out low risk</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>edificios_data <span class="op">=</span> final_tidy[</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    (final_tidy[<span class="st">"metodo"</span>] <span class="op">==</span> <span class="st">"edificios"</span>) <span class="op">&amp;</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    (final_tidy[<span class="st">"peligrosidad"</span>].isin([<span class="st">"alta"</span>, <span class="st">"media"</span>]))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>].copy()</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to GeoDataFrame and reproject geometries to EPSG:3857 for proper plotting</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>edificios_gdf <span class="op">=</span> gpd.GeoDataFrame(edificios_data, geometry<span class="op">=</span><span class="st">'geometry'</span>, crs<span class="op">=</span><span class="st">'EPSG:5349'</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>edificios_gdf <span class="op">=</span> edificios_gdf.clip(la_plata)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>edificios_gdf_3857 <span class="op">=</span> edificios_gdf.to_crs(<span class="st">'EPSG:3857'</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Import matplotlib colormap using the correct syntax</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.cm <span class="im">as</span> cm</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Get RdPu colormap using the correct syntax</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>rdpu_cmap <span class="op">=</span> cm.RdPu</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colors for peligrosidad levels using RdPu colormap</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>peligrosidad_colors <span class="op">=</span> {</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"alta"</span>: rdpu_cmap(<span class="fl">0.8</span>),    <span class="co"># Darker red-purple for high risk</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"media"</span>: rdpu_cmap(<span class="fl">0.4</span>)    <span class="co"># Lighter red-purple for medium risk</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Define plotting order - medium risk first (underneath), high risk last (on top)</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>plotting_order <span class="op">=</span> [<span class="st">"media"</span>, <span class="st">"alta"</span>]</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot centroids for each barrio with jittering, in controlled order</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>)  <span class="co"># For reproducible results</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> peligrosidad <span class="kw">in</span> plotting_order:</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get data for this peligrosidad level</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    level_data <span class="op">=</span> edificios_gdf_3857[edificios_gdf_3857[<span class="st">"peligrosidad"</span>] <span class="op">==</span> peligrosidad]</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> level_data.iterrows():</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate centroid from the reprojected geometry</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>        centroid <span class="op">=</span> row[<span class="st">"geometry"</span>].centroid</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add jitter</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>        jitter_x <span class="op">=</span> np.random.uniform(<span class="op">-</span><span class="dv">200</span>, <span class="dv">200</span>)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>        jitter_y <span class="op">=</span> np.random.uniform(<span class="op">-</span><span class="dv">200</span>, <span class="dv">200</span>)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>        x_pos <span class="op">=</span> centroid.x <span class="op">+</span> jitter_x</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>        y_pos <span class="op">=</span> centroid.y <span class="op">+</span> jitter_y</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get color based on peligrosidad</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>        color <span class="op">=</span> peligrosidad_colors[row[<span class="st">"peligrosidad"</span>]]</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Size based on number of families exposed</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>        size <span class="op">=</span> <span class="bu">max</span>(<span class="dv">10</span>, row[<span class="st">"fam_expuestas"</span>] <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">10</span>)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Plot the centroid as a circle with jitter - use color keyword instead of c</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>        ax4.scatter(</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>            x_pos, y_pos, </span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>            s<span class="op">=</span>size, color<span class="op">=</span>color,  <span class="co"># Changed from c=color to color=color</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>            alpha<span class="op">=</span><span class="fl">0.9</span>,</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>            edgecolors<span class="op">=</span><span class="st">'white'</span>,</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>            linewidth<span class="op">=</span><span class="fl">1.0</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend for peligrosidad levels</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>legend_elements <span class="op">=</span> [</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>    plt.Line2D([<span class="dv">0</span>], [<span class="dv">0</span>], marker<span class="op">=</span><span class="st">'o'</span>, color<span class="op">=</span><span class="st">'w'</span>, markerfacecolor<span class="op">=</span>color, markersize<span class="op">=</span><span class="dv">8</span>, label<span class="op">=</span>level.capitalize())</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> level, color <span class="kw">in</span> peligrosidad_colors.items()</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>ax4.legend(handles<span class="op">=</span>legend_elements, title<span class="op">=</span><span class="st">"Nivel de Peligrosidad"</span>, loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><a href="renabap_files/figure-html/cell-15-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="renabap_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exposición-por-cuenca" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="exposición-por-cuenca"><span class="header-section-number">3.6.3</span> Exposición por cuenca</h3>
</section>
<section id="exposición-por-eje" class="level3" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="exposición-por-eje"><span class="header-section-number">3.6.4</span> Exposición por eje</h3>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-ghsl_pop2023a" class="csl-entry" role="listitem">
Schiavina, M., S. Freire, A. Carioli, and K. MacManus. 2023. <span>“GHS-POP R2023A - GHS Population Grid Multitemporal (1975-2030).”</span> European Commission, Joint Research Centre (JRC). <a href="https://doi.org/10.2905/2FF68A52-5B5B-4A22-8F40-C41DA8332CFE">https://doi.org/10.2905/2FF68A52-5B5B-4A22-8F40-C41DA8332CFE</a>.
</div>
<div id="ref-smith2019" class="csl-entry" role="listitem">
Smith, A., P. D. Bates, O. Wing, et al. 2019. <span>“New Estimates of Flood Exposure in Developing Countries Using High-Resolution Population Data.”</span> <em>Nature Communications</em> 10: 1814. <a href="https://doi.org/10.1038/s41467-019-09282-y">https://doi.org/10.1038/s41467-019-09282-y</a>.
</div>
<div id="ref-tellman2021" class="csl-entry" role="listitem">
Tellman, B., J. A. Sullivan, C. Kuhn, et al. 2021. <span>“Satellite Imaging Reveals Increased Proportion of Population Exposed to Floods.”</span> <em>Nature</em> 596: 80–86. <a href="https://doi.org/10.1038/s41586-021-03695-w">https://doi.org/10.1038/s41586-021-03695-w</a>.
</div>
<div id="ref-google_microsoft_osm_buildings" class="csl-entry" role="listitem">
VIDA. 2023. <span>“Google-Microsoft-OSM Open Buildings - Combined by VIDA.”</span> <a href="https://source.coop/repositories/vida/google-microsoft-osm-open-buildings/access">https://source.coop/repositories/vida/google-microsoft-osm-open-buildings/access</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"state":{"653635a24db547b4adcb9b916f7907cd":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"ProgressStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"StyleView","bar_color":"black","description_width":""}},"91af93a5984a47bc941bfd5f0291c910":{"model_module":"@jupyter-widgets/base","model_module_version":"2.0.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"2.0.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"2.0.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border_bottom":null,"border_left":null,"border_right":null,"border_top":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"padding":null,"right":null,"top":null,"visibility":null,"width":"auto"}},"b98bde13fb564be6b2cc9587135ef23b":{"model_module":"@jupyter-widgets/controls","model_module_version":"2.0.0","model_name":"FloatProgressModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"2.0.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"2.0.0","_view_name":"ProgressView","bar_style":"","description":"","description_allow_html":false,"layout":"IPY_MODEL_91af93a5984a47bc941bfd5f0291c910","max":100,"min":0,"orientation":"horizontal","style":"IPY_MODEL_653635a24db547b4adcb9b916f7907cd","tabbable":null,"tooltip":null,"value":100}}},"version_major":2,"version_minor":0}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./suavizacion.html" class="pagination-link" aria-label="Suavización">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Suavización</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","openEffect":"zoom","loop":false,"selector":".lightbox","descPosition":"bottom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>